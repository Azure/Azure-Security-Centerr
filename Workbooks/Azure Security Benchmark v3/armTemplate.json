{
  "contentVersion": "2.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Azure Security Benchmark v3",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "/subscriptions/d1d8779d-38d7-4f06-91db-9cbc8de0176f/resourcegroups/soc/providers/microsoft.operationalinsights/workspaces/cybersecuritysoc",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "a4b4e975-fa7c-46a3-b669-850aacc88134",
                "version": "KqlParameterItem/1.0",
                "name": "Help",
                "label": "üîé Getting Started",
                "type": 10,
                "isRequired": true,
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "jsonData": "[[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true},\r\n    {\"value\": \"No\", \"label\": \"No\"}\r\n]",
                "value": "No"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "DefaultSubscription_Internal",
                "type": 1,
                "isRequired": true,
                "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
                "crossComponentResources": [
                  "value::selected"
                ],
                "isHiddenWhenLocked": true,
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "id": "314d02bf-4691-43fa-af59-d67073c8b8fa"
              },
              {
                "id": "e6ded9a1-a83c-4762-938d-5bf8ff3d3d38",
                "version": "KqlParameterItem/1.0",
                "name": "Subscription",
                "type": 6,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
                "crossComponentResources": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "value": [
                  "value::all"
                ]
              },
              {
                "id": "e3225ed0-6210-40a1-b2d0-66e42ffa71d6",
                "version": "KqlParameterItem/1.0",
                "name": "Workspace",
                "type": 5,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| order by name asc\r\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\r\n| mvexpand All limit 100\r\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)",
                "crossComponentResources": [
                  "{Subscription}"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "value": [
                  "value::all"
                ]
              },
              {
                "id": "15b2c181-7397-43c1-900a-28e175ae8a6f",
                "version": "KqlParameterItem/1.0",
                "name": "TimeRange",
                "type": 4,
                "isRequired": true,
                "value": {
                  "durationMs": 604800000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 1209600000
                    },
                    {
                      "durationMs": 2592000000
                    }
                  ],
                  "allowCustom": true
                }
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "name": "Parameter Selectors"
        },
        {
          "type": 1,
          "content": {
            "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take time to answer a quick survey,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://forms.office.com/r/sxvBsuTcmM)"
          },
          "name": "Survey"
        },
        {
          "type": 1,
          "content": {
            "json": "## Getting Started\r\nThis workbook leverages Azure Policy, Azure Resource Graph, and Azure Log Analytics to align directly with the Azure Security Benchmark. A filter set in guide, subscription, workspace, time, and ASB control are available for customized reporting and review. The documentation below provides getting started recommendations for centralizing log analytics data and enabling Microsoft Defender for Cloud Continuous Export. This offering There is telemetry from 25+ Microsoft Security products included in this offering. Common use cases include conducting ASB assessments which custom reporting, time filtering, subscription filtering, workspace filtering, and guides. The report is exportable for print or PDF with the Print Workbook feature. The workbook is organized by ASB control areas, each area has multiple control cards. Control cards include ASB logging over time, current ASB assessment recommendations, ASB status, documentation guides, recommendations, and links to product pages, documentation, and portals for all referenced products.<br>\r\n\r\n### [Recommended Microsoft Sentinel Roles](https://docs.microsoft.com/azure/sentinel/roles) / [Recommended Microsoft Defender for Cloud Roles](https://docs.microsoft.com/azure/defender-for-cloud/permissions#roles-and-allowed-actions)\r\n| <strong> Roles </strong> | <strong> Rights </strong> | \r\n|:--|:--|\r\n|Security Reader | View Workbooks, Analytics, Security Recommendations |\r\n|Security Contributor| Deploy/Modify Workbooks, Analytics, Apply Security Recommendations |\r\n|Owner| Assign Regulatory Compliance Initiatives|\r\n\r\n1Ô∏è‚É£  [Add the Azure Security Benchmark Assessment to Your Dashboard](https://docs.microsoft.com/azure/security-center/update-regulatory-compliance-packages#add-a-regulatory-standard-to-your-dashboard)<br>\r\n2Ô∏è‚É£  [Continuously Export Security Center Data: SecurityRegulatoryCompliance & SecurityRecommendation Data Tables](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n3Ô∏è‚É£ [Onboard Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\r\n4Ô∏è‚É£ [Connect Microsoft Sentinel to Azure, Windows, Microsoft, and Amazon services](https://docs.microsoft.com/azure/sentinel/connect-azure-windows-microsoft-services)<br>\r\n\r\nThis workbook demonstrates best practice guidance, but Microsoft does not guarantee nor imply compliance. All requirements, validations, and controls are governed by respective organizations. This solution provides visibility and situational awareness for security capabilities delivered with Microsoft technologies in predominantly cloud-based environments. Customer experience will vary by user and some panels may require additional configurations for operation. Recommendations do not imply coverage of respective controls as they are often one of several courses of action for approaching requirements which is unique to each customer. Recommendations should be considered a starting point for planning full or partial coverage of respective requirements. ",
            "style": "info"
          },
          "conditionalVisibility": {
            "parameterName": "Help",
            "comparison": "isEqualTo",
            "value": "Yes"
          },
          "name": "Help"
        },
        {
          "type": 1,
          "content": {
            "json": "# [Azure Security Benchmark v3](https://docs.microsoft.com/security/benchmark/azure/)\n---\n\nThe Azure Security Benchmark workbook is designed to enable Cloud Architects, Security Engineers, and Governance Risk Compliance Professionals to gain situational awareness for cloud security posture and hardening. Benchmark recommendations provide a starting point for selecting specific security configuration settings and facilitate risk reduction. The Azure Security Benchmark includes a collection of high-impact security recommendations for improving posture. This workbook provides visibility and situational awareness for security capabilities delivered with Microsoft technologies in predominantly cloud-based environments. Customer experience will vary by user and some panels may require additional configurations for operation. Recommendations do not imply coverage of respective controls as they are often one of several courses of action for approaching requirements which is unique to each customer. Recommendations should be considered a starting point for planning full or partial coverage of respective requirements."
          },
          "customWidth": "79",
          "name": "Workbook Overview"
        },
        {
          "type": 1,
          "content": {
            "json": "![Image Name](https://azure.microsoft.com/svghandler/security-center?width=300&height=157) "
          },
          "customWidth": "20",
          "name": "Microsoft Sentinel Logo"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control Area\\\": \\\"Posture Assessment\\\", \\\"tab\\\": \\\"AT\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Controls Crosswalk\\\", \\\"tab\\\": \\\"CMA\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Network Security\\\", \\\"tab\\\": \\\"NS\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Identity Management\\\", \\\"tab\\\": \\\"IM\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Privileged Access\\\", \\\"tab\\\": \\\"PA\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Data Protection\\\", \\\"tab\\\": \\\"DP\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Asset Management\\\", \\\"tab\\\": \\\"AM\\\" }\\r\\n]\",\"transformers\":null}",
            "size": 3,
            "exportMultipleValues": true,
            "exportedParameters": [
              {
                "fieldName": "tab",
                "parameterName": "Tab",
                "parameterType": 1
              }
            ],
            "queryType": 8,
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "Section",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                {
                  "columnMatch": "tab",
                  "formatter": 5
                }
              ]
            }
          },
          "customWidth": "40",
          "name": "Control Areas",
          "styleSettings": {
            "showBorder": true
          }
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "a30d01d0-38f1-4a91-9cf6-cdb181d676b5",
                "version": "KqlParameterItem/1.0",
                "name": "isATVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "AT",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                }
              },
              {
                "id": "c01e9b8b-b285-4aae-8510-68741e0315c3",
                "version": "KqlParameterItem/1.0",
                "name": "isCMAVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "CMA",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                }
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isNSVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "NS",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "d41cb044-86ef-4603-ae24-c61e864c067d"
              },
              {
                "id": "7b682fc9-cb6b-4475-a24c-41dcb43d0cef",
                "version": "KqlParameterItem/1.0",
                "name": "isIMVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "IM",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                }
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isPAVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "PA",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "15158143-a4f8-417b-90b0-123dd13f1ff5"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isDPVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "DP",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "0077d493-a27d-49d7-b49d-5888805d501e"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isAMVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "AM",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "33690532-5a73-4ac3-8fbd-6fc449a6d166"
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "customWidth": "10",
          "name": "Hidden Parameters"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Control Area\\\": \\\"Logging & Threat Detection\\\", \\\"tab\\\": \\\"LT\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Incident Response\\\", \\\"tab\\\": \\\"IR\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Posture & Vulnerability Management\\\", \\\"tab\\\": \\\"PV\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Endpoint Security\\\", \\\"tab\\\": \\\"ES\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Backup & Recovery\\\", \\\"tab\\\": \\\"BR\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"DevOps Security\\\", \\\"tab\\\": \\\"DS\\\" },\\r\\n\\t{ \\\"Control Area\\\": \\\"Governance & Strategy\\\", \\\"tab\\\": \\\"GS\\\" }\\r\\n]\",\"transformers\":null}",
            "size": 3,
            "exportMultipleValues": true,
            "exportedParameters": [
              {
                "fieldName": "tab",
                "parameterName": "Tab",
                "parameterType": 1
              }
            ],
            "queryType": 8,
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "Section",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                {
                  "columnMatch": "tab",
                  "formatter": 5
                }
              ]
            }
          },
          "customWidth": "40",
          "name": "Control Areas - Copy",
          "styleSettings": {
            "showBorder": true
          }
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "version": "KqlParameterItem/1.0",
                "name": "isLTVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "LT",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "b7db9449-1027-45a8-a5c1-2eb371722ba6"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isIRVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "IR",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "26b9ae7c-7cfe-4606-8318-d7ff172a1e1a"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isPVVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "PV",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "0ece4c93-cbf9-4b8c-a0ad-ddfa6635919a"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isESVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "ES",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "ebead9f9-b4cc-4ab4-9c06-a5d9ac643825"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isBRVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "BR",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "dcd1bbe4-4979-4459-8b8b-3d2a3f6f7783"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isDSVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "DS",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "342935cc-8a23-46f8-96a6-974808db01c5"
              },
              {
                "version": "KqlParameterItem/1.0",
                "name": "isGSVisible",
                "type": 1,
                "isHiddenWhenLocked": true,
                "criteriaData": [
                  {
                    "criteriaContext": {
                      "leftOperand": "Tab",
                      "operator": "contains",
                      "rightValType": "static",
                      "rightVal": "GS",
                      "resultValType": "static",
                      "resultVal": "true"
                    }
                  },
                  {
                    "criteriaContext": {
                      "operator": "Default",
                      "rightValType": "param",
                      "resultValType": "static",
                      "resultVal": "false"
                    }
                  }
                ],
                "timeContext": {
                  "durationMs": 86400000
                },
                "id": "a00fd6f7-5f8d-487d-948f-804ab0288aae"
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "customWidth": "10",
          "name": "Hidden Parameters - Copy"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# Assessment\r\n---\r\n\r\nThe Assessment section provides a mechanism to find, fix, and resolve ASB recommendations. The Assessment is scored by control across number of impacted assets. For example, if the \"Log Analytics agent should be installed on virtual machines\" is Passed for 3 of 5 of your virtual machines, the score is 60% for passed controls. A selector provides capability to filter by all, specific, or groups of ASB control ids. Upon selection, subordinate panels will summarize ASB recommendations by control family, status over time, recommendations, and resources identified. These panels are helpful for identifying the ASB control areas of interest, status over time, and which resources are most impacted by these vulnerabilities. The ASB Recommendation details provides a mechanism to identify specific recommendation details with deep-links to pivot to Microsoft Defender for Cloud: Regulatory Compliance for remediation. "
                },
                "customWidth": "40",
                "name": "NS Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 11"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "parameters": [
                    {
                      "id": "99a47f97-1aa4-4840-91ee-119aad6d6217",
                      "version": "KqlParameterItem/1.0",
                      "name": "ComplianceDomain",
                      "label": "Control Area",
                      "type": 2,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| extend ComplianceDomain=iff(ComplianceControl contains \"AM.\", \"Asset Management\", iff(ComplianceControl contains \"BR.\", \"Backup & Recovery\", iff(ComplianceControl contains \"DP.\", \"Data Protection\", iff(ComplianceControl contains \"DS.\", \"DevOps Security\", iff(ComplianceControl contains \"ES.\", \"Endpoint Security\", iff(ComplianceControl contains \"GS.\", \"Governance & Strategy\", iff(ComplianceControl contains \"IM.\", \"Identity Management\", iff(ComplianceControl contains \"IR.\", \"Incident Response\", iff(ComplianceControl contains \"LT.\", \"Logging & Threat Detection\", iff(ComplianceControl contains \"NS.\", \"Network Security\", iff(ComplianceControl contains \"PA.\", \"Privileged Access\", iff(ComplianceControl contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| summarize count() by ComplianceDomain\r\n| sort by count_ desc\r\n| project-away count_\r\n",
                      "crossComponentResources": [
                        "{Workspace}"
                      ],
                      "value": [
                        "value::all"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 0
                      },
                      "timeContextFromParameter": "TimeRange",
                      "defaultValue": "value::all",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces"
                    }
                  ],
                  "style": "pills",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                "customWidth": "40",
                "name": "parameters - 26"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink) on RecommendationName\r\n| extend ComplianceDomain=iff(controlId contains \"AM.\", \"Asset Management\", iff(controlId contains \"BR.\", \"Backup & Recovery\", iff(controlId contains \"DP.\", \"Data Protection\", iff(controlId contains \"DS.\", \"DevOps Security\", iff(controlId contains \"ES.\", \"Endpoint Security\", iff(controlId contains \"GS.\", \"Governance & Strategy\", iff(controlId contains \"IM.\", \"Identity Management\", iff(controlId contains \"IR.\", \"Incident Response\", iff(controlId contains \"LT.\", \"Logging & Threat Detection\", iff(controlId contains \"NS.\", \"Network Security\", iff(controlId contains \"PA.\", \"Privileged Access\", iff(controlId contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n  | distinct RecommendationName, ComplianceDomain, tostring(RecommendationLink), tostring(state), tostring(complianceState)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\" or complianceState‚ÄØ==‚ÄØ\"Failed\") by ComplianceDomain\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n    | project ControlFamily=ComplianceDomain, Total, PassedControls, Passed, Failed\r\n    | sort by Total, Passed desc",
                  "size": 0,
                  "showAnalytics": true,
                  "title": "Recommendations by Control Area",
                  "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                  "showExportToExcel": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "ComplianceDomain",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Persistence",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "Total",
                        "formatter": 22,
                        "formatOptions": {
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": [
                              {
                                "columnName": "Passed",
                                "color": "green"
                              },
                              {
                                "columnName": "Failed",
                                "color": "redBright"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "PassedControls",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      {
                        "columnMatch": "count_",
                        "formatter": 4,
                        "formatOptions": {
                          "palette": "yellowOrangeRed"
                        }
                      }
                    ],
                    "filter": true,
                    "sortBy": [
                      {
                        "itemKey": "$gen_compositeBar_Total_1",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_compositeBar_Total_1",
                      "sortOrder": 2
                    }
                  ]
                },
                "customWidth": "50",
                "name": "query - 6"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                  "size": 0,
                  "showAnalytics": true,
                  "title": "Recommendations ",
                  "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                  "showExportToExcel": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "RecommendationName",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Gear",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "Total",
                        "formatter": 22,
                        "formatOptions": {
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": [
                              {
                                "columnName": "Passed",
                                "color": "green"
                              },
                              {
                                "columnName": "Failed",
                                "color": "redBright"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "PassedControls",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      {
                        "columnMatch": "RecommendationLink",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "OpenBlade",
                          "linkLabel": "Remediate >>",
                          "linkIsContextBlade": false,
                          "bladeOpenContext": {
                            "bladeName": "RecommendationsBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "assessmentKey",
                                "source": "column",
                                "value": "name"
                              },
                              {
                                "name": "initiativeId",
                                "source": "static",
                                "value": "NIST-SP-800-53-R4"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "name",
                        "formatter": 5
                      }
                    ],
                    "filter": true
                  },
                  "sortBy": []
                },
                "customWidth": "50",
                "name": "query - 3"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend ComplianceDomain=iff(controlId contains \"AM.\", \"Asset Management\", iff(controlId contains \"BR.\", \"Backup & Recovery\", iff(controlId contains \"DP.\", \"Data Protection\", iff(controlId contains \"DS.\", \"DevOps Security\", iff(controlId contains \"ES.\", \"Endpoint Security\", iff(controlId contains \"GS.\", \"Governance & Strategy\", iff(controlId contains \"IM.\", \"Identity Management\", iff(controlId contains \"IR.\", \"Incident Response\", iff(controlId contains \"LT.\", \"Logging & Threat Detection\", iff(controlId contains \"NS.\", \"Network Security\", iff(controlId contains \"PA.\", \"Privileged Access\", iff(controlId contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n| distinct RecommendationName, resourceId, tostring(state), tostring(complianceState)\r\n| summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\") by resourceId\r\n|‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| where Failed > 0\r\n| project AssessedResourceId=resourceId, Total, PassedControls, Passed, Failed\r\n| sort by Total, Passed desc\r\n| limit 250\r\n",
                  "size": 0,
                  "showAnalytics": true,
                  "title": "Recommendations by Asset",
                  "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                  "showExportToExcel": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "AssessedResourceId",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "Total",
                        "formatter": 22,
                        "formatOptions": {
                          "compositeBarSettings": {
                            "labelText": "",
                            "columnSettings": [
                              {
                                "columnName": "Passed",
                                "color": "green"
                              },
                              {
                                "columnName": "Failed",
                                "color": "redBright"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "PassedControls",
                        "formatter": 0,
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      {
                        "columnMatch": "RecommendationName",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Gear",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "ComplianceDomain",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Persistence",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "count_",
                        "formatter": 4,
                        "formatOptions": {
                          "palette": "yellowOrangeRed"
                        }
                      }
                    ],
                    "filter": true
                  }
                },
                "customWidth": "50",
                "name": "query - 9"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| extend ComplianceDomain=iff(ComplianceControl contains \"AM.\", \"Asset Management\", iff(ComplianceControl contains \"BR.\", \"Backup & Recovery\", iff(ComplianceControl contains \"DP.\", \"Data Protection\", iff(ComplianceControl contains \"DS.\", \"DevOps Security\", iff(ComplianceControl contains \"ES.\", \"Endpoint Security\", iff(ComplianceControl contains \"GS.\", \"Governance & Strategy\", iff(ComplianceControl contains \"IM.\", \"Identity Management\", iff(ComplianceControl contains \"IR.\", \"Incident Response\", iff(ComplianceControl contains \"LT.\", \"Logging & Threat Detection\", iff(ComplianceControl contains \"NS.\", \"Network Security\", iff(ComplianceControl contains \"PA.\", \"Privileged Access\", iff(ComplianceControl contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain})\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by ComplianceDomain\r\n| render timechart ",
                  "size": 0,
                  "showAnalytics": true,
                  "title": "Recommendations over Time",
                  "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                  "timeContext": {
                    "durationMs": 604800000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "RecommendationDisplayName",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "warning",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "Severity",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "High",
                              "representation": "redBright",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Medium",
                              "representation": "orange",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Low",
                              "representation": "yellow",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "blue",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "State",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "ControlID",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "Recommendation",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "Url",
                          "linkLabel": "Go to Recommendation >"
                        }
                      }
                    ]
                  }
                },
                "customWidth": "50",
                "name": "query - 7"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend ComplianceDomain=iff(controlId contains \"AM.\", \"Asset Management\", iff(controlId contains \"BR.\", \"Backup & Recovery\", iff(controlId contains \"DP.\", \"Data Protection\", iff(controlId contains \"DS.\", \"DevOps Security\", iff(controlId contains \"ES.\", \"Endpoint Security\", iff(controlId contains \"GS.\", \"Governance & Strategy\", iff(controlId contains \"IM.\", \"Identity Management\", iff(controlId contains \"IR.\", \"Incident Response\", iff(controlId contains \"LT.\", \"Logging & Threat Detection\", iff(controlId contains \"NS.\", \"Network Security\", iff(controlId contains \"PA.\", \"Privileged Access\", iff(controlId contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ComplianceDomain in ({ComplianceDomain}) \r\n| where state‚ÄØ==‚ÄØ\"Unhealthy\"\r\n| extend FirstObserved = properties1.status.statusChangeDate\r\n| project ResourceID=resourceId, RecommendationName, ControlFamily=ComplianceDomain, ControlID=controlId, Severity=severity, State=state, RecommendationLink, name, FirstObserved\r\n| sort by tostring(Severity) asc",
                  "size": 0,
                  "showAnalytics": true,
                  "title": "Current Recommendation Details",
                  "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                  "showExportToExcel": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "ResourceID",
                        "formatter": 13,
                        "formatOptions": {
                          "linkTarget": "Resource",
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "RecommendationName",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Gear",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "ControlFamily",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Persistence",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "ControlID",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "Severity",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "High",
                              "representation": "redBright",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Medium",
                              "representation": "orange",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Low",
                              "representation": "yellow",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "blue",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "State",
                        "formatter": 1
                      },
                      {
                        "columnMatch": "Recommendation",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "OpenBlade",
                          "linkLabel": "Remediate >>",
                          "linkIsContextBlade": false,
                          "bladeOpenContext": {
                            "bladeName": "RecommendationsBlade",
                            "extensionName": "Microsoft_Azure_Security",
                            "bladeParameters": [
                              {
                                "name": "assessmentKey",
                                "source": "column",
                                "value": "name"
                              },
                              {
                                "name": "resourceId",
                                "source": "column",
                                "value": "ResourceID"
                              }
                            ]
                          }
                        }
                      },
                      {
                        "columnMatch": "name",
                        "formatter": 5
                      },
                      {
                        "columnMatch": "FirstObserved",
                        "formatter": 6
                      }
                    ],
                    "rowLimit": 5000,
                    "filter": true,
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_Severity_4",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "$gen_thresholds_Severity_4",
                      "sortOrder": 1
                    }
                  ]
                },
                "name": "query - 8"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isATVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Assessment"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# Controls Crosswalk\r\n---\r\nControls crosswalk provides a mapping of Azure Security Benchmark v3 controls across additonal compliance frameworks. This provides free-text search capabilitities mapping numerous frameworks including CIS v8, NIST SP 800-53 R4, and PCI-DSS v3. There is also a mapping for recommended Microsoft products for each of these control requiremnts. "
                },
                "customWidth": "40",
                "name": "Controls Mapping"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "let Crosswalk = datatable([\"Control Name\"]: string, [\"ASB v3\"]: string, [\"Control Area\"]: string, [\"CIS v8\"]: string, [\"NIST SP 800-53 R4\"]: string, [\"PCI-DSS v3\"]: string, [\"Recommended Products\"]: string) [\r\n\"NS-1: Establish network segmentation boundaries\",\t\"NS-1\",\t\"Network Security\",\t\"3.12 |  13.4 |  4.4\",\t\"\tAC-4 |  SC-2 |  SC-7\",\t\"1.1 |  1.2 |  1.3\",\t\"VirtualNetwork\",\r\n\"NS-2: Secure cloud services with network controls\",\t\"NS-2\",\t\"Network Security\",\t\"3.12 | 4.4\",\t\"AC-4 | SC-2 | SC-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Virtual Network | Private Link\",\r\n\"NS-3: Deploy firewall at the edge of enterprise network\",\t\"NS-3\",\t\"Network Security\",\t\"4.4 | 4.8 | 13.10\",\t\"AC-4 | SC-7 | CM-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Azure Firewall\",\r\n\"NS-4: Deploy intrusion detection/intrusion prevention systems (IDS/IPS)\",\t\"NS-4\",\t\"Network Security\",\t\"13.2 | 13.3 | 13.7 | 13.8\",\t\"SC-7 | SI-4\",\t\"11.4\",\t\"Azure Firewall | Microsoft Defender for Endpoint\",\r\n\"NS-5: Deploy DDOS protection\",\t\"NS-5\",\t\"Network Security\",\t\"13.1\",\t\"SC-5 | SC-7\",\t\"1.1 | 1.2 | 1.3 | 6.6\",\t\"Azure DDoS Protection\",\r\n\"NS-6: Deploy web application firewall\",\t\"NS-6\",\t\"Network Security\",\t\"13.1\",\t\"SC-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Azure Web Application Firewall\",\r\n\"NS-7: Simplify network security configuration\",\t\"NS-7\",\t\"Network Security\",\t\"4.4 | 4.8\",\t\"AC-4 | SC-2 | SC-7\",\t\"1.1 | 1.2 | 1.3\",\t\"Azure Firewall Manager\",\r\n\"NS-8: Detect and disable insecure services and protocols\",\t\"NS-8\",\t\"Network Security\",\t\"4.4 | 4.8\",\t\"CM-2 | CM-6 | CM-7\",\t\"4.1 | A2.1 | A2.2 | A2.3\",\t\"Microsoft Sentinel | Azure Active Directory | Microsoft Defender for Endpoint\",\r\n\"NS-9: Connect on-premises or cloud network privately\",\t\"NS-9\",\t\"Network Security\",\t\"12.7\",\t\"CA-3 | AC-17 | AC-4\",\t\"N/A\",\t\"VPN Gateway | Azure ExpressRoute | Virtual Network\",\r\n\"NS-10: Ensure Domain Name System (DNS) security\",\t\"NS-10\",\t\"Network Security\",\t\"4.9 | 9.2\",\t\"SC-20 | SC-21\",\t\"N/A\",\t\"Azure DNS\",\r\n\"IM-1: Use centralized identity and authentication system\",\t\"IM-1\",\t\"Identity Management\",\t\"6.7 | 12.5\",\t\"AC-2 | AC-3 | IA-2 | IA-8\",\t\"7.2 | 8.3\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"IM-2: Protect identity and authentication systems\",\t\"IM-2\",\t\"Identity Management\",\t\"5.4 | 6.5\",\t\"AC-2 | AC-3 | IA-2 | IA-8 | SI-4\",\t\"8.2, 8.3\",\t\"Azure Active Directory\",\r\n\"IM-3: Manage application identities securely and automatically\",\t\"IM-3\",\t\"Identity Management\",\t\"N/A\",\t\"N/A\",\t\"N/A\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"IM-4: Authenticate server and services\",\t\"IM-4\",\t\"Identity Management\",\t\"N/A\",\t\"IA-9\",\t\"N/A\",\t\"Microsoft Defender for Cloud\",\r\n\"IM-5: Use single sign-on (SSO) for application access\",\t\"IM-5\",\t\"Identity Management\",\t\"12.5\",\t\"IA-4 | IA-2 | IA-8\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"IM-6: Use strong authentication controls\",\t\"IM-6\",\t\"Identity Management\",\t\"6.3 | 6.4\",\t\"AC-2 | AC-3 | IA-2 | IA-5 | IA-8\",\t\"7.2 | 8.2 | 8.3 | 8.4\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"IM-7: Restrict resource access based on conditions\",\t\"IM-7\",\t\"Identity Management\",\t\"3.3 | 6.4 | 13.5\",\t\"AC-2 | AC-3 | AC-6\",\t\"7.2\",\t\"Azure Active Directory\",\r\n\"IM-8: Restrict the exposure of credential and secrets\",\t\"IM-8\",\t\"Identity Management\",\t\"16.9 | 16.12\",\t\"IA-5\",\t\"3.5 | 6.3 | 8.2\",\t\"Microsoft Sentinel | Azure Active Directory | Microsoft Defender for Endpoint\",\r\n\"IM-9: Secure user access to existing applications\",\t\"IM-9\",\t\"Identity Management\",\t\"6.7 | 12.5\",\t\"AC-2 | AC-3 | SC-11\",\t\"N/A\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud Apps\",\r\n\"PA-1: Separate and limit highly privileged/administrative users\",\t\"PA-1\",\t\"Privileged Access\",\t\"5.4 | 6.8\",\t\"AC-2 | AC-6\",\t\"7.1 | 7.2 | 8.1\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"PA-2: Avoid standing access for user accounts and permissions\",\t\"PA-2\",\t\"Privileged Access\",\t\"7.1 | 7.2 | 8.1\",\t\"AC-2\",\t\"N/A\",\t\"Microsoft Defender for Cloud\",\r\n\"PA-3: Manage lifecycle of identities and entitlements\",\t\"PA-3\",\t\"Privileged Access\",\t\"N/A\",\t\"AC-5 | AC-6\",\t\"7.1 | 7.2 | 8.1\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"PA-4: Review and reconcile user access regularly\",\t\"PA-4\",\t\"Privileged Access\",\t\"5.1 | 5.3 | 5.5\",\t\"5.1 | 5.3 | 5.5\",\t\"7.1 | 7.2 | 8.1 | A3.4\",\t\"Azure Active Directory\",\r\n\"PA-5: Set up emergency access\",\t\"PA-5\",\t\"Privileged Access\",\t\"N/A\",\t\"AC-2\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"PA-6: Use privileged access workstations\",\t\"PA-6\",\t\"Privileged Access\",\t\"12.8 | 13.5\",\t\"AC-2 | SC-2 | SC-7\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"PA-7: Follow just enough administration (least privilege) principles\",\t\"PA-7\",\t\"Privileged Access\",\t\"3.3 | 6.8\",\t\"AC-2 | AC-3 | AC-6\",\t\"7.1 | 7.2\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"PA-8: Determine access process for cloud provider support\",\t\"PA-8\",\t\"Privileged Access\",\t\"6.1 | 6.2\",\t\"AC-4 | AC-2 | AC-3\",\t\"N/A\",\t\"Customer Lockbox\",\r\n\"DP-1: Discover | classify | and label sensitive data\",\t\"DP-1\",\t\"Data Protection\",\t\"3.2 | 3.7 | 3.13\",\t\"RA-2 | SC-28\",\t\"A3.2\",\t\"Azure Information Protection\",\r\n\"DP-2: Monitor anomalies and threats targeting sensitive data\",\t\"DP-2\",\t\"Data Protection\",\t\"3.13\",\t\"AC-4 | SI-4\",\t\"A3.2\",\t\"Microsoft Defender for Cloud | Microsoft Sentinel\",\r\n\"DP-3: Encrypt sensitive data in transit\",\t\"DP-3\",\t\"Data Protection\",\t\"3.1\",\t\"SC-8\",\t\"3.5 | 3.6 | 4.1\",\t\"Microsoft Defender for Cloud\",\r\n\"DP-4: Enable data at rest encryption by default\",\t\"DP-4\",\t\"Data Protection\",\t\"3.11\",\t\"SC-28\",\t\"3.4 | 3.5\",\t\"Microsoft Defender for Cloud\",\r\n\"DP-5: Use customer-managed key option in data at rest encryption when required\",\t\"DP-5\",\t\"Data Protection\",\t\"3.11\",\t\"SC-12 | SC-28\",\t\"3.4 | 3.5 | 3.6\",\t\"Microsoft Defender for Cloud | Key Vault\",\r\n\"DP-6: Use a secure key management process\",\t\"DP-6\",\t\"Data Protection\",\t\"N/A\",\t\"IA-5 | SC-12 | SC-28\",\t\"3.6\",\t\"Microsoft Defender for Cloud | Key Vault\",\r\n\"DP-7: Use a secure certificate management process\",\t\"DP-7\",\t\"Data Protection\",\t\"N/A\",\t\"IA-5 | SC-12 | SC-17\",\t\"3.6\",\t\"Microsoft Defender for Cloud | Microsoft Sentinel\",\r\n\"DP-8: Ensure security of key and certificate repository\",\t\"DP-8\",\t\"Data Protection\",\t\"N/A\",\t\"IA-5 | SC-12 | SC-17\",\t\"3.6\",\t\"Microsoft Defender for Cloud | Key Vault\",\r\n\"AM-1: Track asset inventory and their risks\",\t\"AM-1\",\t\"Asset Management\",\t\"1.1 | 1.5 | 2.1 | 2.4\",\t\"CM-8 | PM-5\",\t\"2.4\",\t\"Azure Resource Graph\",\r\n\"AM-2: Use only approved services\",\t\"AM-2\",\t\"Asset Management\",\t\"2.5 | 2.6 | 2.7 | 4.8\",\t\"CM-8 | PM-5\",\t\"6.3\",\t\"Microsoft Defender for Cloud | Azure Resource Graph\",\r\n\"AM-3: Ensure security of asset lifecycle management\",\t\"AM-3\",\t\"Asset Management\",\t\"1.1 | 2.1\",\t\"CM-8 | CM-7\",\t\"2.4\",\t\"Azure Monitor\",\r\n\"AM-4: Limit access to asset management\",\t\"AM-4\",\t\"Asset Management\",\t\"3.3\",\t\"AC-3\",\t\"N/A\",\t\"Azure Active Directory\",\r\n\"AM-5: Use only approved applications in virtual machine\",\t\"AM-5\",\t\"Asset Management\",\t\"2.5 | 2.6 | 2.7 | 4.8\",\t\"CM-8 | CM-7 | CM-10 | CM-11\",\t\"6.3\",\t\"Microsoft Defender for Cloud | Azure Automation\",\r\n\"LT-1: Enable threat detection capabilities\",\t\"LT-1\",\t\"Logging & Threat Detection\",\t\"8.11\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.6 | 10.8 | A3.5\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Microsoft Defender for Cloud Apps | Azure Active Directory | Microsoft Defender for Endpoint | Microsoft Defender for Office 365\",\r\n\"LT-2: Enable threat detection for identity and access management\",\t\"LT-2\",\t\"Logging & Threat Detection\",\t\"8.11\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.6 | 10.8 | A3.5\",\t\"Microsoft Defender for Cloud | Azure Active Directory\",\r\n\"LT-3: Enable logging for security investigation\",\t\"LT-3\",\t\"Logging & Threat Detection\",\t\"8.2 | 8.5 | 8.12\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.1 | 10.2 | 10.3\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Monitor\",\r\n\"LT-4: Enable network logging for security investigation\",\t\"LT-4\",\t\"Logging & Threat Detection\",\t\"8.2 | 8.5 | 8.6 | 8.7 | 13.6\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.8\",\t\"Microsoft Defender for Cloud | Azure Firewall | Azure Web Application Firewall | Application Gateway | Virtual Network | Azure Resource Graph\",\r\n\"LT-5: Centralize security log management and analysis\",\t\"LT-5\",\t\"Logging & Threat Detection\",\t\"8.9 | 8.11 | 13.1\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"N/A\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Monitor\",\r\n\"LT-6: Configure log storage retention\",\t\"LT-6\",\t\"Logging & Threat Detection\",\t\"8.3 | 8.10\",\t\"AU-11\",\t\"10.5 | 10.7\",\t\"Microsoft Defender for Cloud | Azure Monitor\",\r\n\"LT-7: Use approved time synchronization sources\",\t\"LT-7\",\t\"Logging & Threat Detection\",\t\"8.4\",\t\"AU-8\",\t\"10.4\",\t\"Azure Active Directory Domain Services | Azure Policy | Virtual Machines\",\r\n\"IR-1: Preparation - update incident response plan and handling process\",\t\"IR-1\",\t\"Incident Response\",\t\"17.4 | 17.7\",\t\"IR-4 | IR-8\",\t\"10.8\",\t\"Microsoft Sentinel\",\r\n\"IR-2: Preparation - setup incident notification\",\t\"IR-2\",\t\"Incident Response\",\t\"17.1 | 17.3 | 17.6\",\t\"IR-4 | IR-8 | IR-5 | IR-6\",\t\"12.1\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Logic Apps\",\r\n\"IR-3: Detection and analysis - create incidents based on high-quality alerts\",\t\"IR-3\",\t\"Incident Response\",\t\"17.9\",\t\"IR-4 | IR-5 | IR-7\",\t\"10.8\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud\",\r\n\"IR-4: Detection and analysis - investigate an incident\",\t\"IR-4\",\t\"Incident Response\",\t\"N/A\",\t\"IR-4\",\t\"12.1\",\t\"Microsoft Sentinel\",\r\n\"IR-5: Detection and analysis - prioritize incidents\",\t\"IR-5\",\t\"Incident Response\",\t\"17.4 | 17.9\",\t\"IR-4\",\t\"12.1\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud\",\r\n\"IR-6: Containment | eradication and recovery - automate the incident handling\",\t\"IR-6\",\t\"Incident Response\",\t\"N/A\",\t\"IR-4 | IR-5 | IR-6\",\t\"12.1\",\t\"Microsoft Sentinel | Azure Logic Apps\",\r\n\"IR-7: Post-incident activity - conduct lesson learned and retain evidence\",\t\"IR-7\",\t\"Incident Response\",\t\"17.8\",\t\"IR-4\",\t\"12.1\",\t\"Microsoft Sentinel | Azure Logic Apps\",\r\n\"PV-1: Define and establish secure configurations\",\t\"PV-1\",\t\"Posture & Vulnerability Management\",\t\"4.1 | 4.2\",\t\"CM-2 | CM-6\",\t\"1.1\",\t\"Azure Policy | Azure Blueprints\",\r\n\"PV-2: Audit and enforce secure configurations\",\t\"PV-2\",\t\"Posture & Vulnerability Management\",\t\"4.1 | 4.2\",\t\"CM-2 | CM-6\",\t\"2.2\",\t\"Microsoft Defender for Cloud\",\r\n\"PV-3: Define and establish secure configurations for compute resources\",\t\"PV-3\",\t\"Posture & Vulnerability Management\",\t\"4.1\",\t\"CM-2 | CM-6\",\t\"2.2\",\t\"Microsoft Defender for Cloud | Azure Automation\",\r\n\"PV-4: Audit and enforce secure configurations for compute resources\",\t\"PV-4\",\t\"Posture & Vulnerability Management\",\t\"4.1\",\t\"CM-2 | CM-6\",\t\"2.2\",\t\"Microsoft Defender for Cloud\",\r\n\"PV-5: Perform vulnerability assessments\",\t\"PV-5\",\t\"Posture & Vulnerability Management\",\t\"5.5 | 7.1 | 7.5 | 7.6\",\t\"RA-3 | RA-5\",\t\"6.1 | 6.2 | 6.6\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"PV-6: Rapidly and automatically remediate vulnerabilities\",\t\"PV-6\",\t\"Posture & Vulnerability Management\",\t\"7.2 | 7.3 | 7.4 | 7.7\",\t\"RA-3 | RA-5 | SI-2\",\t\"6.1 | 6.2 | 6.5 | 11.2\",\t\"Microsoft Defender for Cloud | Azure Automation\",\r\n\"PV-7: Conduct regular red team operations\",\t\"PV-7\",\t\"Posture & Vulnerability Management\",\t\"18.1 | 18.2 | 18.3 | 18.4 | 18.5\",\t\"CA-8 | RA-5\",\t\"6.6 | 11.2 | 11.3\",\t\"Microsoft Sentinel | Microsoft 365 Compliance Manager\",\r\n\"ES-1: Use Endpoint Detection and Response (EDR)\",\t\"ES-1\",\t\"Endpoint Security\",\t\"13.7\",\t\"SC-3 | SI-2 | SI-3 | SI-16\",\t\"11.5\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"ES-2: Use modern anti-malware software\",\t\"ES-2\",\t\"Endpoint Security\",\t\"10.1\",\t\"SC-3 | SI-2 | SI-3 | SI-16\",\t\"5.1\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"ES-3: Ensure anti-malware software and signatures are updated\",\t\"ES-3\",\t\"Endpoint Security\",\t\"10.2\",\t\"SI-2 | SI-3\",\t\"5.2\",\t\"Microsoft Defender for Cloud | Microsoft Defender for Endpoint\",\r\n\"BR-1: Ensure regular automated backups\",\t\"BR-1\",\t\"Backup & Recovery\",\t\"11.2\",\t\"CP-2 | CP-4 | CP-9\",\t\"N/A\",\t\"Microsoft Defender for Cloud | Azure Backup\",\r\n\"BR-2: Protect backup and recovery data\",\t\"BR-2\",\t\"Backup & Recovery\",\t\"11.3\",\t\"CP-6 | CP-9\",\t\"3.4\",\t\"Microsoft Defender for Cloud | Azure Backup\",\r\n\"BR-3: Monitor backups\",\t\"BR-3\",\t\"Backup & Recovery\",\t\"11.3\",\t\"CP-9\",\t\"N/A\",\t\"Azure Backup | Key Vault\",\r\n\"BR-4: Regularly test backups\",\t\"BR-4\",\t\"Backup & Recovery\",\t\"11.5\",\t\"CP-4 | CP-9\",\t\"N/A\",\t\"Azure Backup | Key Vault\",\r\n\"DS-1: Conduct Threat Modeling\",\t\"DS-1\",\t\"DevOps Security\",\t\"16.10 | 16.14\",\t\"SA-15\",\t\"6.5 | 12.2\",\t\"Threat Modeling Tool | Microsoft Sentinel\",\r\n\"DS-2: Ensure Software Supply Chain Security\",\t\"DS-2\",\t\"DevOps Security\",\t\"16.4 | 16.6 | 16.11\",\t\"SA-12 | SA-15\",\t\"6.3 | 6.5\",\t\"Microsoft Defender for Cloud | GitHub\",\r\n\"DS-3: Secure DevOps Infrastructure\",\t\"DS-3\",\t\"DevOps Security\",\t\"16.7\",\t\"CM-2 | CM-6 | AC-2 | AC-3 | AC-6\",\t\"2.2 | 6.3 | 7.1\",\t\"Microsoft Sentinel\",\r\n\"DS-4: Integrate Static Application Security Testing into DevOps Pipeline\",\t\"DS-4\",\t\"DevOps Security\",\t\"16.12\",\t\"SA-11\",\t\"6.3 | 6.5\",\t\"Credential Scanner | Binskim | CodeQL | GitHub: Secret Scanning\",\r\n\"DS-5: Integrate Dynamic Application Security Testing into DevOps Pipeline\",\t\"DS-5\",\t\"DevOps Security\",\t\"16.12\",\t\"SA-11\",\t\"6.3 | 6.5\",\t\"Azure DevOps | Azure Marketplace\",\r\n\"DS-6: Enforce Security of Workload throughout DevOps Lifecycle\",\t\"DS-6\",\t\"DevOps Security\",\t\"7.5 | 7.6 | 7.7 | 16.1 | 16.7\",\t\"CM-2 | CM-6 | AC-2 | AC-3 | AC-6\",\t\"6.1 | 6.2 | 6.3\",\t\"Microsoft Defender for Cloud\",\r\n\"DS-7: Enable Logging and Monitoring in DevOps\",\t\"DS-7\",\t\"DevOps Security\",\t\"8.2 | 8.5 | 8.9 | 8.11\",\t\"AU-3 | AU-6 | AU-12 | SI-4\",\t\"10.1 | 10.2 | 10.3 | 10.6\",\t\"Microsoft Sentinel | GitHub | Azure DevOps\",\r\n\"GS-1: Align organization roles | responsibilities and accountabilities\",\t\"GS-1\",\t\"Governance & Strategy\",\t\"14.9\",\t\"PL-9 | PM-10 | PM-13 | AT-1 | AT-3\",\t\"2.4\",\t\"Azure Active Directory\",\r\n\"GS-2: Define and implement enterprise segmentation/separation of duties strategy\",\t\"GS-2\",\t\"Governance & Strategy\",\t\"3.12\",\t\"AC-4 | SC-7 | SC-2\",\t\"1.2 | 6.4\",\t\"Azure ExpressRoute | VPN Gateway | Azure Active Directory\",\r\n\"GS-3: Define and implement data protection strategy\",\t\"GS-3\",\t\"Governance & Strategy\",\t\"3.1 | 3.7 | 3.12\",\t\"AC-4 | SI-4 | SC-8 | SC-12 | SC-17 | SC-28 | RA-2\",\t\"3.1 | 3.2 | 3.3 | 3.4 | 3.5 | 3.6 | 3.7 | 4.1 | A3.2\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Information Protection | Microsoft Defender for Endpoint | Microsoft 365 Defender | Microsoft Defender for Office 365 | Microsoft Cloud App Security\",\r\n\"GS-4: Define and implement network security strategy\",\t\"GS-4\",\t\"Governance & Strategy\",\t\"12.2 | 12.4\",\t\"AC-4 | AC-17 | CA-3 | CM-1 | CM-2 | CM-6 | CM-7 | SC-1 | SC-2 | SC-5 | SC-7 | SC-20 | SC-21 | SI-4\",\t\"1.1 | 1.2 | 1.3 | 1.5 | 4.1 | 6.6 | 11.4 | A2.1 | A2.2 | A2.3 | A3.2\",\t\"Virtual Network | Azure Firewall | Azure Web Application Firewall\",\r\n\"GS-5: Define and implement security posture management strategy\",\t\"GS-5\",\t\"Governance & Strategy\",\t\"4.1 | 4.2\",\t\"CA-1 | CA-8 | CM-1 | CM-2 | CM-6 | RA-1 | RA-3 | RA-5 | SI-1 | SI-2 | SI-5\",\t\"1.1 | 1.2 | 2.2 | 6.1 | 6.2 | 6.5 | 6.6 | 11.2 | 11.3 | 11.5\",\t\"Microsoft Defender for Cloud\",\r\n\"GS-6: Define and implement identity and privileged access strategy\",\t\"GS-6\",\t\"Governance & Strategy\",\t\"5.6 | 6.5 | 6.7\",\t\"AC-1 | AC-2 | AC-3 | AC-4 | AC-5 | AC-6 | IA-1 | IA-2 | IA-4 | IA-5 | IA-8 | IA-9 | SI-4\",\t\"7.1 | 7.2 | 7.3 | 8.1 | 8.2 | 8.3 | 8.4 | 8.5 | 8.6 | 8.7 | 8.8 | A3.4\",\t\"Azure Active Directory\",\r\n\"GS-7: Define and implement logging | threat detection and incident response strategy\",\t\"GS-7\",\t\"Governance & Strategy\",\t\"8.1 | 13.1 | 17.2 | 17.4 | 17.7\",\t\"AU-1 | IR-1 | IR-2 | IR-10 | SI-1 | SI-5\",\t\"10.1 | 10.2 | 10.3 | 10.4 | 10.5 | 10.6 | 10.7 | 10.8 | 10.9 | 12.10 | A3.5\",\t\"Microsoft Sentinel | Microsoft Defender for Cloud | Azure Monitor\",\r\n\"GS-8: Define and implement backup and recovery strategy\",\t\"GS-8\",\t\"Governance & Strategy\",\t\"11.1\",\t\"CP-1 | CP-9 | CP-10\",\t\"3.4\",\t\"Azure Backup\",\r\n\"GS-9: Define and implement endpoint security strategy\",\t\"GS-9\",\t\"Governance & Strategy\",\t\"4.4 | 10.1\",\t\"SI-2 | SI-3 | SC-3\",\t\"5.1 | 5.2 | 5.3 | 5.4 | 11.5\",\t\"Microsoft Defender for Endpoint | Microsoft Defender for Cloud\",\r\n\"GS-10: Define and implement DevOps security strategy\",\t\"GS-10\",\t\"Governance & Strategy\",\t\"4.1 | 4.2 | 16.1 | 16.2\",\t\"SA-12 | SA-15 | CM-1 | CM-2 | CM-6 | AC-2 | AC-3 | AC-6 | SA-11 | AU-6 | AU-12 | SI-4\",\t\"2.2 | 6.1 | 6.2 | 6.3 | 6.5 | 7.1 | 10.1 | 10.2 | 10.3 | 10.6 | 12.2\",\t\"GitHub | Azure DevOps\"\r\n];\r\nCrosswalk\r\n| project [\"Control Name\"], [\"Control Area\"], [\"Recommended Products\"], [\"NIST SP 800-53 R4\"], [\"CIS v8\"],[\"PCI-DSS v3\"]",
                  "size": 0,
                  "showAnalytics": true,
                  "showExportToExcel": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Control Name",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Persistence",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "Recommended Products",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      }
                    ],
                    "filter": true
                  }
                },
                "name": "query - 1"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isCMAVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Controls Mapping"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Network Security (NS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security)\r\n---\r\n\r\nNetwork Security covers controls to secure and protect Azure networks, including securing virtual networks, establishing private connections, preventing and mitigating external attacks, and securing DNS. "
                },
                "customWidth": "40",
                "name": "NS Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 11"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "NS-1",
                      "linkTarget": "step",
                      "linkLabel": "NS-1: Establish network segmentation boundaries",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "NS-2",
                      "linkTarget": "step",
                      "linkLabel": "NS-2: Secure cloud services with network controls",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "NS-3",
                      "linkTarget": "step",
                      "linkLabel": "NS-3: Deploy firewall at the edge of enterprise network",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "NS-4",
                      "linkTarget": "step",
                      "linkLabel": "NS-4: Deploy intrusion detection/intrusion prevention systems (IDS/IPS)",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                      "cellValue": "NS-5",
                      "linkTarget": "step",
                      "linkLabel": "NS-5: Deploy DDOS protection",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                      "cellValue": "NS-6",
                      "linkTarget": "step",
                      "linkLabel": "NS-6: Deploy web application firewall",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "b212a060-9b1c-46e1-a411-e01924d0e4ee",
                      "cellValue": "NS-7",
                      "linkTarget": "step",
                      "linkLabel": "NS-7: Simplify network security configuration",
                      "preText": "Go to >",
                      "postText": "",
                      "style": "link"
                    },
                    {
                      "id": "3dbd8c13-3aac-41cc-aebb-fd7559b5c044",
                      "cellValue": "NS-8",
                      "linkTarget": "step",
                      "linkLabel": "NS-8: Detect and disable insecure services and protocols",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "c8a9f3d2-f79c-4eee-bddc-fd2cb925466a",
                      "cellValue": "NS-9",
                      "linkTarget": "step",
                      "linkLabel": "NS-9: Connect on-premises or cloud network privately",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "a4ae56b8-85fc-4f8f-9fa1-8a13597ab962",
                      "cellValue": "NS-10",
                      "linkTarget": "step",
                      "linkLabel": "NS-10: Ensure Domain Name System (DNS) security",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "conditionalVisibility": {
                  "parameterName": "isNSVisible",
                  "comparison": "isEqualTo",
                  "value": "true"
                },
                "name": "NS Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-1: Establish Network Segmentation Boundaries](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-1-establish-network-segmentation-boundaries)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Azure Virtual Network concepts and best practices](https://docs.microsoft.com/azure/virtual-network/concepts-and-best-practices)<br>\r\nüí° [Add, change, or delete a virtual network subnet](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-subnet)<br>\r\nüí° [How to create a network security group with security rules](https://docs.microsoft.com/azure/virtual-network/tutorial-filter-network-traffic)<br>\r\nüí° [Understand and use application security groups](https://docs.microsoft.com/azure/virtual-network/network-security-groups-overview#application-security-groups)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\nüîÄ [Application Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FapplicationSecurityGroups)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.12, 13.4, 4.4](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, CA-3, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.1\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"NS.1\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"securitygroups\" or type contains \"network\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "  Network Assets & Infrastructure",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 7"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDiagnostics\r\n| where Category == \"NetworkSecurityGroupRuleCounter\"\r\n| summarize\r\n    Deny‚ÄØ=‚ÄØcountif(type_s == \"block\"),\r\n    Allow‚ÄØ=‚ÄØcountif(type_s == \"allow\"),\r\n    Total‚ÄØ=‚ÄØcountif(type_s == \"allow\" or type_s == \"block\")\r\n    by ruleName_s, ResourceId\r\n| project RuleName=ruleName_s, ResourceId, Total, Allow, Deny\r\n| sort by Total desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Network Security Group Rules by Action Count",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RuleName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "BlankDashboard",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Allow",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Deny",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 7 - Copy",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "NS-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-2: Secure Cloud Services with Network Controls](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-2-secure-cloud-services-with-network-controls)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Private Link](https://azure.microsoft.com/services/private-link/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Understand Azure Private Link](https://docs.microsoft.com/azure/private-link/private-link-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Private Link](https://portal.azure.com/#blade/Microsoft_Azure_Network/PrivateLinkCenterBlade/overview)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.12, 4.4](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SC-2, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"NS.2\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"private\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Private Links",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": " Private Links"
                    }
                  ]
                },
                "name": "NS-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-3: Deploy Firewall at the Edge of Enterprise Network](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-3-deploy-firewall-at-the-edge-of-enterprise-network)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall](https://azure.microsoft.com/services/azure-firewall/)<br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to deploy Azure Firewall](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal)<br>\r\nüí° [Virtual network traffic routing](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.4, 4.8, 13.10](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SC-7, CM-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.3\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"NS.3\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"firewall\" and type !contains \"web\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Firewalls",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": " Firewalls"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "//reference list posted here : https://docs.microsoft.com/azure/data-explorer/kusto/query/ipv4-lookup-plugin\r\nlet geoData = externaldata\r\n(network:string,geoname_id:string,continent_code:string,continent_name:string,\r\ncountry_iso_code:string,country_name:string,is_anonymous_proxy:string,is_satellite_provider:string)\r\n[@\"https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv\"] with (ignoreFirstRecord=true, format=\"csv\");\r\nlet materializedData =\r\n(\r\nAzureDiagnostics\r\n| where Category == \"AzureFirewallNetworkRule\"\r\n| where OperationName <> \"AzureFirewallThreatIntelLog\"\r\n| where OperationName <> \"AzureFirewallIDSLog\"\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n| project msg_s, Resource, TimeGenerated,ResourceId , ResourceGroup , SubscriptionId);\r\nunion\r\n(\r\n// Azure Firewall Networking - Standard Log\r\nmaterializedData\r\n| where msg_s !has \"Type=\" and msg_s !has \"DNAT'ed\" and msg_s !has \"Rule Collection:\" and msg_s !has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \". Action: \" Action\r\n),\r\n(\r\n// Azure Firewall Networking with ICMP\r\nmaterializedData\r\n| where msg_s has \"Type=\"\r\n| parse msg_s with Protocol \" Type=\" ICMPType \" request from \" SourceIP \" to \" DestinationIP \". Action: \" Action\r\n),\r\n(\r\n// Azure Firewall Networking DNAT rule - Standard\r\nmaterializedData\r\n| where msg_s has \"DNAT'ed\" and msg_s !has \". Rule Collection:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \" was \" Action \" to \" NatDestination\r\n),\r\n(\r\n// Azure Firewall Networking DNAT rule (firewall not using policy)\r\nmaterializedData\r\n| where msg_s has \"DNAT'ed\" and msg_s has \". Rule Collection:\" and msg_s !has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \" was \" Action \" to \" NatDestination \". Rule Collection: \" RuleCollection \". Rule: \" Rule\r\n),\r\n(\r\n// Azure Firewall Networking DNAT rule (firewall using policy)\r\nmaterializedData\r\n| where msg_s has \"DNAT'ed\" and msg_s has \". Rule Collection:\" and msg_s has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \" was \" Action \" to \" NatDestination \". Policy: \" Policy \". Rule Collection Group:\" RuleCollectionGroup \". Rule Collection: \" RuleCollection \". Rule: \" Rule\r\n),\r\n(\r\n// Azure Firewall Network rule (firewall not using policy)\r\nmaterializedData\r\n| where msg_s has \"Rule Collection:\" and msg_s !has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \". Action: \" Action \". Rule Collection: \" RuleCollection \". Rule Name: \" Rule\r\n),\r\n(\r\n// Azure Firewall Network rule (firewall using policy)\r\nmaterializedData\r\n| where msg_s has \"Policy:\"\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestinationIP \":\" DestinationPort \". Action: \" Action \". Policy:\" Policy \". Rule Collection Group:\" RuleCollectionGroup \". Rule Collection: \" RuleCollection \". Rule Name: \" Rule\r\n)\r\n| summarize by TimeGenerated,Protocol, ICMPType, Action,SourceIP, SourcePort, DestinationIP , DestinationPort , NatDestination, ResourceId , ResourceGroup , SubscriptionId\r\n| evaluate ipv4_lookup (geoData, DestinationIP,  network, false)\r\n| project ResourceId, Action, Protocol, SourceIP, SourcePort, DestinationIP, DestinationPort, country_name,TimeGenerated \r\n| sort by TimeGenerated desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Azure Firewall Traffic",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Action",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "contains",
                                    "thresholdValue": "Allow",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "contains",
                                    "thresholdValue": "Deny",
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "1",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RuleName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "BlankDashboard",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Allow",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Deny",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "NS-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [Deploy intrusion detection/intrusion prevention systems (IDS/IPS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-4-deploy-intrusion-detectionintrusion-prevention-systems-idsips)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) <br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Defender for Endpoint]( https://www.microsoft.com/microsoft-365/security/endpoint-defender)  <br> \r\n\r\n### Implementation\r\nüí° [Azure Firewall IDPS](https://docs.microsoft.com/azure/firewall/premium-features#idps)<br>\r\nüí° [Microsoft Defender for Endpoint capability](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/overview-endpoint-detection-response)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v8 IDs\r\n[13.2, 13.3, 13.7, 13.8](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-7, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[11.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDiagnostics\r\n| where ResourceType == \"AZUREFIREWALLS\"\r\n| where OperationName == \"AzureFirewallIDSLog\"\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n| parse msg_s with Protocol \" request from \" SourceIP \":\" SourcePort \" to \" DestIP \":\" DestPort \". Action: \" Action \". Signature: \" SignatureID \". IDS:\" Message \". Priority:\" Priority \". Classification:\" Classification\r\n| project Action, SignatureID, Message, Protocol, SourceIP, SourcePort, DestIP, DestPort, TimeGenerated\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " IDS/IPS Actions (Azure Firewall)",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Action",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 7"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where ProviderName contains \"MDATP\"\r\n| project DisplayName, AlertType, AlertSeverity, CompromisedEntity, Tactics, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Endpoint Detection & Response Alerts (Microsoft Defender for Endpoint)",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "DisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "NS-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-5: Deploy DDOS protection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-5-deploy-ddos-protection)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter)üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure DDoS Protection](https://azure.microsoft.com/services/ddos-protection/)<br> \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Manage Azure DDoS Protection Standard using the Azure portal](https://docs.microsoft.com/azure/virtual-network/manage-ddos-protection)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [DDoS Protection Plans](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[13.10](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-5, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3, 6.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.5\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"dos\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Azure DDoS Plans",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Rule",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDiagnostics\r\n| where Category == \"DDoSMitigationReports\"\r\n| sort by TimeGenerated desc\r\n| extend TopAttackVector = tostring(parse_json(AttackVectors_s)[0]) \r\n| extend Total_packets_ = tostring(parse_json(TrafficOverview_s).Total_packets) \r\n| extend Total_packets_dropped_ = todouble(parse_json(TrafficOverview_s).Total_packets_dropped)\r\n| extend TotalPackets =todouble(Total_packets_)\r\n| where TotalPackets > 0\r\n| where TopAttackVector <> \"\"\r\n| project TopAttackVector , TotalPackets, TotalPacketsDropped = Total_packets_dropped_ , ResourceId , IPAddress, TimeGenerated\r\n| sort by TotalPackets desc\r\n| limit 250\r\n\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " DDoS Attacks (Azure DDoS)",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "TopAttackVector",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "TotalPackets",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "orange"
                              }
                            },
                            {
                              "columnMatch": "TotalPacketsDropped",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "redBright"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5 - Copy",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "NS-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-6: Deploy web application firewall](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-6-deploy-web-application-firewall)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter)üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Web Application Firewall](https://azure.microsoft.com/services/web-application-firewall/)<br> \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to deploy Azure WAF](https://docs.microsoft.com/azure/web-application-firewall/overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Web Application Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[13.10](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.6\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"webapplicationfirewall\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Web Application Firewalls",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Rule",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let FakeData = (datatable (Message: string, ruleName_s: string, clientIp_s: string, clientIP_s: string, action_s: string, transactionId_s: string, trackingReference_s: string) [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]);\r\nFakeData\r\n| union AzureDiagnostics\r\n| where (ResourceType == \"APPLICATIONGATEWAYS\" or ResourceType == \"FRONTDOORS\" or ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\") and (\"Application Gateway\" == \"All\" or (ResourceType == \"APPLICATIONGATEWAYS\" and \"Application Gateway\" contains \"application gateway\") or (ResourceType == \"FRONTDOORS\" and \"Application Gateway\" contains \"azure front door\") or (ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\" and \"Application Gateway\" contains \"cdn\")) and (\"SOC-NS-AG-WAFV2 - 1129440\" == \"All\" or Resource in ('SOC-NS-AG-WAFV2'))\r\n| where Category == \"FrontdoorWebApplicationFirewallLog\" or OperationName == \"ApplicationGatewayFirewall\" or Category == \"WebApplicationFirewallLogs\"\r\n| extend Action = iif(action_s == \"Blocked\", Action = \"Block\", action_s)\r\n| extend Action = iif(Action == \"Detected\", Action = \"Log\", Action)\r\n| where '*' == Action or '*' == \"*\" \r\n| where '*' == requestUri_s or '*' == \"*\"\r\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\r\n| extend Rule= iif(Rule contains \"Mandatory rule. Cannot be disabled.\", strcat_array(split(Rule, \"Mandatory rule. Cannot be disabled. Inbound \", 1), \"\"), Rule) // Removes initial component for mandatory rule \r\n| extend Rule = iif(Rule contains \"Total Inbound Score\", strcat_array(array_concat(split(Rule, \" - SQLI=\", 0), parse_json('[\") -\"]'), split(Rule, \"):\", 1)), \"\"), Rule) // Removes smaller information if more info is available for anomaly score\r\n| summarize count() by Rule\r\n| top 50 by count_ desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Web Application Firewall Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Rule",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "NS-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-7: Simplify network security configuration](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-7-simplify-network-security-configuration)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Adaptive Network Hardening in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-adaptive-network-hardening)<br>\r\nüí° [Azure Firewall Manager](https://docs.microsoft.com/azure/firewall-manager/overview)<br>\r\nüí° [Create an Azure Firewall and a firewall policy - ARM template](https://docs.microsoft.com/azure/firewall-manager/quick-firewall-policy)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.4, 4.8](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SC-2, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.7\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "NS-7",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-8: Detect and disable insecure services and protocols](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-8-detect-and-disable-insecure-services-and--protocols)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Microsoft Sentinel insecure protocols workbook](https://docs.microsoft.com/azure/sentinel/quickstart-get-visibility#use-built-in-workbooks)<br>\r\nüí° [Conditional Access: Block legacy authentication](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-policy-block-legacy)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure AD: Conditional Access](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ConditionalAccessBlade/Policies)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.4, 4.8](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6, CM-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[4.1, A2.1, A2.2, A2.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.8\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\r\nlet legacyAuth = SigninLogs\r\n| where ResultType == 0\r\n| where ClientAppUsed !contains \"Browser\" and ClientAppUsed !contains \"Mobile Apps and Desktop clients\"\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\"AAD Legacy Auth\";\r\nSecurityEvent\r\n| parse EventData with * '\"TicketEncryptionType\">' TicketEncryptionType '<' *\r\n| union Event\r\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \"0x12\" and TicketEncryptionType != \"0x11\") or ((EventLog =~ \"System\" and Source =~ \"NETLOGON\") and EventID in (scEvents))\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\r\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\r\n| extend Protocol = case(EventID == 4776, \"WDigest\", EventID == 4768 or EventID == 4769, \"Weak Kerberos Cipher\", EventID == 2889, \"Insecure LDAP\", EventID == 4624, \"NTLM v1\", EventID == 3000, \"SMBv1\", EventID in (scEvents), \"Vulnerable Secure Channel\", \"Unknown\")\r\n| project Protocol, Count, TimeGenerated\r\n| union legacyAuth\r\n| sort by Count desc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Insecure Protocols Count over Time (Azure Active Directory)",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-S",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "visualization": "barchart",
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            },
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5 - Copy",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\r\nlet legacyAuth = SigninLogs\r\n| where ResultType == 0\r\n| where ClientAppUsed !contains \"Browser\" and ClientAppUsed !contains \"Mobile Apps and Desktop clients\"\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\"AAD Legacy Auth\", UserPrincipalName;\r\nSecurityEvent\r\n| parse EventData with * '\"TicketEncryptionType\">' TicketEncryptionType '<' *\r\n| union Event\r\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \"0x12\" and TicketEncryptionType != \"0x11\") or ((EventLog =~ \"System\" and Source =~ \"NETLOGON\") and EventID in (scEvents))\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID), Account\r\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\r\n| extend Protocol = case(EventID == 4776, \"WDigest\", EventID == 4768 or EventID == 4769, \"Weak Kerberos Cipher\", EventID == 2889, \"Insecure LDAP\", EventID == 4624, \"NTLM v1\", EventID == 3000, \"SMBv1\", EventID in (scEvents), \"Vulnerable Secure Channel\", \"Unknown\")\r\n| project Protocol, Count, Account, TimeGenerated\r\n| union legacyAuth\r\n| sort by Count desc\r\n| project Protocol, Count, TimeGenerated, UserPrincipalName, Account\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Insecure Protocol Details",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-S",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "visualization": "table",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Protocol",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "redBright"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            },
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "NS-8",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-9: Connect on-premises or cloud network privately](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-9-connect-on-premises-or-cloud-network-privately)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [VPN Gateway](https://azure.microsoft.com/services/vpn-gateway/) ‚ú≥Ô∏è [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/)<br> \r\n\r\n### Implementation\r\nüí° [Azure VPN overview](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways)<br>\r\nüí° [What are the ExpressRoute connectivity models](https://docs.microsoft.com/azure/expressroute/expressroute-connectivity-models)<br>\r\nüí° [Virtual network peering](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Virtual Network Gateways](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworkGateways)<br>\r\nüîÄ [ExpressRoute](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FexpressRouteCircuits)<br>\r\nüîÄ [Peerings](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Peering%2Fpeerings)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[12.7](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CA-3, AC-17, AC-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"express\" or type contains \"gateway\" or type contains \"peer\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Gateways, ExpressRoutes, Peerings",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Rule",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "NS-9",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [NS-10: Ensure Domain Name System (DNS) security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security#ns-10-ensure-domain-name-system-dns-security)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure DNS](https://azure.microsoft.com/services/dns/) <br>\r\n\r\n### Implementation\r\nüí° [Azure DNS overview](https://docs.microsoft.com/azure/dns/dns-overview)<br>\r\nüí° [Secure Domain Name System (DNS) Deployment Guide](https://csrc.nist.gov/publications/detail/sp/800-81/2/final)<br>\r\nüí° [Azure Private DNS](https://docs.microsoft.com/azure/dns/private-dns-overview)<br>\r\nüí° [Azure Defender for DNS](https://docs.microsoft.com/azure/security-center/defender-for-dns-introduction)<br>\r\nüí° [Prevent dangling DNS entries and avoid subdomain takeover](https://docs.microsoft.com/azure/security/fundamentals/subdomain-takeover)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [DNS Zones](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FdnsZones)<br>\r\nüîÄ [Private DNS Zones](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FprivateDnsZones)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.9, 9.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-20, SC-21](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[\tN/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "NS-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"NS.10\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"dns\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " DNS Assets",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| search \"DNS\"\r\n| summarize count() by AlertName\r\n| render piechart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " DNS Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Link to Alert >"
                              }
                            },
                            {
                              "columnMatch": "DisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isNSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "NS-10",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isNSVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Network Security (NS)"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [Identity Management (IM)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management) \r\n---\r\n\r\nIdentity Management covers controls to establish a secure identity and access controls using Azure Active Directory, including the use of single sign-on, strong authentications, managed identities (and service principles) for applications, conditional access, and account anomalies monitoring. "
                      },
                      "customWidth": "40",
                      "name": "IM Guide"
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": ""
                      },
                      "customWidth": "10",
                      "name": "text - 2"
                    },
                    {
                      "type": 11,
                      "content": {
                        "version": "LinkItem/1.0",
                        "style": "list",
                        "links": [
                          {
                            "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                            "cellValue": "IM-1",
                            "linkTarget": "step",
                            "linkLabel": "IM-1: Use centralized identity and authentication system",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "43efc249-93bd-4967-99bd-3eea2fc35750",
                            "cellValue": "IM-2",
                            "linkTarget": "step",
                            "linkLabel": "IM-2: Protect identity and authentication systems",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                            "cellValue": "IM-3",
                            "linkTarget": "step",
                            "linkLabel": "IM-3: Manage application identities securely and automatically",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                            "cellValue": "IM-4",
                            "linkTarget": "step",
                            "linkLabel": "IM-4: Authenticate server and services",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                            "cellValue": "IM-5",
                            "linkTarget": "step",
                            "linkLabel": "IM-5: Use single sign-on (SSO) for application access",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                            "cellValue": "IM-6",
                            "linkTarget": "step",
                            "linkLabel": "IM-6: Use strong authentication controls",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                            "cellValue": "IM-7",
                            "linkTarget": "step",
                            "linkLabel": "IM-7: Restrict resource access based on conditions",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "b212a060-9b1c-46e1-a411-e01924d0e4ee",
                            "cellValue": "IM-8",
                            "linkTarget": "step",
                            "linkLabel": "IM-8: Restrict the exposure of credential and secrets",
                            "preText": "Go to >",
                            "style": "link"
                          },
                          {
                            "id": "3954d6c6-b445-4ea7-9953-446c1bab3e08",
                            "cellValue": "IM-9",
                            "linkTarget": "step",
                            "linkLabel": "IM-9: Secure user access to existing applications",
                            "preText": "Go to >",
                            "style": "link"
                          }
                        ]
                      },
                      "customWidth": "40",
                      "name": "IM Steps"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-1: Standardize Azure Active Directory as the Central Identity and Authentication System](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-1-use-centralized-identity-and-authentication-system)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Active Directory]( https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Implementation\r\nüí° [Tenancy in Azure AD](https://docs.microsoft.com/azure/active-directory/develop/single-and-multi-tenant-apps)<br>\r\nüí° [How to Create and Configure an Azure AD Instance](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-access-create-new-tenant)<br>\r\nüí° [Define Azure AD Tenants](https://azure.microsoft.com/resources/securing-azure-environments-with-azure-active-directory/)<br>\r\nüí° [Use External Identity Providers for An Application](https://docs.microsoft.com/azure/active-directory/external-identities/identity-providers)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[16.7, 12.5](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, IA-2, IA-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[7.2, 8.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-1",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"IM.1\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Recommendations ",
                              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Gear",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "Total",
                                    "formatter": 22,
                                    "formatOptions": {
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": [
                                          {
                                            "columnName": "Passed",
                                            "color": "green"
                                          },
                                          {
                                            "columnName": "Failed",
                                            "color": "redBright"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "PassedControls",
                                    "formatter": 0,
                                    "numberFormat": {
                                      "unit": 1,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "OpenBlade",
                                      "linkLabel": "Remediate >>",
                                      "linkIsContextBlade": false,
                                      "bladeOpenContext": {
                                        "bladeName": "RecommendationsBlade",
                                        "extensionName": "Microsoft_Azure_Security",
                                        "bladeParameters": [
                                          {
                                            "name": "assessmentKey",
                                            "source": "column",
                                            "value": "name"
                                          },
                                          {
                                            "name": "initiativeId",
                                            "source": "static",
                                            "value": "NIST-SP-800-53-R4"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "name",
                                    "formatter": 5
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": [],
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Failed",
                                    "color": "redBright"
                                  },
                                  {
                                    "seriesName": "Passed",
                                    "color": "green"
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 3"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "AzureActivity\r\n| where Caller <> \"\"\r\n| extend UserPrincipalName = Caller\r\n| join (SigninLogs) on UserPrincipalName\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\",UserId)\r\n| summarize count() by UserPrincipalName, UserProfile\r\n| sort by count_ desc\r\n| take 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " User Action Count",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserProfile",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go To AAD UserProfile >>"
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 3"
                          }
                        ]
                      },
                      "name": "IM-1",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-2: Protect identity and authentication systems](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management?WT.mc_id=Portal-fx#im-2-protect-identity-and-authentication-systems)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) üî∑ [AADUserRiskEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aaduserriskevents) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Implementation\r\nüí° [What is the identity secure score in Azure AD](https://docs.microsoft.com/azure/active-directory/fundamentals/identity-secure-score)<br>\r\nüí° [Best Practices for Securing Active Directory](https://docs.microsoft.com/windows-server/identity/ad-ds/plan/security-best-practices/best-practices-for-securing-active-directory)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[5.4, 6.5](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, IA-2, IA-8, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[8.2, 8.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-1",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "AuditLogs\r\n| where OperationName contains \"PIM\"\r\n| distinct OperationName, Identity, AADOperationType, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Privileged Identity Management (PIM) Actions",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "GrantedTo",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Person",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "UserProfile",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go To: AAD Profile >"
                                    }
                                  },
                                  {
                                    "columnMatch": "OperationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "pending",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 2",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "AADUserRiskEvents\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\",UserId)\r\n| project UserPrincipalName, UserProfile, Activity, RiskEventType, RiskLevel, RiskState, Location, TimeGenerated\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Azure Active Directory: User Risk Events",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserProfile",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go To: AAD Profile >"
                                    }
                                  },
                                  {
                                    "columnMatch": "RiskLevel",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "colors",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "high",
                                          "representation": "redBright",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "medium",
                                          "representation": "orange",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "low",
                                          "representation": "yellow",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "blue",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "GrantedTo",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Person",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "OperationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "pending",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "name": "query - 2 - Copy"
                          }
                        ]
                      },
                      "name": "IM-2",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-3: Manage application identities securely and automatically](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-3-manage-application-identities-securely-and-automatically)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AADManagedIdentitySignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadmanagedidentitysigninlogs) üî∑ [AADServicePrincipalSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadserviceprincipalsigninlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Implementation\r\nüí° [Azure Managed Identities](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)<br>\r\nüí° [Services that Support Managed Identities for Azure Resources](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities)<br>\r\nüí° [Azure Service Principal](https://docs.microsoft.com/powershell/azure/create-azure-service-principal-azureps)<br>\r\nüí° [Create a Service Principal with Certificates](https://docs.microsoft.com/azure/active-directory/develop/howto-authenticate-service-principal-powershell)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\nüîÄ [Managed Identities](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities)<br>\r\nüîÄ [App Registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)<br>\r\n\r\n### CIS Controls v8 IDs\r\nN/A\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, IA-4, IA-5, IA-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-2",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"IM.3\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Recommendations ",
                              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Gear",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "Total",
                                    "formatter": 22,
                                    "formatOptions": {
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": [
                                          {
                                            "columnName": "Passed",
                                            "color": "green"
                                          },
                                          {
                                            "columnName": "Failed",
                                            "color": "redBright"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "PassedControls",
                                    "formatter": 0,
                                    "numberFormat": {
                                      "unit": 1,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "OpenBlade",
                                      "linkLabel": "Remediate >>",
                                      "linkIsContextBlade": false,
                                      "bladeOpenContext": {
                                        "bladeName": "RecommendationsBlade",
                                        "extensionName": "Microsoft_Azure_Security",
                                        "bladeParameters": [
                                          {
                                            "name": "assessmentKey",
                                            "source": "column",
                                            "value": "name"
                                          },
                                          {
                                            "name": "initiativeId",
                                            "source": "static",
                                            "value": "NIST-SP-800-53-R4"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "name",
                                    "formatter": 5
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": [],
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Failed",
                                    "color": "redBright"
                                  },
                                  {
                                    "seriesName": "Passed",
                                    "color": "green"
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 3"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"IM.3\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Current Recommendation Details",
                              "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "ResourceID",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": "Resource",
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Gear",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "ControlFamily",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Persistence",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "ControlID",
                                    "formatter": 1
                                  },
                                  {
                                    "columnMatch": "Severity",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "colors",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "High",
                                          "representation": "redBright",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "Medium",
                                          "representation": "orange",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "Low",
                                          "representation": "yellow",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "blue",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "State",
                                    "formatter": 1
                                  },
                                  {
                                    "columnMatch": "Recommendation",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "OpenBlade",
                                      "linkLabel": "Remediate >>",
                                      "linkIsContextBlade": false,
                                      "bladeOpenContext": {
                                        "bladeName": "RecommendationsBlade",
                                        "extensionName": "Microsoft_Azure_Security",
                                        "bladeParameters": [
                                          {
                                            "name": "assessmentKey",
                                            "source": "column",
                                            "value": "name"
                                          },
                                          {
                                            "name": "resourceId",
                                            "source": "column",
                                            "value": "ResourceID"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "name",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "FirstObserved",
                                    "formatter": 6
                                  }
                                ],
                                "filter": true,
                                "sortBy": [
                                  {
                                    "itemKey": "$gen_thresholds_Severity_4",
                                    "sortOrder": 1
                                  }
                                ]
                              },
                              "sortBy": [
                                {
                                  "itemKey": "$gen_thresholds_Severity_4",
                                  "sortOrder": 1
                                }
                              ]
                            },
                            "name": "query - 8"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "AADManagedIdentitySignInLogs\r\n| summarize count() by ServicePrincipalName\r\n| sort by count_ desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Managed Identity Actions",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "ServicePrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "uninitialized",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": []
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 5",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "AADServicePrincipalSignInLogs \r\n| summarize count() by ServicePrincipalName\r\n| sort by count_ desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Service Principal Actions",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "ServicePrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "uninitialized",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": []
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 4",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          }
                        ]
                      },
                      "name": "IM-3",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-4: Authenticate server and services](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-4-authenticate-server-and-services)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityrecommendation) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Enforce Transport Layer Security (TLS) for a storage account](https://docs.microsoft.com/azure/storage/common/transport-layer-security-configure-minimum-version?tabs=portal#use-azure-policy-to-enforce-the-minimum-tls-version)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-4",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where RecommendationName contains \"TLS\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Recommendations ",
                              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Gear",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "Total",
                                    "formatter": 22,
                                    "formatOptions": {
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": [
                                          {
                                            "columnName": "Passed",
                                            "color": "green"
                                          },
                                          {
                                            "columnName": "Failed",
                                            "color": "redBright"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "PassedControls",
                                    "formatter": 0,
                                    "numberFormat": {
                                      "unit": 1,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "OpenBlade",
                                      "linkLabel": "Remediate >>",
                                      "linkIsContextBlade": false,
                                      "bladeOpenContext": {
                                        "bladeName": "RecommendationsBlade",
                                        "extensionName": "Microsoft_Azure_Security",
                                        "bladeParameters": [
                                          {
                                            "name": "assessmentKey",
                                            "source": "column",
                                            "value": "name"
                                          },
                                          {
                                            "name": "initiativeId",
                                            "source": "static",
                                            "value": "NIST-SP-800-53-R4"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "name",
                                    "formatter": 5
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": [],
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Failed",
                                    "color": "redBright"
                                  },
                                  {
                                    "seriesName": "Passed",
                                    "color": "green"
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 3"
                          }
                        ]
                      },
                      "name": "IM-4",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-5: Use single sign-on (SSO) for application access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-5-use-single-sign-on-sso-for-application-access)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AADNonInteractiveUserSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadnoninteractiveusersigninlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Implementation\r\nüí° [Understand Application SSO with Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/what-is-single-sign-on)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[12.5](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-2, IA-4, IA-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-4",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "AADNonInteractiveUserSignInLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\",UserId)\r\n| summarize count() by UserPrincipalName, UserProfile\r\n| sort by count_ desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " SSO Activity by Non-Interactive Sign-ins",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserPrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "1",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "UserProfile",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go To AAD User Profile >>"
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  },
                                  {
                                    "columnMatch": "ServicePrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "uninitialized",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": []
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 2",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          }
                        ]
                      },
                      "name": "IM-5",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-6: Use strong authentication controls](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-6-use-strong-authentication-controls)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Implementation\r\nüí° [How to Enable MFA in Azure](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-getstarted)<br>\r\nüí° [Introduction to Passwordless Authentication Options for Azure Active Directory](https://docs.microsoft.com/azure/active-directory/authentication/concept-authentication-passwordless)<br>\r\nüí° [Azure AD Default Password Policy](https://docs.microsoft.com/azure/active-directory/authentication/concept-sspr-policy#password-policies-that-only-apply-to-cloud-user-accounts)<br>\r\nüí° [Eliminate Bad Passwords Using Azure AD Password Protection](https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad)<br>\r\nüí° [Block legacy authentication](https://docs.microsoft.com/azure/active-directory/conditional-access/block-legacy-authentication)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[6.3, 6.4](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, IA-2, IA-5, IA-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[7.2, 8.2, 8.3, 8.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-4",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"IM.6\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Recommendations ",
                              "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Gear",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "Total",
                                    "formatter": 22,
                                    "formatOptions": {
                                      "compositeBarSettings": {
                                        "labelText": "",
                                        "columnSettings": [
                                          {
                                            "columnName": "Passed",
                                            "color": "green"
                                          },
                                          {
                                            "columnName": "Failed",
                                            "color": "redBright"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "PassedControls",
                                    "formatter": 0,
                                    "numberFormat": {
                                      "unit": 1,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "OpenBlade",
                                      "linkLabel": "Remediate >>",
                                      "linkIsContextBlade": false,
                                      "bladeOpenContext": {
                                        "bladeName": "RecommendationsBlade",
                                        "extensionName": "Microsoft_Azure_Security",
                                        "bladeParameters": [
                                          {
                                            "name": "assessmentKey",
                                            "source": "column",
                                            "value": "name"
                                          },
                                          {
                                            "name": "initiativeId",
                                            "source": "static",
                                            "value": "NIST-SP-800-53-R4"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "name",
                                    "formatter": 5
                                  }
                                ],
                                "filter": true
                              },
                              "sortBy": [],
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Failed",
                                    "color": "redBright"
                                  },
                                  {
                                    "seriesName": "Passed",
                                    "color": "green"
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 3"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"IM.6\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Current Recommendation Details",
                              "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "ResourceID",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": "Resource",
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Gear",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "ControlFamily",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Persistence",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "ControlID",
                                    "formatter": 1
                                  },
                                  {
                                    "columnMatch": "Severity",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "colors",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "High",
                                          "representation": "redBright",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "Medium",
                                          "representation": "orange",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "Low",
                                          "representation": "yellow",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "blue",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "State",
                                    "formatter": 1
                                  },
                                  {
                                    "columnMatch": "Recommendation",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "OpenBlade",
                                      "linkLabel": "Remediate >>",
                                      "linkIsContextBlade": false,
                                      "bladeOpenContext": {
                                        "bladeName": "RecommendationsBlade",
                                        "extensionName": "Microsoft_Azure_Security",
                                        "bladeParameters": [
                                          {
                                            "name": "assessmentKey",
                                            "source": "column",
                                            "value": "name"
                                          },
                                          {
                                            "name": "resourceId",
                                            "source": "column",
                                            "value": "ResourceID"
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "name",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "FirstObserved",
                                    "formatter": 6
                                  }
                                ],
                                "filter": true,
                                "sortBy": [
                                  {
                                    "itemKey": "$gen_thresholds_Severity_4",
                                    "sortOrder": 1
                                  }
                                ]
                              },
                              "sortBy": [
                                {
                                  "itemKey": "$gen_thresholds_Severity_4",
                                  "sortOrder": 1
                                }
                              ]
                            },
                            "name": "query - 8"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SigninLogs\r\n| summarize count() by UserPrincipalName, AuthenticationRequirement, AppDisplayName\r\n| sort by count_ desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": "Single vs Multi-Factor Authentication by Account",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserPrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Person",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "AuthenticationRequirement",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "representation": null,
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "multiFactorAuthentication",
                                          "representation": "success",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "==",
                                          "thresholdValue": "singleFactorAuthentication",
                                          "representation": "3",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": null,
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "blue"
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "üü¶ Single vs Multi-Factor Authentication by Account"
                          }
                        ]
                      },
                      "name": "IM-6",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-7: Restrict resource access based on conditions](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-7-restrict-resource-access-based-on--conditions)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Implementation\r\nüí° [Azure Conditional Access Overview](https://docs.microsoft.com/azure/active-directory/conditional-access/overview)<br>\r\nüí° [Common Conditional Access Policies](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-policy-common)<br>\r\nüí° [Conditional Access insights and reporting](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-insights-reporting)<br>\r\nüí° [Configure Authentication Session Management with Conditional Access](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-session-lifetime)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.3, 6.4, 13.5](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, AC-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[7.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-6",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|extend CAStatus = case(ConditionalAccessStatus ==\"success\",\"Successful\",\r\n                    ConditionalAccessStatus == \"failure\", \"Failed\",                                     \r\n                    ConditionalAccessStatus == \"notApplied\", \"Not applied\",                                     \r\n                    isempty(ConditionalAccessStatus), \"Not applied\", \r\n                    \"Disabled\")\r\n|mvexpand ConditionalAccessPolicies\r\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\r\n|extend CAGrantControl = case(CAGrantControlName contains \"MFA\", \"Require MFA\", \r\n                            CAGrantControlName contains \"Terms of Use\", \"Require Terms of Use\", \r\n                            CAGrantControlName contains \"Privacy\", \"Require Privacy Statement\", \r\n                            CAGrantControlName contains \"Device\", \"Require Device Compliant\", \r\n                            CAGrantControlName contains \"Azure AD Joined\", \"Require Hybrid Azure AD Joined Device\", \r\n                            CAGrantControlName contains \"Apps\", \"Require Approved Apps\",\r\n                            \"Other\");\r\ndata\r\n| summarize Count = dcount(Id) by CAStatus\r\n| join kind = inner (data\r\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\r\n                    ) on CAStatus\r\n| project-away CAStatus1, TimeGenerated\r\n| order by Count desc",
                              "size": 4,
                              "showAnalytics": true,
                              "title": " Conditional Access Status ",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {
                                  "columnMatch": "CAStatus",
                                  "formatter": 1
                                },
                                "subtitleContent": {
                                  "columnMatch": "Category"
                                },
                                "leftContent": {
                                  "columnMatch": "Count",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "auto"
                                  },
                                  "numberFormat": {
                                    "unit": 17,
                                    "options": {
                                      "maximumSignificantDigits": 3,
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                },
                                "showBorder": false
                              }
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 3"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SigninLogs\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by ConditionalAccessStatus\r\n| render areachart",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Conditional Access Status over Time",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "chartSettings": {
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "notApplied",
                                    "color": "red"
                                  },
                                  {
                                    "seriesName": "success",
                                    "color": "greenDark"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 3"
                          }
                        ]
                      },
                      "name": "IM-7",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-8: Restrict the exposure of credential and secrets](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-8-restrict-the-exposure-of-credential-and-secrets)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) \r\n <br>\r\n\r\n### Implementation\r\nüí° [How to Setup Credential Scanner](https://secdevtools.azurewebsites.net/helpcredscan.html)<br>\r\nüí° [GitHub Secret Scanning](https://docs.github.com/github/administering-a-repository/about-secret-scanning)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v8 IDs\r\n[16.9, 16.12](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[3.5, 6.3, 8.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-8",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SecurityAlert\r\n| where AlertName contains \"secret\" or AlertName contains \"cred\" or AlertName contains \"password\" or AlertName contains \"auth\" or AlertName contains \"cert\"\r\n| summarize count() by AlertName\r\n| render piechart",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Security Alerts for Credentials ",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserPrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Person",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "AlertName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Fired",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  },
                                  {
                                    "columnMatch": "Count",
                                    "formatter": 8,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  },
                                  {
                                    "columnMatch": "AlertLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go to Alert >"
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "warning",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "Recommendation",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go to Recommendation >"
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationClick",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Click to Recommendation"
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go to Recommendation >"
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - 3"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SecurityAlert\r\n| where AlertName contains \"secret\" or AlertName contains \"cred\" or AlertName contains \"password\" or AlertName contains \"auth\" or AlertName contains \"cert\"\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n| extend Href_ = tostring(parse_json(ExtendedLinks)[0].Href)\r\n| extend UserPrincipalName = UPN\r\n| where UserPrincipalName !contains \"[\"\r\n| where UserPrincipalName <> \"\"\r\n| summarize count() by UserPrincipalName, AlertName, ProductName\r\n| sort by count_ desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Security Alerts for Credentials",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserPrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Person",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "AlertName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Fired",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  },
                                  {
                                    "columnMatch": "Count",
                                    "formatter": 8,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  },
                                  {
                                    "columnMatch": "AlertLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go to Alert >"
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "warning",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "Recommendation",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go to Recommendation >"
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationClick",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Click to Recommendation"
                                    }
                                  },
                                  {
                                    "columnMatch": "RecommendationLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Go to Recommendation >"
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "üü¶ Security Alerts for Credentials"
                          }
                        ]
                      },
                      "name": "IM-8",
                      "styleSettings": {
                        "showBorder": true
                      }
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# [IM-9: Secure user access to existing applications](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management#im-9-secure-user-access-to--existing-applications)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Defender for Cloud Apps](https://www.microsoft.com/security/business/cloud-app-security) <br> \r\n\r\n### Implementation\r\nüí° [Azure AD Application Proxy](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy#what-is-application-proxy)<br>\r\nüí° [Microsoft Defender for Cloud Apps Best Practices](https://docs.microsoft.com/cloud-app-security/best-practices)<br>\r\nüí° [Azure AD secure hybrid access](https://docs.microsoft.com/azure/active-directory/manage-apps/secure-hybrid-access)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud Apps](https://portal.cloudappsecurity.com/)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[6.7, 12.5](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, SC-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "IM-8",
                            "styleSettings": {
                              "maxWidth": "50"
                            }
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SecurityAlert\r\n| where ProviderName == \"MCAS\" or ProviderName == \"IPC\"\r\n| where AlertName contains \"app\" or AlertName contains \"access\" or AlertName contains \"user\" or AlertName contains \"unfamiliar\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Microsoft Defender for Cloud Apps: App Access Alerts over Time",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "DisplayName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "warning",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 8,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  }
                                ]
                              }
                            },
                            "customWidth": "50",
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": " Microsoft Defender for Cloud Apps: App Access Alerts over Time"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SecurityAlert\r\n| where ProviderName == \"MCAS\"\r\n| where AlertName contains \"app\" or AlertName contains \"access\" or AlertName contains \"user\" or AlertName contains \"unfamiliar\"\r\n| extend AlertLink = tostring(parse_json(ExtendedLinks)[1].Href)\r\n| extend CloudApplication = tostring(parse_json(ExtendedProperties).[\"Cloud Applications\"])\r\n| extend UserId = tostring(parse_json(Entities)[0].AadUserId)\r\n| join (SigninLogs) on UserId\r\n| summarize count() by UserPrincipalName, CloudApplication, AlertName\r\n| sort by count_ desc\r\n| limit 250",
                              "size": 0,
                              "showAnalytics": true,
                              "title": " Microsoft Defender for Cloud Apps: User Application Access Alerts",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                              "timeContext": {
                                "durationMs": 7776000000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "UserPrincipalName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Person",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "AlertName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Fired",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "columnMatch": "count_",
                                    "formatter": 4,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  },
                                  {
                                    "columnMatch": "Count",
                                    "formatter": 8,
                                    "formatOptions": {
                                      "palette": "yellowOrangeRed"
                                    }
                                  },
                                  {
                                    "columnMatch": "AlertLink",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "Url",
                                      "linkLabel": "Link to Alert >"
                                    }
                                  },
                                  {
                                    "columnMatch": "DisplayName",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "warning",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    }
                                  }
                                ],
                                "filter": true
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "isIMVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": " Microsoft Defender for Cloud Apps: User Application Access Alerts"
                          }
                        ]
                      },
                      "name": "IM-9",
                      "styleSettings": {
                        "showBorder": true
                      }
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "isIMVisible",
                  "comparison": "isEqualTo",
                  "value": "true"
                },
                "name": "Identity Management (IM)"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isIMVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Identity Management (IM)"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Privileged Access (PA)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access) \r\n---\r\nPrivileged Access covers controls to protect privileged access to your Azure tenant and resources, including a range of controls to protect your administrative model, administrative accounts, and privileged access workstations against deliberate and inadvertent risk. "
                },
                "customWidth": "40",
                "name": "PA Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 11"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "PA-1",
                      "linkTarget": "step",
                      "linkLabel": "PA-1: Separate and limit highly privileged/administrative users",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "PA-2",
                      "linkTarget": "step",
                      "linkLabel": "PA-2: Avoid standing access for user accounts and permissions",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "PA-3",
                      "linkTarget": "step",
                      "linkLabel": "PA-3: Manage lifecycle of identities and entitlements",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "PA-4",
                      "linkTarget": "step",
                      "linkLabel": "PA-4: Review and reconcile user access regularly",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                      "cellValue": "PA-5",
                      "linkTarget": "step",
                      "linkLabel": "PA-5: Set up emergency access",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                      "cellValue": "PA-6",
                      "linkTarget": "step",
                      "linkLabel": "PA-6: Use privileged access workstations",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "b212a060-9b1c-46e1-a411-e01924d0e4ee",
                      "cellValue": "PA-7",
                      "linkTarget": "step",
                      "linkLabel": "PA-7: Follow just enough administration (least privilege) principle",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "9b080d55-ae11-4e9b-85bc-ae891dffc873",
                      "cellValue": "PA-8",
                      "linkTarget": "step",
                      "linkLabel": "PA-8: Determine access process for cloud provider support",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "PA Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-1: Separate and limit highly privileged/administrative users](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Implementation\r\nüí° [Administrator Role Permissions in Azure AD](https://docs.microsoft.com/azure/active-directory/roles/permissions-reference)<br>\r\nüí° [Use Azure Privileged Identity Management Security Alerts](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-how-to-configure-security-alerts)<br>\r\nüí° [Securing Privileged Access for Hybrid and Cloud Deployments in Azure AD](https://docs.microsoft.com/azure/active-directory/roles/security-planning)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[5.4, 6.8](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[7.1, 7.2, 8.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PA.1\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AuditLogs\r\n| where OperationName contains \"PIM\"\r\n| extend InitiatedBy = tostring(parse_json(tostring(InitiatedBy.user)).displayName)\r\n| distinct OperationName, Identity, AADOperationType, Category, InitiatedBy, ResultDescription, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Privileged Identity Management (PIM) Actions",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "OperationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "pending",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Identity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "InitiatedBy",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "PersonWithFriend",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4"
                    }
                  ]
                },
                "name": "PA-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-2: Avoid standing access for user accounts and permissions](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-2-avoid-standing-access-for-user-accounts-and-permissions)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Azure PIM just-in-time access deployment](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PA.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "PA-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-3: Manage lifecycle of identities and entitlements](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-3-manage-lifecycle-of-identities-and-entitlements)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [IdentityInfo](https://docs.microsoft.com/azure/azure-monitor/reference/tables/identityinfo) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Implementation\r\nüí° [What are Azure AD access reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\nüí° [What is Azure AD entitlement management](https://docs.microsoft.com/azure/active-directory/governance/entitlement-management-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[6.1, 6.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-5, AC-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[7.1, 7.2, 8.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## [Create An Access Review](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/ReviewAccessMenuBlade/aadroles)\r\n![Image Name](https://docs.microsoft.com/azure/active-directory/governance/media/create-access-review/additional-content-reviewer.png)"
                      },
                      "customWidth": "50",
                      "name": "text - 2"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "IdentityInfo\r\n| project AccountUPN, AssignedRoles, GroupMembership, IsAccountEnabled, Department, JobTitle, UserType, TimeGenerated\r\n| sort by TimeGenerated\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Identity Information",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AccountUPN",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "UserPrincipalName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "PA-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-4: Review and reconcile user access regularly](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-4-review-and-reconcile-user-access-regularly)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Implementation\r\nüí° [Create an access review of Azure resource roles in Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-resource-roles-start-access-review)<br>\r\nüí° [How to use Azure AD identity and access reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[5.1, 5.3, 5.5](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[7.1, 7.2, 8.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PA.4\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where ProductName == \"Azure Active Directory Identity Protection\"\r\n| extend Name_ = tostring(parse_json(Entities)[0].Name)\r\n| extend UPNSuffix_ = tostring(parse_json(Entities)[0].UPNSuffix)\r\n| extend UserPrincipalName = strcat(Name_,\"@\",UPNSuffix_)\r\n| extend Account = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\",UserPrincipalName)\r\n| project AlertName, UserPrincipalName, Account, AlertType, AlertSeverity, Description, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Azure Active Directory: Identity Protection Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "PA-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-5: Set up emergency access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-5-set-up-emergency-access)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Implementation\r\nüí° [Manage Emergency Access Accounts in Azure AD](https://docs.microsoft.com/azure/active-directory/roles/security-emergency-access)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SigninLogs\r\n| extend MailAddress = UserPrincipalName\r\n| join (IdentityInfo) on MailAddress\r\n| where GroupMembership contains \"security\" or GroupMembership contains \"admin\" or AssignedRoles contains \"security\" or AssignedRoles contains \"admin\" \r\n| extend Roles = strcat(AssignedRoles)\r\n| summarize count() by UserPrincipalName, Roles\r\n| sort by count_ desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Designate Emergency Accounts & Monitor Usage ",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "UserPrincipalName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "üü¶ Monitor Emergency Accounts",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "PA-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-6: Use Privileged Access Workstations](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-6-use-privileged-access-workstations)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Implementation\r\nüí° [Understand Privileged Access Workstations](https://docs.microsoft.com/security/compass/privileged-access-deployment)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[12.8, 13.5](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, SC-2, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## [Privileged Access Deployment](https://docs.microsoft.com/security/compass/privileged-access-deployment)\r\n![Image¬†Name](https://docs.microsoft.com/security/compass/media/privileged-access-deployment/privileged-access-deployment-profile-summary.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-4 - Copy",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "PA-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-7: Follow Just Enough Administration (Least Privilege Principle)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-7-follow-just-enough-administration-least-privilege-principle)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Activity]( https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Implementation\r\nüí° [What is Azure Role-Based Access Control (Azure RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview)<br>\r\nüí° [How to Configure Azure RBAC](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal)<br>\r\nüí° [How to Use Azure AD Identity and Access Reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[14.6](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, SC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PA.7\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AuditLogs\r\n| extend UserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\r\n| summarize Runs = count(), Success = countif(Result == 'success'), Fails = countif(Result != 'success') by OperationName // Summarize the total, successful and failed operations by name\r\n| extend SuccessRate = (Success * 100 / Runs) // Calculate the percentage of successful operations against the total\r\n| project OperationName, Runs, SuccessRate, Fails\r\n| sort by Fails desc\r\n\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Monitor Privileged User Operations",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Runs",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "SuccessRate",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "redGreen"
                              }
                            },
                            {
                              "columnMatch": "Fails",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "red"
                              }
                            },
                            {
                              "columnMatch": "UserId",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "resource",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "OfficeWorkload",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "resource",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_SuccessRate_2",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_heatmap_SuccessRate_2",
                            "sortOrder": 2
                          }
                        ]
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let data = AuditLogs\r\n| extend UserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\r\n    | where \"All\" == \"All\" or Result in ('All')\r\n    | extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\")\r\n    | where \"All\" == \"All\" or initiator in ('All')\r\n    | where \"All\" == \"All\" or Category in ('All')\r\n    | where Category == 'All' or 'All' == \"All\";\r\nlet appData = data\r\n    | summarize TotalCount = count() by OperationName, Category\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated in range(ago(7d), now(), 3h) by OperationName\r\n        | project-away TimeGenerated)\r\n        on OperationName\r\n    | order by TotalCount desc, OperationName asc\r\n    | project OperationName, TotalCount, Trend, Category\r\n    | serialize Id = row_number();\r\ndata\r\n| summarize TotalCount = count() by initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\"), Category, OperationName\r\n| join kind=inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated in range(ago(7d), now(), 3h) by OperationName, initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\")\r\n    | project-away TimeGenerated)\r\n    on OperationName, initiator\r\n| order by TotalCount desc, OperationName asc\r\n| project OperationName, initiator, TotalCount, Category, Trend\r\n| serialize Id = row_number(1000000)\r\n| join kind=inner (appData) on OperationName\r\n| project Id, Name = initiator, Type = 'initiator', ['Operations Count'] = TotalCount, Trend, ParentId = Id1\r\n| union (appData \r\n    | project Id, Name = OperationName, Type = 'Operation', ['Operations Count'] = TotalCount, Trend)\r\n| order by ['Operations Count'] desc, Name asc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Monitor Privileged User Activities",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "exportParameterName": "UserInfo",
                        "exportDefaultValue": "{ \"Name\":\"\", \"Type\":\"*\"}",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Id",
                              "formatter": 5,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "Type",
                              "formatter": 5,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "Operations Count",
                              "formatter": 8,
                              "formatOptions": {
                                "min": 0,
                                "palette": "blue",
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "Trend",
                              "formatter": 9,
                              "formatOptions": {
                                "min": 0,
                                "palette": "turquoise",
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            {
                              "columnMatch": "ParentId",
                              "formatter": 5,
                              "formatOptions": {
                                "showIcon": true
                              }
                            }
                          ],
                          "rowLimit": 1000,
                          "filter": true,
                          "hierarchySettings": {
                            "idColumn": "Id",
                            "parentColumn": "ParentId",
                            "treeType": 0,
                            "expanderColumn": "Name"
                          }
                        },
                        "sortBy": [],
                        "mapSettings": {
                          "locInfo": "CountryRegion",
                          "locInfoColumn": "Location",
                          "latitude": "SourceIPLocation",
                          "longitude": "SourceIPLocation",
                          "sizeSettings": "Location",
                          "sizeAggregation": "Count",
                          "legendMetric": "Location",
                          "legendAggregation": "Count",
                          "itemColorSettings": {
                            "nodeColorField": "Location",
                            "colorAggregation": "Count",
                            "type": "thresholds",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blueDark"
                              }
                            ]
                          }
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5"
                    }
                  ]
                },
                "name": "PA-7",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PA-8 Determine access process for cloud provider support](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access#pa-8-determine-access-process-for-cloud-provider-support)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview) <br>\r\n\r\n### Implementation\r\nüí° [Understand Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Customer Lockbox](https://portal.azure.com/#blade/Microsoft_Azure_Lockbox/LockboxMenu/Overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[6.1, 6.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, AC-2, AC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PA-8",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## [Establish Approval Process for Vendor Support Access with Azure Lockbox](https://portal.azure.com/#blade/Microsoft_Azure_Lockbox/LockboxMenu/ActivityLog)\r\n![Image Name](https://docs.microsoft.com/azure/security/fundamentals/media/customer-lockbox-overview/customer-lockbox-email-notification.png) "
                      },
                      "customWidth": "30",
                      "name": "text - 2"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity\r\n| where OperationName contains \"lockbox\"\r\n| sort by TimeGenerated desc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Customer Lockbox Activity",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Caller",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "info",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isPAVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 2"
                    }
                  ]
                },
                "name": "PA-8",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isPAVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Privileged Access Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Data Protection (DP)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection) \r\n---\r\nData Protection covers control of data protection at rest, in transit, and via authorized access mechanisms, including discover, classify, protect, and monitor sensitive data assets using access control, encryption, and logging in Azure."
                },
                "customWidth": "40",
                "name": "DP Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 8"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "DP-1",
                      "linkTarget": "step",
                      "linkLabel": "DP-1: Discover, classify, and label sensitive data",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "DP-2",
                      "linkTarget": "step",
                      "linkLabel": "DP-2: Monitor anomalies and threats targeting sensitive data",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "DP-3",
                      "linkTarget": "step",
                      "linkLabel": "DP-3: Encrypt sensitive data in transit",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "DP-4",
                      "linkTarget": "step",
                      "linkLabel": "DP-4: Enable data at rest encryption by default",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                      "cellValue": "DP-5",
                      "linkTarget": "step",
                      "linkLabel": "DP-5: Use customer-managed key option in data at rest encryption when required",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "6459d003-1d16-47fe-b2a4-60390acff508",
                      "cellValue": "DP-6",
                      "linkTarget": "step",
                      "linkLabel": "DP-6: Use a secure key management process",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "2b495334-1189-4d45-bcdd-90eec3ec8bc8",
                      "cellValue": "DP-7",
                      "linkTarget": "step",
                      "linkLabel": "DP-7: Use a secure certificate management process",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "c7c7d360-ea00-4035-9950-0043f95654ab",
                      "cellValue": "DP-8",
                      "linkTarget": "step",
                      "linkLabel": "DP-8: Ensure security of key and certificate repository",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "DP Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-1: Discover, classify, and label sensitive data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-1-discover-classify-and-label-sensitive-data)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [InformationProtectionLogs_CL](https://docs.microsoft.com/azure/information-protection/audit-logs) ‚ú≥Ô∏è [Azure Information Protection](https://azure.microsoft.com/services/information-protection/)<br>\r\n\r\n### Implementation\r\nüí° [Data classification overview](https://docs.microsoft.com/azure/cloud-adoption-framework/govern/policy-compliance/data-classification)<br>\r\nüí° [Label your sensitive data using Azure Purview](https://docs.microsoft.com/azure/purview/create-sensitivity-label)<br>\r\nüí° [Tag Sensitive Information Using Azure Information Protection](https://docs.microsoft.com/azure/information-protection/what-is-information-protection)<br>\r\nüí° [How to implement Azure SQL Data Discovery](https://docs.microsoft.com/azure/azure-sql/database/data-discovery-and-classification-overview)<br>\r\nüí° [Azure Purview data sources](https://docs.microsoft.com/azure/purview/purview-connector-overview#purview-data-sources)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Information Protection](https://portal.azure.com/#blade/Microsoft_Azure_InformationProtection/DataClassGroupEditBlade/quickstartBlade) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.2, 3.7, 3.13](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[RA-2, SC-28](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[A3.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "InformationProtectionLogs_CL\r\n| summarize count() by UserId_s, LabelName_s, ApplicationName_s_s, Operation_s_s, Platform_s_s, Activity_s_s, IPv4_s_s\r\n| sort by count_ desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Sensitive Data Labeling & Classification",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore This Control Further and Implement Solutions                                                                                                                                               ‚Ä¢    Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                          ‚Ä¢    Panels Can Display 'No Data' if All Recommendations are Fully Implemented, See Azure Security Center Recommendations                                                                                                                                   ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "UserId_s",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "DP-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-2: Monitor anomalies and threats targeting sensitive data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-2-monitor-anomalies-and-threats-targeting-sensitive-data)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Implementation\r\nüí° [Enable Azure Defender for SQL](https://docs.microsoft.com/azure/azure-sql/database/azure-defender-for-sql)<br>\r\nüí° [Enable Azure Defender for Storage](https://docs.microsoft.com/azure/storage/common/storage-advanced-threat-protection?tabs=azure-security-center)<br>\r\n\r\n### Microsoft Logs\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.13](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[A3.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where AlertName contains \"data\" or AlertName contains \"access\" or AlertName contains \"sensitive\" or Tactics == \"exfiltration\"\r\n| project AlertName, ProductName, AlertType, AlertSeverity, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Sensitive Data Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "DP-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-3: Encrypt sensitive data in transit](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-3-encrypt-sensitive-data-in-transit)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Double encryption for Azure data in transit](https://docs.microsoft.com/azure/security/fundamentals/double-encryption#data-in-transit)<br>\r\nüí° [Understand encryption in transit with Azure](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview#encryption-of-data-in-transit)<br>\r\nüí° [Information on TLS Security](https://docs.microsoft.com/security/engineering/solving-tls1-problem)<br>\r\nüí° [Enforce secure transfer in Azure storage](https://docs.microsoft.com/azure/storage/common/storage-require-secure-transfer?toc=/azure/storage/blobs/toc.json#require-secure-transfer-for-a-new-storage-account)<br>\r\n\r\n### Microsoft Portals \r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.10](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.5, 3.6, 4.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.3\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"DP.3\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "DP-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-4: Enable data at rest encryption by default](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-4-enable-data-at-rest-encryption-by-default)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Understand Encryption at Rest in Azure](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest#encryption-at-rest-in-microsoft-cloud-services)<br>\r\nüí° [Data at Rest Double Encryption in Azure](https://docs.microsoft.com/azure/security/fundamentals/double-encryption#data-at-rest)<br>\r\nüí° [Encryption Model and Key Management Table](https://docs.microsoft.com/azure/security/fundamentals/encryption-models)<br>\r\nüí° [Security architecture](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-architecture)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.11](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-28](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.4, 3.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.4\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"DP.4\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "DP-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-5: Use customer-managed key option in data at rest encryption when required](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-when-required)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Encryption model and key management table](https://docs.microsoft.com/azure/security/fundamentals/encryption-models)<br>\r\nüí° [Services that support encryption using customer-managed key](https://docs.microsoft.com/azure/security/fundamentals/encryption-models#supporting-services)<br>\r\nüí° [How to configure customer managed encryption keys in Azure Storage](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-portal)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.11](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-12, SC-28](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.4, 3.5, 3.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.5\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "DP-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-6: Use a secure key management process](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-6-use-a-secure-key-management-process)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Key Vault](https://azure.microsoft.com/services/key-vault/)\r\n\r\n### Implementation\r\nüí° [Azure Key Vault overview](https://docs.microsoft.com/azure/key-vault/general/overview)<br>\r\nüí° [Azure data encryption at rest--Key Hierarchy](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest#key-hierarchy)<br>\r\nüí° [BYOK (Bring Your Own Key) specification](https://docs.microsoft.com/azure/key-vault/keys/byok-specification)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IA-5, SC-12, SC-28](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.6\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "// Run query to see results.\r\nresources\r\n| where type =~ 'Microsoft.KeyVault/vaults'\r\n| project name,resourceGroup,location,id,type,subscriptionId,kind,tags\r\n| extend typeDisplayName=case(type =~ 'microsoft.keyvault/vaults','Key vault',type)\r\n| extend locationDisplayName=case(location =~ 'eastus','East US',location =~ 'eastus2','East US 2',location =~ 'southcentralus','South Central US',location =~ 'westus2','West US 2',location =~ 'westus3','West US 3',location =~ 'australiaeast','Australia East',location =~ 'southeastasia','Southeast Asia',location =~ 'northeurope','North Europe',location =~ 'swedencentral','Sweden Central',location =~ 'uksouth','UK South',location =~ 'westeurope','West Europe',location =~ 'centralus','Central US',location =~ 'northcentralus','North Central US',location =~ 'westus','West US',location =~ 'southafricanorth','South Africa North',location =~ 'centralindia','Central India',location =~ 'eastasia','East Asia',location =~ 'japaneast','Japan East',location =~ 'jioindiawest','Jio India West',location =~ 'koreacentral','Korea Central',location =~ 'canadacentral','Canada Central',location =~ 'francecentral','France Central',location =~ 'germanywestcentral','Germany West Central',location =~ 'norwayeast','Norway East',location =~ 'switzerlandnorth','Switzerland North',location =~ 'uaenorth','UAE North',location =~ 'brazilsouth','Brazil South',location =~ 'centralusstage','Central US (Stage)',location =~ 'eastusstage','East US (Stage)',location =~ 'eastus2stage','East US 2 (Stage)',location =~ 'northcentralusstage','North Central US (Stage)',location =~ 'southcentralusstage','South Central US (Stage)',location =~ 'westusstage','West US (Stage)',location =~ 'westus2stage','West US 2 (Stage)',location =~ 'asia','Asia',location =~ 'asiapacific','Asia Pacific',location =~ 'australia','Australia',location =~ 'brazil','Brazil',location =~ 'canada','Canada',location =~ 'europe','Europe',location =~ 'france','France',location =~ 'germany','Germany',location =~ 'global','Global',location =~ 'india','India',location =~ 'japan','Japan',location =~ 'korea','Korea',location =~ 'norway','Norway',location =~ 'southafrica','South Africa',location =~ 'switzerland','Switzerland',location =~ 'uae','United Arab Emirates',location =~ 'uk','United Kingdom',location =~ 'unitedstates','United States',location =~ 'eastasiastage','East Asia (Stage)',location =~ 'southeastasiastage','Southeast Asia (Stage)',location =~ 'westcentralus','West Central US',location =~ 'southafricawest','South Africa West',location =~ 'australiacentral','Australia Central',location =~ 'australiacentral2','Australia Central 2',location =~ 'australiasoutheast','Australia Southeast',location =~ 'japanwest','Japan West',location =~ 'jioindiacentral','Jio India Central',location =~ 'koreasouth','Korea South',location =~ 'southindia','South India',location =~ 'westindia','West India',location =~ 'canadaeast','Canada East',location =~ 'francesouth','France South',location =~ 'germanynorth','Germany North',location =~ 'norwaywest','Norway West',location =~ 'switzerlandwest','Switzerland West',location =~ 'ukwest','UK West',location =~ 'uaecentral','UAE Central',location =~ 'brazilsoutheast','Brazil Southeast',location)\r\n| extend subscriptionDisplayName=case(subscriptionId =~ 'd1d8779d-38d7-4f06-91db-9cbc8de0176f','CyberSecSOC',subscriptionId)\r\n| extend tagsString=tostring(tags)\r\n| where (type !~ ('dynatrace.observability/monitors'))\r\n| where (type !~ ('nginx.nginxplus/nginxdeployments'))\r\n| where (type !~ ('microsoft.agfoodplatform/farmbeats'))\r\n| where (type !~ ('microsoft.cdn/profiles/afdendpoints'))\r\n| where (type !~ ('microsoft.cdn/profiles/customdomains'))\r\n| where (type !~ ('microsoft.cdn/profiles/origingroups'))\r\n| where (type !~ ('microsoft.cdn/profiles/rulesets'))\r\n| where (type !~ ('microsoft.cdn/profiles/secrets'))\r\n| where (type !~ ('microsoft.cdn/profiles/securitypolicies'))\r\n| where (type !~ ('microsoft.cdn/profiles/afdendpoints/routes'))\r\n| where (type !~ ('microsoft.cdn/profiles/origingroups/origins'))\r\n| where (type !~ ('microsoft.cdn/profiles/rulesets/rules'))\r\n| where (type !~ ('microsoft.kubernetes/connectedclusters/microsoft.kubernetesconfiguration/fluxconfigurations'))\r\n| where (type !~ ('microsoft.containerservice/managedclusters/microsoft.kubernetesconfiguration/fluxconfigurations'))\r\n| where (type !~ ('microsoft.portal/extensions/deployments'))\r\n| where (type !~ ('microsoft.portal/extensions'))\r\n| where (type !~ ('microsoft.portal/extensions/slots'))\r\n| where (type !~ ('microsoft.portal/extensions/versions'))\r\n| where (type !~ ('microsoft.datacollaboration/workspaces'))\r\n| where (type !~ ('microsoft.network/dnsforwardingrulesets'))\r\n| where (type !~ ('microsoft.network/dnsresolvers'))\r\n| where (type !~ ('microsoft.azurestack/registrations'))\r\n| where (type !~ ('microsoft.communication/emailservices'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools/clusters'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools/clusters/sessionclusters'))\r\n| where (type !~ ('microsoft.hdinsight/clusterpools'))\r\n| where (type !~ ('microsoft.hpcworkbench/instances'))\r\n| where (type !~ ('microsoft.scvmm/vmmservers'))\r\n| where (type !~ ('microsoft.connectedvmwarevsphere/vcenters'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/assets'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/tests'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/executionplans'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins/testplans'))\r\n| where (type !~ ('microsoft.intelligentitdigitaltwin/digitaltwins'))\r\n| where not((type =~ ('microsoft.network/serviceendpointpolicies')) and ((kind =~ ('internal'))))\r\n| where (type !~ ('microsoft.openlogisticsplatform/workspaces'))\r\n| where (type !~ ('microsoft.scom/managedinstances'))\r\n| where (type !~ ('microsoft.orbital/spacecrafts/contacts'))\r\n| where (type !~ ('microsoft.orbital/contactprofiles'))\r\n| where (type !~ ('microsoft.orbital/edgesites'))\r\n| where (type !~ ('microsoft.orbital/groundstations'))\r\n| where (type !~ ('microsoft.orbital/l2connections'))\r\n| where (type !~ ('microsoft.orbital/spacecrafts'))\r\n| where (type !~ ('microsoft.azurepercept/accounts'))\r\n| where (type !~ ('microsoft.workloads/phpworkloads'))\r\n| where (type !~ ('microsoft.playfab/playeraccountpools'))\r\n| where (type !~ ('microsoft.playfab/playfabresources'))\r\n| where (type !~ ('microsoft.playfab/titles'))\r\n| where (type !~ ('microsoft.recommendationsservice/accounts/modeling'))\r\n| where (type !~ ('microsoft.recommendationsservice/accounts/serviceendpoints'))\r\n| where (type !~ ('microsoft.recoveryservicesbvtd2/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesbvtd/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesintd/vaults'))\r\n| where (type !~ ('microsoft.recoveryservicesintd2/vaults'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/applicationinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/centralinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances/databaseinstances'))\r\n| where (type !~ ('microsoft.workloads/sapvirtualinstances'))\r\n| where (type !~ ('microsoft.datareplication/replicationvaults'))\r\n| where (type !~ ('microsoft.storagecache/amlfilesystems'))\r\n| where not((type =~ ('microsoft.synapse/workspaces/sqlpools')) and ((kind =~ ('v3'))))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/sites'))\r\n| where (type !~ ('microsoft.mobilenetwork/packetcorecontrolplanes'))\r\n| where (type !~ ('microsoft.mobilenetwork/mobilenetworks/services'))\r\n| where (type !~ ('microsoft.mobilenetwork/sims'))\r\n| where (type !~ ('microsoft.workloads/monitors'))\r\n| where not((type =~ ('microsoft.sql/servers/databases')) and ((kind in~ ('system','v2.0,system','v12.0,system','v12.0,user,datawarehouse,gen2,analytics'))))\r\n| where not((type =~ ('microsoft.sql/servers')) and ((kind =~ ('v12.0,analytics'))))\r\n| project id,typeDisplayName,resourceGroup,locationDisplayName,subscriptionDisplayName,tagsString,name,type,kind,location,subscriptionId,tags\r\n| sort by (tolower(tostring(name))) asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Key Vault Assets",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "DP-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-7: Use a secure certificate management process](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-7-use-a-secure-certificate-management-process)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n üî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n \r\n### Implementation\r\nüí° [Get started with Key Vault certificates](https://docs.microsoft.com/azure/key-vault/certificates/certificate-scenarios)<br>\r\nüí° [Certificate Access Control in Azure Key Vault](https://docs.microsoft.com/azure/key-vault/certificates/certificate-access-control)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\nüí° [Security architecture](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-architecture)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IA-5, SC-12, SC-17](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.7\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| search \"key\"\r\n| project AlertName, ProductName, AlertType, AlertSeverity, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Key & Certificate Management Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "DP-7",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DP-8: Ensure security of key and certificate repository](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection#dp-8-ensure-security-of-key-and-certificate-repository)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Key Vault](https://azure.microsoft.com/services/key-vault/)\r\n \r\n### Implementation\r\nüí° [Azure Key Vault overview](https://docs.microsoft.com/azure/key-vault/general/overview)<br>\r\nüí° [Azure Key Vault security best practices](https://docs.microsoft.com/azure/key-vault/general/best-practices)<br>\r\nüí° [Use managed identity to access Azure Key Vault](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/tutorial-windows-vm-access-nonaad)<br>\r\nüí° [Identity and key management](https://docs.microsoft.com/azure/cloud-adoption-framework/organize/cloud-security-identity-keys)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IA-5, SC-12, SC-17](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDPVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "DP-8",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DP.8\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"DP.8\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity \r\n| where OperationNameValue startswith \"Microsoft.KeyVault\"\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Key Vault: Access & Policy Changes",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 7 - Copy"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDiagnostics\r\n| where ResourceProvider == \"MICROSOFT.KEYVAULT\"\r\n| sort by TimeGenerated desc\r\n| limit 100\r\n\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Key Vault: Operations",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "rowLimit": 100,
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 5"
                    }
                  ]
                },
                "name": "DP-8",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isDPVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Data Protection Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Asset Management (AM)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management) \r\n---\r\nAsset Management covers controls to ensure security visibility and governance over Azure resources, including recommendations on permissions for security personnel, security access to asset inventory, and managing approvals for services and resources (inventory, track, and correct). "
                },
                "customWidth": "40",
                "name": "AM Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "A"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "AM-1",
                      "linkTarget": "step",
                      "linkLabel": "AM-1: Track asset inventory and their risks",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "AM-2",
                      "linkTarget": "step",
                      "linkLabel": "AM-2: Use only approved services",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "AM-3",
                      "linkTarget": "step",
                      "linkLabel": "AM-3: Ensure security of asset lifecycle management",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                      "cellValue": "AM-4",
                      "linkTarget": "step",
                      "linkLabel": "AM-4: Limit access to asset management",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                      "cellValue": "AM-5",
                      "linkTarget": "step",
                      "linkLabel": "AM-5: Use only approved applications in virtual machine",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "AM Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [AM-1: Track asset inventory and their risks](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-1-track-asset-inventory-and-their-risks)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br> \r\n\r\n### Implementation\r\nüí° [How to Create Queries with Azure Resource Graph Explorer](https://docs.microsoft.com/azure/governance/resource-graph/first-query-portal)<br>\r\nüí° [Microsoft Defender for Cloud Asset Inventory Management](https://docs.microsoft.com/azure/security-center/asset-inventory)<br>\r\nüí° [For More Information About Tagging Assets, See the Resource Naming and Tagging Decision Guide](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/resource-tagging/?toc=%2fazure%2fazure-resource-manager%2fmanagement%2ftoc.json)<br>\r\nüí° [Overview of Security Reader Role](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#security-reader)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[1.1, 1.5, 2.1, 2.4](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-8, PM-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "AM-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"microsoft\"\r\n| project id,type,location,resourceGroup\r\n| order by location asc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Asset Inventory",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "properties_storageProfile_osDisk_osType",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Windows",
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Linux",
                                    "representation": "red",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "green",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "greenDarkDark"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": " Asset Inventory",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"microsoft\"\r\n| project id,type,resourceGroup, tags\r\n| extend tag = strcat(tags)\r\n| summarize count() by tag\r\n| where tag <> \"\" \r\n| where tag <> \"{}\" \r\n| sort by count_ desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Tags Currently In Use",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "properties_storageProfile_osDisk_osType",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Windows",
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Linux",
                                    "representation": "red",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "green",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "üü¶ Tags Currently In Use",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "AM-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [AM-2: Use only approved services](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-2-use-only-approved-services)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n### Implementation\r\nüí° [Configure and Manage Azure Policy](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüí° [How to Deny a Specific Resource Type with Azure Policy](https://docs.microsoft.com/azure/governance/policy/samples/index)<br>\r\nüí° [How to Create Queries with Azure Resource Graph Explorer](https://docs.microsoft.com/azure/governance/resource-graph/first-query-portal)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[2.5, 2.6 , 2.7, 4.84](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-8, PM-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[6.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "AM-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"AM.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "Resources\r\n| where type contains 'Microsoft'\r\n| project id,type,resourceGroup\r\n| summarize count() by type\r\n| sort by count_ desc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Asset Count by Type",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": " Asset Count by Type",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "AM-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [AM-3: Ensure security of asset lifecycle management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-3-ensure-security-of-asset-lifecycle-management)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Implementation\r\nüí° [Delete Azure Resource Group and Resource](https://docs.microsoft.com/azure/azure-resource-manager/management/delete-resource-group)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[1.1, 2.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-8, CM-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "AM-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity\r\n| where OperationName contains \"delete\" or OperationName contains \"remove\"\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Delete/Remove Assets by User",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "OperationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "orange"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "Delete/Remove Assets by User",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "AM-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [AM-4: Limit access to asset management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-4-limit-access-to-asset-management)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Implementation\r\nüí° [How to Configure Conditional Access to Block Access to Azure Resources Manager](https://docs.microsoft.com/azure/role-based-access-control/conditional-access-azure-management)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.3](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "AM-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SigninLogs\r\n| where ResourceDisplayName contains \"Manage\" or ResourceDisplayName contains \"graph\"\r\n| summarize count() by UserPrincipalName, ResourceDisplayName, ConditionalAccessStatus\r\n| sort by count_ desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Azure Resource Manager / Graph Access",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "UserPrincipalName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ConditionalAccessStatus",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "success",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "Azure Resource Manager/ Graph Access",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "AM-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [AM-5: Use only approved applications in virtual machine](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-asset-management#am-5-use-only-approved-applications-in-virtual-machine)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to Use Microsoft Defender for Cloud Adaptive Application Controls](https://docs.microsoft.com/azure/security-center/security-center-adaptive-application)<br>\r\nüí° [Understand Azure Automation Change Tracking and Inventory](https://docs.microsoft.com/azure/automation/change-tracking/overview)<br>\r\nüí° [How to Control PowerShell Script Execution in Windows Environments](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/set-executionpolicy)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[2.5, 2.6, 2.7, 4.8](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-8, CM-7, CM-10, CM-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[6.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "AM-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"AM.5\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Azure Automation Change Tracking and Inventory Overview](https://docs.microsoft.com/azure/automation/change-tracking/overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/automation/change-tracking/media/overview/windowservices.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isAMVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "AM",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "AM-5",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isAMVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Asset Management Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Logging and Threat Detection (LT)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection) \r\n---\r\nLogging and Threat Detection covers controls for detecting threats on Azure and enabling, collecting, and storing audit logs for Azure services, including enabling detection, investigation, and remediation processes with controls to generate high-quality alerts with native threat detection in Azure services; it also includes collecting logs with Azure Monitor, centralizing security analysis with Microsoft Sentinel, time synchronization, and log retention."
                },
                "customWidth": "40",
                "name": "LT Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 10"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "LT-1",
                      "linkTarget": "step",
                      "linkLabel": "LT-1: Enable threat detection capabilities",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "LT-2",
                      "linkTarget": "step",
                      "linkLabel": "LT-2: Enable threat detection for identity and access management",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "LT-3",
                      "linkTarget": "step",
                      "linkLabel": "LT-3: Enable logging for security investigation",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "LT-4",
                      "linkTarget": "step",
                      "linkLabel": "LT-4: Enable network logging for security investigation",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                      "cellValue": "LT-5",
                      "linkTarget": "step",
                      "linkLabel": "LT-5: Centralize security log management and analysis",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                      "cellValue": "LT-6",
                      "linkTarget": "step",
                      "linkLabel": "LT-6: Configure log storage retention",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "0f9bbc79-0bbf-49f2-a226-af454214a675",
                      "cellValue": "LT-7",
                      "linkTarget": "step",
                      "linkLabel": "LT-7: Use approved time synchronization sources",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "LT Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-1: Enable threat detection capabilities](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-1-enable-threat-detection-capabilities)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert)‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Defender for Cloud Apps](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender) ‚ú≥Ô∏è [Microsoft Defender for Identity]( https://www.microsoft.com/microsoft-365/security/identity-defender) <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Threat Protection in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/azure-defender)<br>\r\nüí° [Microsoft Defender for Cloud Security Alerts Reference Guide](https://docs.microsoft.com/azure/security-center/alerts-reference)<br>\r\nüí° [Create Custom Analytics Rules to Detect Threats](https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom)<br>\r\nüí° [Cyber Threat Intelligence with Microsoft Sentinel](https://docs.microsoft.com/azure/architecture/example-scenario/data/sentinel-threat-intelligence)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/) <br> \r\nüîÄ [Microsoft Defender for Cloud Apps Portal](https://portal.cloudappsecurity.com/)<br>\r\nüîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> \r\nüîÄ [Microsoft Defender for IoT](https://portal.azure.com/#blade/Microsoft_Azure_IoT_Defender/IoTDefenderDashboard/Getting_Started)  <br>\r\nüîÄ [Microsoft Defender for Identity](https://portal.atp.azure.com/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.11](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.6, 10.8, A3.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"LT.1\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| summarize count() by AlertName, ProductName\r\n| sort by count_ desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Security Alerts ",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Alert >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "üü¶ Security Alerts ",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "ThreatIntelligenceIndicator\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by SourceSystem\r\n| render timechart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Ingested Threat Intelligence by Source over Time",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Alert >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "üü¶ Ingested Threat Intelligence by Source over Time",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "LT-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-2: Enable threat detection for identity and access management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-2-enable-threat-detection-for--identity-and-access-management)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Implementation\r\nüí° [Audit activity reports in Azure AD](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs)<br>\r\nüí° [Enable Azure Identity Protection](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)<br>\r\nüí° [Threat Protection in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/azure-defender)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) \r\n\r\n### CIS Controls v8 IDs\r\n[8.11](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.6, 10.8, A3.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"LT.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let AnomalousSigninActivity = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where (UsersInsights.NewAccount == True or UsersInsights.DormantAccount == True) and (\r\n        ActivityInsights.FirstTimeUserAccessedResource == True and ActivityInsights.ResourceUncommonlyAccessedAmongPeers == True\r\n        or ActivityInsights.FirstTimeUserUsedApp == True and ActivityInsights.AppUncommonlyUsedAmongPeers == False)\r\n    | join (\r\n        SigninLogs | where Status.errorCode == 0 or Status.errorCode == 0 and RiskDetail != \"none\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Successful Sign-in with one or more of the following indications: sign by new or recently dormant accounts and sign in with resource for the first time (while none of their peers did) or to an app for the first time (while none of their peers did) or performed by a user with Risk indicaiton from AAD\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet critical = dynamic(['9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3', 'c4e39bd9-1100-46d3-8c65-fb160da0071f', '158c047a-c907-4556-b7ef-446551a6b5f7', '62e90394-69f5-4237-9190-012177145e10', 'd29b2b05-8046-44ba-8758-1e26182fcf32', '729827e3-9c14-49f7-bb1b-9608f156bbb8', '966707d0-3269-4727-9be2-8c3a10f19b9d', '194ae4cb-b126-40b2-bd5b-6091b380977d', 'fe930be7-5e62-47db-91af-98c3a49a38b1']);\r\nlet high = dynamic(['cf1c38e5-3621-4004-a7cb-879624dced7c', '7495fdc4-34c4-4d15-a289-98788ce399fd', 'aaf43236-0c0d-4d5f-883a-6955382ac081', '3edaf663-341e-4475-9f94-5c398ef6c070', '7698a772-787b-4ac8-901f-60d6b08affd2', 'b1be1c3e-b65d-4f19-8427-f6fa0d97feb9', '9f06204d-73c1-4d4c-880a-6edb90606fd8', '29232cdf-9323-42fd-ade2-1d097af3e4de', 'be2f45a1-457d-42af-a067-6ec1fa63bc45', '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', 'e8611ab8-c189-46e8-94e1-60213ab1f814']);//witdstomstl\r\nlet AnomalousRoleAssignment = AuditLogs\r\n    | where TimeGenerated > ago(28d)\r\n    | where OperationName == \"Add member to role\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target = tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner (\r\n        BehaviorAnalytics\r\n        | where ActionType == \"Add member to role\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend AnomalyName = \"Anomalous Role Assignemt\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access.  The query below generates an output of all high Blast Radius users performing Add member to priveleged role, or ones that add users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let LogOns=materialize(\r\n    BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\");\r\nlet AnomalousResourceAccess = LogOns\r\n    | where ActionType == \"ResourceAccess\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous Resource Access\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversary may be trying to move through the environment. APT29 and APT32, for example, has used PtH & PtT techniques to lateral move around the network. The query below generates an output of all users performing an resource access (4624:3) to devices for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousRDPActivity = LogOns\r\n    | where ActionType == \"RemoteInteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous RDP Activity\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. FIN10, for example, has used RDP to move laterally to systems in the victim environment. The query below generates an output of all users performing a remote interactive logon (4624:10) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousLogintoDevices = LogOns\r\n    | where ActionType == \"InteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | where UsersInsights.DormantAccount == true or DevicesInsights.LocalAdmin == true\r\n    | extend AnomalyName = \"Anomalous Login To Devices\",\r\n        Tactic = \"Privilege Escalation\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access and privilege escalation. The query below generates an output of all administator users performing an interactive logon (4624:2) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousPasswordReset = BehaviorAnalytics\r\n    | where ActionType == \"Reset user password\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == \"True\"\r\n    | join (\r\n        AuditLogs\r\n        | where OperationName == \"Reset user password\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Password Reset\",\r\n        Tactic = \"Impact\",\r\n        Technique = \"Account Access Removal\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts. LockerGoga, for example, has been observed changing account passwords and logging off current users. The query below generates an output of all users performing Reset user password for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalousGeoLocationLogon = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where ActivityInsights.FirstTimeUserConnectedFromCountry == True and (ActivityInsights.FirstTimeConnectionFromCountryObservedInTenant == True or ActivityInsights.CountryUncommonlyConnectedFromAmongPeers == True)\r\n    | join (\r\n        SigninLogs\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Initial Access\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access. The query below generates an output of successful Sign-in performed by a user from a new geo location he has never connected from before, and none of his peers as well.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousFailedLogon = BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\"\r\n    | where UsersInsights.BlastRadius == \"High\"\r\n    | join (\r\n        SigninLogs  \r\n        | where Status.errorCode == 50126\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Failed Logon\",\r\n        Tactic = \"Credential Access\",\r\n        Technique = \"Brute Force\",\r\n        SubTechnique = \"Password Guessing\",\r\n        Description = \"Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Emotet, for example, has been observed using a hard coded list of passwords to brute force user accounts. The query below generates an output of all users with 'High' BlastRadius that perform failed Sign-in:Invalid username or password.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousAADAccountManipulation = AuditLogs\r\n    | where OperationName == \"Update user\"\r\n    | mv-expand AdditionalDetails\r\n    | where AdditionalDetails.key == \"UserPrincipalName\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner ( \r\n        BehaviorAnalytics\r\n        | where ActionType == \"Update user\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName) \r\n    | extend AnomalyName = \"Anomalous Account Manipulation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access. The query below generates an output of all high Blast Radius users performing 'Update user' (name change) to priveleged role, or ones that changed users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let AnomalousAADAccountCreation = BehaviorAnalytics\r\n    | where ActionType == \"Add user\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == True or ActivityInsights.FirstTimeActionPerformedInTenant == True or ActivityInsights.ActionUncommonlyPerformedAmongPeers == true\r\n    | join(\r\n        AuditLogs\r\n        | where OperationName == \"Add user\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend DisplayName = tostring(UsersInsights.AccountDisplayName),\r\n        UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Account Creation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Create Account\",\r\n        SubTechnique = \"Cloud Account\",\r\n        Description = \"Adversaries may create a cloud account to maintain access to victim systems. With a sufficient level of access, such accounts may be used to establish secondary credentialed access that does not require persistent remote access tools to be deployed on the system. The query below generates an output of all the users performing user creation for the first time and the target users that were created.\"\t\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalyTable = union kind=outer AnomalousSigninActivity, AnomalousRoleAssignment, AnomalousResourceAccess, AnomalousRDPActivity, AnomalousPasswordReset, AnomalousLogintoDevices, AnomalousGeoLocationLogon, AnomalousAADAccountManipulation, AnomalousAADAccountCreation, AnomalousFailedLogon;\r\nlet TopUsersByAnomalies = AnomalyTable\r\n    | summarize hint.strategy = shuffle AnomalyCount=count() by UserName, UserPrincipalName, tostring(UsersInsights.OnPremSid), tostring(UsersInsights.AccountObjectId)\r\n    | project Name=tolower(UserName), UPN=tolower(UserPrincipalName), AadUserId=UsersInsights_AccountObjectId, Sid=UsersInsights_OnPremSid, AnomalyCount\r\n    | sort by AnomalyCount desc;\r\nlet TopUsersByIncidents = SecurityIncident\r\n    | summarize hint.strategy = shuffle arg_max(LastModifiedTime, *) by IncidentNumber\r\n    | where Status == \"New\" or Status == \"Active\"\r\n    | mv-expand AlertIds\r\n    | extend AlertId = tostring(AlertIds)\r\n    | join kind= innerunique ( \r\n        SecurityAlert \r\n        )\r\n        on $left.AlertId == $right.SystemAlertId\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n    | union TopUsersByAnomalies\r\n    | extend \r\n        AadPivot = iff(isempty(AadUserId), iff(isempty(Sid), Name, Sid), AadUserId),\r\n        SidPivot = iff(isempty(Sid), iff(isempty(AadUserId), Name, AadUserId), Sid),\r\n        UPNExists = iff(isempty(UPN), false, true),\r\n        NameExists = iff(isempty(Name), false, true),\r\n        SidExists = iff(isempty(Sid), false, true),\r\n        AADExists = iff(isempty(AadUserId), false, true)\r\n    | summarize hint.strategy = shuffle IncidentCount=dcount(IncidentNumber, 4), AlertCount=dcountif(AlertId, isnotempty(AlertId), 4), AnomalyCount=sum(AnomalyCount), any(Title, Severity, Status, StartTime, IncidentNumber, IncidentUrl, Owner), UPNAnchor=anyif(UPN, UPNExists == true), NameAnchor=anyif(Name, NameExists == true), AadAnchor=anyif(AadUserId, AADExists == true), SidAnchor=anyif(Sid, SidExists == true), any(SidPivot) by AadPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), NameAnchor=anyif(NameAnchor, isempty(NameAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_Title, any_Severity, any_StartTime, any_IncidentNumber, any_IncidentUrl) by any_SidPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_any_Title, any_any_Severity, any_any_StartTime, any_any_IncidentNumber, any_any_IncidentUrl) by NameAnchor\r\n    | project [\"UserName\"]=NameAnchor, IncidentCount, AlertCount, AnomalyCount, [\"AadUserId\"]=AadAnchor, [\"OnPremSid\"]=SidAnchor, [\"UserPrincipalName\"]=UPNAnchor;\r\nTopUsersByIncidents\r\n| where UserPrincipalName <> \"\"\r\n| where UserPrincipalName !contains \"[\"\r\n| project UserPrincipalName, IncidentCount, AlertCount, AnomalyCount\r\n| sort by AlertCount desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " User Entity Behavior Analytics Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "UserPrincipalName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "IncidentCount",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "redBright"
                              }
                            },
                            {
                              "columnMatch": "AlertCount",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "orange"
                              }
                            },
                            {
                              "columnMatch": "AnomalyCount",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellow"
                              }
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_heatmap_AlertCount_2",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_heatmap_AlertCount_2",
                            "sortOrder": 2
                          }
                        ],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "SigninStatus",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "Count",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "blue"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 2,
                                "maximumSignificantDigits": 3
                              }
                            }
                          },
                          "secondaryContent": {
                            "columnMatch": "Trend",
                            "formatter": 9,
                            "formatOptions": {
                              "palette": "green"
                            }
                          },
                          "showBorder": false
                        },
                        "mapSettings": {
                          "locInfo": "CountryRegion",
                          "locInfoColumn": "Location",
                          "latitude": "SourceIPLocation",
                          "longitude": "SourceIPLocation",
                          "sizeSettings": "Location",
                          "sizeAggregation": "Count",
                          "legendMetric": "Location",
                          "legendAggregation": "Count",
                          "itemColorSettings": {
                            "nodeColorField": "Location",
                            "colorAggregation": "Count",
                            "type": "thresholds",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blueDark"
                              }
                            ]
                          }
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where ProviderName == \"IPC\"\r\n| extend UserAccount = tostring(parse_json(ExtendedProperties).[\"User Account\"])\r\n| summarize count() by AlertName, AlertLink, ProductName, UserAccount\r\n| extend Count = count_\r\n| project AlertName, Count\r\n| sort by Count desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " AAD Identity Protection: Security Alerts ",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Alert >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let AnomalySignIns = BehaviorAnalytics\r\n| extend FirstTimeDeviceLogon = tostring(ActivityInsights.FirstTimeUserLoggedOnToDevice)\r\n| extend FirstTimeUserAction = tostring(ActivityInsights.FirstTimeUserPerformedAction)\r\n| extend UncommonAction = tostring(ActivityInsights.ActionUncommonlyPerformedByUser)\r\n| extend UncommonVolumeOfActions = tostring(ActivityInsights.UncommonHighVolumeOfActions)\r\n| where FirstTimeDeviceLogon == \"True\" or FirstTimeUserAction == \"True\" or UncommonAction == \"True\" or UncommonVolumeOfActions == \"True\";\r\nAnomalySignIns | join (SigninLogs) on UserPrincipalName",
                        "size": 3,
                        "showAnalytics": true,
                        "title": " Anomalous Activity by Geolocation",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "visualization": "map",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "UserPrincipalName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "UncommonActionVolume",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "redBright"
                              }
                            },
                            {
                              "columnMatch": "UncommonAction",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "green"
                              }
                            },
                            {
                              "columnMatch": "FirstTimeUserAction",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "FirstTimeDeviceLogon",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellow"
                              }
                            },
                            {
                              "columnMatch": "IncidentCount",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "redBright"
                              }
                            },
                            {
                              "columnMatch": "AlertCount",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "orange"
                              }
                            },
                            {
                              "columnMatch": "AnomalyCount",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellow"
                              }
                            }
                          ]
                        },
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "SigninStatus",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "Count",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "blue"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 2,
                                "maximumSignificantDigits": 3
                              }
                            }
                          },
                          "secondaryContent": {
                            "columnMatch": "Trend",
                            "formatter": 9,
                            "formatOptions": {
                              "palette": "green"
                            }
                          },
                          "showBorder": false
                        },
                        "mapSettings": {
                          "locInfo": "CountryRegion",
                          "locInfoColumn": "Location",
                          "latitude": "latitude_",
                          "longitude": "longitude_",
                          "sizeSettings": "Location",
                          "sizeAggregation": "Count",
                          "labelSettings": "city_",
                          "legendMetric": "Location",
                          "legendAggregation": "Count",
                          "itemColorSettings": {
                            "nodeColorField": "Location",
                            "colorAggregation": "Count",
                            "type": "thresholds",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "redBright"
                              }
                            ]
                          }
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "Results46"
                    }
                  ]
                },
                "name": "LT-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-3: Enable logging for security investigation](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-3-enable-logging-for-security-investigation)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Understand Logging and Different Log Types in Azure](https://docs.microsoft.com/azure/azure-monitor/essentials/platform-logs-overview)<br>\r\nüí° [Understand Microsoft Defender for Cloud Data Collection](https://docs.microsoft.com/azure/security-center/security-center-enable-data-collection)<br>\r\nüí° [Enable and configure antimalware monitoring](https://docs.microsoft.com/azure/security/fundamentals/antimalware#enable-and-configure-antimalware-monitoring-using-powershell-cmdlets)<br>\r\nüí° [Operating systems and application logs inside in your compute resources](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources#operating-system-guest)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.2, 8.5, 8.12](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.1, 10.2, 10.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"LT.3\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "union withsource = Table_Name *\r\n| project-rename Log_Tables=Table_Name\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Log_Tables\r\n| render areachart\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Logs by Type over Time",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "union withsource = Table_Name *\r\n| summarize count() by Table_Name\r\n| project-rename Log_Tables=Table_Name, Logs_Count=count_\r\n| sort by Logs_Count desc\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Logs Count by Data Table",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Count",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "LT-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-4: Enable network logging for security investigation](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-4-enable-network-logging-for-security-investigation)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/) ‚ú≥Ô∏è [Application Gateway]( https://azure.microsoft.com/services/application-gateway/)<br>\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n### Implementation\r\nüí° [How to Enable Network Security Group Flow Logs](https://docs.microsoft.com/azure/network-watcher/network-watcher-nsg-flow-logging-portal)<br>\r\nüí° [Azure Firewall Logs and Metrics](https://docs.microsoft.com/azure/firewall/logs-and-metrics)<br>\r\nüí° [Azure Networking Monitoring Solutions in Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/azure-networking-analytics)<br>\r\nüí° [Gather Insights About Your DNS Infrastructure With the DNS Analytics Solution](https://docs.microsoft.com/azure/azure-monitor/insights/dns-analytics)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls) <br>\r\nüîÄ [Azure Web Application Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies) <br>\r\nüîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.2, 8.5, 8.6, 8.7, 13.6](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.8](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"LT.4\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "where type contains \"microsoft.network\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Networking Assets",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDiagnostics\r\n| where OperationName == \"NetworkSecurityGroupEvents\"\r\n| summarize count() by ruleName_s\r\n| sort by count_ desc \r\n| render piechart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Network Security Groups: Rules Triggered",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDiagnostics\r\n| where Category contains \"AzureFirewall\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by¬†OperationName\r\n| render areachart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Azure Firewall + Azure WAF Actions over Time",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 6"
                    }
                  ]
                },
                "name": "LT-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-5: Centralize security log management and analysis](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-5-centralize-security-log-management-and-analysis)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Usage](https://docs.microsoft.com/azure/azure-monitor/reference/tables/usage) ‚ú≥Ô∏è [Azure Monitor](https://azure.microsoft.com/services/monitor/) <br> \r\n\r\n### Implementation\r\nüí° [How to Collect Platform Logs and Metrics with Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/essentials/diagnostic-settings)<br>\r\nüí° [How to Onboard Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.9, 8.11, 13.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"LT.5\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "union withsource=_TableName *\r\n| summarize Entries = count(), Size = sum(_BilledSize), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by _TableName, _IsBillable\r\n| project ['Table Name'] = _TableName, ['Table Size'] = Size, ['Table Entries'] = Entries,\r\n          ['Size per Entry'] = 1.0 * Size / Entries, ['IsBillable'] = _IsBillable\r\n| order by ['Table Size']  desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Log Table Management",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Table Name",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "uninitialized",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Table Size",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "purple"
                              },
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "Table Entries",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "turquoise"
                              },
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "Size per Entry",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "blue"
                              },
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "IsBillable",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "True",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "False",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Important",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_IsBillable_4",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_IsBillable_4",
                            "sortOrder": 2
                          }
                        ],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "DataType",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "count_",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "auto"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "maximumSignificantDigits": 3,
                                "maximumFractionDigits": 2
                              }
                            }
                          },
                          "showBorder": false
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "union withsource=_TableName *\r\n| summarize count() , Size = sum(_BilledSize) by bin(_TimeReceived, 1m), Type, _IsBillable\r\n| extend counttemp =count_ / 60\r\n| summarize \r\n           ['Current EPS Average']=avg(counttemp), ['Minimum EPS']=min(counttemp),\r\n           ['Maximum EPS']=max(counttemp)\r\n  by ['Table Name']=Type\r\n| order  by ['Current EPS Average'] desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Log Table Events Per Second (EPS) Management",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Table Name",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "uninitialized",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Current EPS Average",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blueDark"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            },
                            {
                              "columnMatch": "Minimum EPS",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "red"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            },
                            {
                              "columnMatch": "Maximum EPS",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "green"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "Table Size",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "purple"
                              },
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "Table Entries",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "turquoise"
                              },
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "Size per Entry",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "blue"
                              },
                              "numberFormat": {
                                "unit": 2,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            {
                              "columnMatch": "IsBillable",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "True",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "False",
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Important",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_bar_Current EPS Average_1",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_bar_Current EPS Average_1",
                            "sortOrder": 2
                          }
                        ],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "DataType",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "count_",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "auto"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "maximumSignificantDigits": 3,
                                "maximumFractionDigits": 2
                              }
                            }
                          },
                          "showBorder": false
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "LT-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-6: Configure log storage retention](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-6-configure-log-storage-retention)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n### Implementation\r\nüí° [Change the Data Retention Period in Log Analytics](https://docs.microsoft.com/azure/azure-monitor/logs/manage-cost-storage#change-the-data-retention-period)<br>\r\nüí° [How to Configure Retention Policy for Azure Storage Account Logs](https://docs.microsoft.com/azure/storage/common/manage-storage-analytics-logs#configure-logging)<br>\r\nüí° [Microsoft Defender for Cloud Alerts and Recommendations Export](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.3, 8.10](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.5, 10.7](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"LT.6\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Workspace Name']=id, ['Data Retention(days)']=retentionDays, ['Daily Data Cap']=dailyquotaGB, ['Resource Group']=resourceGroup, location, ['License']=sku",
                        "size": 2,
                        "showAnalytics": true,
                        "title": " Log Retention Configurations",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "visualization": "table",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Computer",
                              "formatter": 16,
                              "formatOptions": {
                                "showIcon": true
                              }
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_link_Workspace Name_0",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_link_Workspace Name_0",
                            "sortOrder": 1
                          }
                        ],
                        "tileSettings": {
                          "titleContent": {
                            "columnMatch": "type",
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "count_",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "auto"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 2,
                                "maximumSignificantDigits": 3
                              }
                            }
                          },
                          "showBorder": false
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4"
                    }
                  ]
                },
                "name": "LT-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [LT-7: Use approved time synchronization sources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection#lt-7-use-approved-time-synchronization-sources)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [VMConnection](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmconnection) ‚ú≥Ô∏è [Service Map](https://docs.microsoft.com/azure/azure-monitor/vm/service-map) <br> \r\n\r\n### Implementation\r\nüí° [How to Configure Time Synchronization for Azure Windows Compute Resources](https://docs.microsoft.com/azure/virtual-machines/windows/time-sync)<br>\r\nüí° [How to Configure Time Synchronization for Azure Linux Compute Resources](https://docs.microsoft.com/azure/virtual-machines/linux/time-sync)<br>\r\nüí° [How to Disable Inbound UDP for Azure Services](https://support.microsoft.com/help/4558520/how-to-disable-inbound-udp-for-azure-services)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure AD Domain Services](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.AAD%2FdomainServices) <br>\r\nüîÄ [Virtual Machines](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FVirtualMachines) <br>\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.4](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "LT-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "VMConnection\r\n| where Direction == \"outbound\"\r\n| where Protocol == \"udp\"\r\n| where DestinationPort == \"123\"\r\n| extend NTPDestination = tostring(parse_json(RemoteDnsQuestions)[0])\r\n| where NTPDestination <> \"\"\r\n| summarize count() by NTPDestination\r\n| sort by count_ desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Network Time Protocol Calls",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "VMConnection\r\n| where Direction == \"outbound\"\r\n| where Protocol == \"udp\"\r\n| where DestinationPort == \"123\"\r\n| where RemoteCountry <> \"\"\r\n| extend NTPDestination = tostring(parse_json(RemoteDnsQuestions)[0])\r\n| where NTPDestination <> \"\"\r\n",
                        "size": 3,
                        "showAnalytics": true,
                        "title": " Network Time Protocol Calls by Remote Country",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "visualization": "map",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        },
                        "mapSettings": {
                          "locInfo": "CountryRegion",
                          "locInfoColumn": "RemoteCountry",
                          "latitude": "RemoteLatitude",
                          "longitude": "RemoteLongitude",
                          "sizeSettings": "DestinationPort",
                          "sizeAggregation": "Sum",
                          "labelSettings": "RemoteCountry",
                          "legendMetric": "DestinationPort",
                          "legendAggregation": "Sum",
                          "itemColorSettings": {
                            "nodeColorField": "DestinationPort",
                            "colorAggregation": "Sum",
                            "type": "heatmap",
                            "heatmapPalette": "blueOrange"
                          }
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isLTVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "LT-7",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isLTVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Logging & Threat Detection Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Incident Response (IR)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response)\r\n---\r\nIncident Response covers controls in incident response life cycle - preparation, detection and analysis, containment, and post-incident activities, including using Azure services such as Microsoft Defender for Cloud and Sentinel to automate the incident response process. "
                },
                "customWidth": "40",
                "name": "IR Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 9"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "IR-1",
                      "linkTarget": "step",
                      "linkLabel": "IR-1: Preparation - update incident response plan and handling process",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "IR-2",
                      "linkTarget": "step",
                      "linkLabel": "IR-2: Preparation - setup incident notification",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "IR-3",
                      "linkTarget": "step",
                      "linkLabel": "IR-3: Detection and analysis - create incidents based on high-quality alerts",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "IR-4",
                      "linkTarget": "step",
                      "linkLabel": "IR-4: Detection and analysis - investigate an incident",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                      "cellValue": "IR-5",
                      "linkTarget": "step",
                      "linkLabel": "IR-5: Detection and analysis - prioritize incidents",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                      "cellValue": "IR-6",
                      "linkTarget": "step",
                      "linkLabel": "IR-6: Containment, eradication and recovery - automate the incident handling",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "a3371fdb-049b-46b3-88a3-452549fad586",
                      "cellValue": "IR-7",
                      "linkTarget": "step",
                      "linkLabel": "IR-7: Post-incident activity - conduct lesson learned and retain evidence",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "IR Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-1: Preparation - update incident response plan and handling process](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-1-preparation---update-incident-response-plan-and-handling-process)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Implementation\r\nüí° [Implement Security Across the Enterprise Environment](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#3-process-assign-accountability-for-cloud-security-decisions)<br>\r\nüí° [Incident Response Reference Guide](https://docs.microsoft.com/microsoft-365/downloads/IR-Reference-Guide.pdf)<br>\r\nüí° [NIST SP 800-61 Computer Security Incident Handling Guide](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[17.4, 17.7](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.8](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Building Your Own Security Incident Response Process](https://msrc-blog.microsoft.com/2019/07/01/inside-the-msrc-building-your-own-security-incident-response-process/) \r\n![Image Name](https://msrc-blog.microsoft.com/wp-content/uploads/2019/01/sdf.jpg)\r\n\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 5"
                    }
                  ]
                },
                "name": "IR-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-2: Preparation - setup incident notification](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-2-preparation---setup-incident-notification)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Implementation\r\nüí° [How to Set the Microsoft Defender for Cloud Security Contact](https://docs.microsoft.com/azure/security-center/security-center-provide-security-contact-details)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Logic%2Fworkflows) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[17.1, 17.3, 17.6](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-8, IR-5, IR-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[12.10](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"IR.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n|¬†where¬†type¬†==¬†\"microsoft.logic/workflows\"\r\n|¬†extend¬†Connection¬†=¬†parse_json(properties)[\"parameters\"][\"$connections\"][\"value\"]\r\n|¬†where¬†Connection¬†has¬†\"managedApis/azuresentinel\"\r\n| where id contains \"push\" or id contains \"send\" or id contains \"message\" or id contains \"text\" or id contains \"email\" or id contains \"notif\" or id contains \"team\" or id contains \"post\"\r\n| project id, type, resourceGroup",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Microsoft Sentinel (SOAR) Notification Playbooks Configured",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity\r\n| where OperationNameValue startswith \"Microsoft.Logic\"\r\n| where ActivityStatusValue == \"Success\" or ActivityStatusValue == \"Succeeded\"\r\n| extend scope_ = tostring(Authorization_d.scope)\r\n| parse-where scope_ with * 'workflows/' PlaybookName '/' *\r\n| where PlaybookName contains \"notify\" or PlaybookName contains \"email\" or PlaybookName contains \"teams\" or PlaybookName contains \"ticket\" or PlaybookName contains \"post\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by PlaybookName\r\n| render timechart ",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Microsoft Sentinel (SOAR) Notification Playbooks Triggered over Time",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 5 - Copy",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "IR-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-3: Detection and analysis - create incidents based on high-quality alerts](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-3-detection-and-analysis---create-incidents-based-on-high-quality-alerts)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Implementation\r\nüí° [How to Configure Export](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\nüí° [How to Stream Alerts Into Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/connect-azure-security-center)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[17.9](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-5, IR-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.8](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"IR.3\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n    | summarize hint.strategy = shuffle arg_max(LastModifiedTime, *) by IncidentNumber\r\n    | mv-expand AlertIds\r\n    | extend AlertId = tostring(AlertIds)\r\n    | join kind= innerunique ( \r\n        SecurityAlert \r\n)\r\n        on $left.AlertId == $right.SystemAlertId\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n| distinct Title, IncidentNumber, IncidentUrl, Severity, Status, ProductName, ModifiedBy, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Security Incidents",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Title",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "info",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ProductName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "pending",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "IncidentURL",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Incident >"
                              }
                            },
                            {
                              "columnMatch": "IncidentUrl",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Incident >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4"
                    }
                  ]
                },
                "name": "IR-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-4: Detection and analysis - investigate an incident](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-4-detection-and-analysis---investigate-an-incident)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Implementation\r\nüí° [Snapshot a Windows Machine's Disk](https://docs.microsoft.com/azure/virtual-machines/windows/snapshot-copy-managed-disk)<br>\r\nüí° [Snapshot a Linux Machine's Disk](https://docs.microsoft.com/azure/virtual-machines/linux/snapshot-copy-managed-disk)<br>\r\nüí° [Microsoft Azure Support Diagnostic Information and Memory Dump Collection](https://azure.microsoft.com/support/legal/support-diagnostic-information-collection/)<br>\r\nüí° [Investigate Incidents with Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-investigate-cases)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[12.10](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| summarize count() by AlertName, ProductName\r\n| sort by count_ desc\r\n| limit 250\r\n\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Detected Attack Techniques",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ProductName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "pending",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": ""
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "redBright"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where Tactics <> \"Unknown\"\r\n| summarize count() by Tactics\r\n| sort by count_ desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " MITRE ATT&CK Tactics Observed",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ProductName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "resource",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4"
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Investigate Incidents with Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-investigate-cases) \r\n![Image Name](https://docs.microsoft.com/azure/sentinel/media/tutorial-investigate-cases/investigation-map.png)\r\n\r\n"
                      },
                      "customWidth": "50",
                      "name": "text - 5"
                    }
                  ]
                },
                "name": "IR-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-5: Detection and analysis - prioritize incidents](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-5-detection-and-analysis---prioritize-incidents)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br>\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Implementation\r\nüí° [Security Alerts in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-alerts-overview)<br>\r\nüí° [Use Tags to Organize Your Azure Resources](https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) \r\n\r\n### CIS Controls v8 IDs\r\n[17.4, 17.9](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[12.10](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n| where Status <> \"Closed\"\r\n| summarize count() by Severity\r\n| render barchart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Open Incidents by Priority",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Low",
                              "color": "yellow"
                            },
                            {
                              "seriesName": "Medium",
                              "color": "orange"
                            },
                            {
                              "seriesName": "High",
                              "color": "red"
                            },
                            {
                              "seriesName": "Informational",
                              "color": "gray"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": " Open Incidents by Priority",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Severity\r\n| render areachart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Security Incident Severity Count over Time",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ]
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Low",
                              "color": "yellow"
                            },
                            {
                              "seriesName": "Medium",
                              "color": "orange"
                            },
                            {
                              "seriesName": "High",
                              "color": "red"
                            },
                            {
                              "seriesName": "Informational",
                              "color": "gray"
                            }
                          ]
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "üü¶ Security Incident Priorities over Time"
                    }
                  ]
                },
                "name": "IR-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-6: Containment, eradication and recovery - automate the incident handling](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-6-containment-eradication-and-recovery---automate-the-incident-handling)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> üî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Implementation\r\nüí° [Configure Workflow Automation in Security Center](https://docs.microsoft.com/azure/security-center/workflow-automation)<br>\r\nüí° [Setup Automated Threat Responses in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/tutorial-security-incident#triage-security-alerts)<br>\r\nüí° [Setup Automated Threat Responses in Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Logic%2Fworkflows) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[N/A](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-5, IR-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[12.10](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n|¬†where¬†type¬†==¬†\"microsoft.logic/workflows\"\r\n|¬†extend¬†Connection¬†=¬†parse_json(properties)[\"parameters\"][\"$connections\"][\"value\"]\r\n|¬†where¬†Connection¬†has¬†\"managedApis/azuresentinel\"\r\n| project id, type, resourceGroup",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Microsoft Sentinel (SOAR) Playbooks Configured",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity\r\n| where OperationNameValue startswith \"Microsoft.Logic\"\r\n| where ActivityStatusValue == \"Success\" or ActivityStatusValue == \"Succeeded\"\r\n| extend scope_ = tostring(Authorization_d.scope)\r\n| parse-where scope_ with * 'workflows/' PlaybookName '/' *\r\n| where PlaybookName contains \"notify\" or PlaybookName contains \"email\" or PlaybookName contains \"teams\" or PlaybookName contains \"ticket\" or PlaybookName contains \"post\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by PlaybookName\r\n| render timechart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Microsoft Sentinel (SOAR) Playbooks Triggered over Time",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Resource",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "uninitialized",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "IR-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [IR-7: Post-incident activity - conduct lesson learned and retain evidence](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response#ir-7-post-incident-activity---conduct-lesson-learned-and-retain-evidence)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident)\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Implementation\r\nüí° [Incident response process - Post-incident cleanup](https://docs.microsoft.com/security/compass/incident-response-process#2-post-incident-cleanup)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[17.8](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[12.10](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isIRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "IR-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n| where Severity == \"High\"\r\n| summarize count() by Title\r\n| sort by count_ desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Most Common High Severity Incidents",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Alert >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "Security Alerts over Time"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n| where Status == 'Closed'\r\n| extend Tactics = todynamic(AdditionalData.tactics)\r\n| extend Owner = todynamic(Owner.assignedTo) \r\n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \r\n| extend feedback =strcat(Classification,\" \",ClassificationReason)\r\n| summarize dcount(IncidentNumber) by feedback\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Case Closure Designations",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "visualization": "piechart",
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "Description",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": false,
                                "customColumnWidthSetting": "60%"
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "5%"
                              }
                            },
                            {
                              "columnMatch": "severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Critical",
                                    "representation": "critical",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Major",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": null,
                                    "text": "{0}{1}"
                                  }
                                ],
                                "customColumnWidthSetting": "5"
                              }
                            },
                            {
                              "columnMatch": "message",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": false,
                                "customColumnWidthSetting": "70%"
                              }
                            }
                          ]
                        },
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "kwSum",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "greenRed"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 2,
                                "maximumSignificantDigits": 3
                              }
                            }
                          },
                          "showBorder": false,
                          "size": "auto"
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Low",
                              "color": "yellow"
                            },
                            {
                              "seriesName": "Medium",
                              "color": "orange"
                            },
                            {
                              "seriesName": "High",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Informational",
                              "color": "blue"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 6"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "title": "Incident Response/Resolution Times",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SecurityIncident\n| extend Tactics = todynamic(AdditionalData.tactics)\n| extend Owner = todynamic(Owner.assignedTo) \n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| summarize arg_max(LastModifiedTime,*) by IncidentNumber \n| extend TimeToTriage =  (FirstModifiedTime - CreatedTime)/1h\n| summarize 50th_Percentile=percentile(TimeToTriage, 50) \n",
                              "size": 1,
                              "showAnalytics": true,
                              "title": "Mean Time To Respond",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.",
                              "timeContext": {
                                "durationMs": 604800000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "visualization": "tiles",
                              "tileSettings": {
                                "titleContent": {
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "50th_Percentile",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "auto"
                                  },
                                  "numberFormat": {
                                    "unit": 26,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false,
                                      "maximumFractionDigits": 3
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 2"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "SecurityIncident\n| extend Tactics = todynamic(AdditionalData.tactics)\n| extend Owner = todynamic(Owner.assignedTo) \n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| summarize arg_max(TimeGenerated,*) by IncidentNumber \n| extend TimeToClosure =  (ClosedTime - CreatedTime)/1h\n| summarize 50th_Percentile=percentile(TimeToClosure, 50)",
                              "size": 1,
                              "showAnalytics": true,
                              "title": "Mean Time To Resolve",
                              "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.",
                              "timeContext": {
                                "durationMs": 604800000
                              },
                              "timeContextFromParameter": "TimeRange",
                              "showExportToExcel": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "visualization": "tiles",
                              "sortBy": [],
                              "tileSettings": {
                                "titleContent": {
                                  "columnMatch": "Classification",
                                  "formatter": 1,
                                  "formatOptions": {}
                                },
                                "leftContent": {
                                  "columnMatch": "50th_Percentile",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "auto"
                                  },
                                  "numberFormat": {
                                    "unit": 26,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false,
                                      "maximumFractionDigits": 3
                                    }
                                  }
                                },
                                "showBorder": false,
                                "size": "auto"
                              }
                            },
                            "customWidth": "50",
                            "name": "query - 2"
                          }
                        ]
                      },
                      "customWidth": "50",
                      "name": "Incident Response/Resolution Times"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n| where Status == \"Closed\"\r\n| extend AssignedAnalyst = tostring(Owner.assignedTo)\r\n| where AssignedAnalyst <> \"\"\r\n| summarize count() by AssignedAnalyst\r\n| sort by count_ desc\r\n| limit 250\r\n| render barchart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Analyst Throughput: Closed Cases by Analyst",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Description",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": false,
                                "customColumnWidthSetting": "60%"
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 0,
                              "formatOptions": {
                                "customColumnWidthSetting": "5%"
                              }
                            },
                            {
                              "columnMatch": "severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Critical",
                                    "representation": "critical",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Major",
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": null,
                                    "text": "{0}{1}"
                                  }
                                ],
                                "customColumnWidthSetting": "5"
                              }
                            },
                            {
                              "columnMatch": "message",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "CellDetails",
                                "linkIsContextBlade": false,
                                "customColumnWidthSetting": "70%"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "tileSettings": {
                          "titleContent": {
                            "formatter": 1
                          },
                          "leftContent": {
                            "columnMatch": "kwSum",
                            "formatter": 12,
                            "formatOptions": {
                              "palette": "greenRed"
                            },
                            "numberFormat": {
                              "unit": 17,
                              "options": {
                                "style": "decimal",
                                "maximumFractionDigits": 2,
                                "maximumSignificantDigits": 3
                              }
                            }
                          },
                          "showBorder": false,
                          "size": "auto"
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Low",
                              "color": "yellow"
                            },
                            {
                              "seriesName": "Medium",
                              "color": "orange"
                            },
                            {
                              "seriesName": "High",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Informational",
                              "color": "blue"
                            }
                          ]
                        }
                      },
                      "name": "query - 6"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityIncident\r\n| summarize arg_max(LastModifiedTime,*) by IncidentNumber\r\n| where Status == \"Closed\"\r\n| extend TimeToRespond =  (CreatedTime - FirstActivityTime)/1h \r\n| extend TimeToResolve =  (ClosedTime - CreatedTime)/1h\r\n| extend AssignedAnalyst = tostring(Owner.assignedTo)\r\n| extend [\"MITRE ATT&CK Tactics\"] = tostring(parse_json(tostring(AdditionalData.tactics))[0])\r\n| project IncidentName=Title, IncidentNumber, Severity, [\"MITRE ATT&CK Tactics\"], AssignedAnalyst, Classification, ClassificationComment, ClassificationReason, Description, TimeToRespond, TimeToResolve, IncidentUrl, IncidentStartTime=CreatedTime, IncidentClosedTime=ClosedTime\r\n| sort by IncidentClosedTime desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Incident Closure Reports",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 604800000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "IncidentName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "Sev0",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "Sev1",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "Sev2",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Sev3",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "TimeToRespond",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 27,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "TimeToResolve",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 27,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "IncidentUrl",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Incident >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": ""
                              }
                            },
                            {
                              "columnMatch": "ComplianceDomain",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "mapSettings": {
                          "locInfo": "LatLong",
                          "locInfoColumn": "Location",
                          "latitude": "latitude_",
                          "longitude": "longitude_",
                          "sizeSettings": "city_",
                          "sizeAggregation": "Count",
                          "labelSettings": "city_",
                          "legendMetric": "city_",
                          "numberOfMetrics": 100,
                          "legendAggregation": "Count",
                          "itemColorSettings": {
                            "nodeColorField": "state_",
                            "colorAggregation": "Count",
                            "type": "heatmap",
                            "heatmapPalette": "coldHot"
                          }
                        }
                      },
                      "name": "query - 9 - Copy"
                    }
                  ]
                },
                "name": "IR-7",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isIRVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Incident Response Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Posture and Vulnerability Management (PV)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management)\r\n---\r\nPosture and Vulnerability Management focuses on controls for assessing and improving Azure security posture, including vulnerability scanning, penetration testing and remediation, as well as security configuration tracking, reporting, and correction in Azure resources. "
                },
                "customWidth": "40",
                "name": "PV Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 11"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "PV-1",
                      "linkTarget": "step",
                      "linkLabel": "PV-1: Define and establish secure configurations",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "PV-2",
                      "linkTarget": "step",
                      "linkLabel": "PV-2: Audit and enforce secure configurations",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "PV-3",
                      "linkTarget": "step",
                      "linkLabel": "PV-3: Define and establish secure configurations for compute resources",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "PV-4",
                      "linkTarget": "step",
                      "linkLabel": "PV-4: Audit and enforce secure configurations for compute resources",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                      "cellValue": "PV-5",
                      "linkTarget": "step",
                      "linkLabel": "PV-5: Perform vulnerability assessments",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "908e66bd-613c-4dbc-ab88-2f9f09403916",
                      "cellValue": "PV-6",
                      "linkTarget": "step",
                      "linkLabel": "PV-6: Rapidly and automatically remediate vulnerabilities",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "8014e5ef-73b7-4ce1-8f07-24f847cc07bd",
                      "cellValue": "PV-7",
                      "linkTarget": "step",
                      "linkLabel": "PV-7: Conduct regular red team operations",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "PV Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-1: Define and establish secure configurations](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-1-define-and-establish-secure-configurations)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Illustration of Guardrails Implementation in Enterprise-Scale Landing Zone](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/architecture#landing-zone-expanded-definition)<br>\r\nüí° [Working with Security Policies in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/tutorial-security-policy)<br>\r\nüí° [Tutorial: Create and manage policies to enforce compliance](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüí° [Azure Blueprints](https://docs.microsoft.com/azure/governance/blueprints/overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Blueprints](https://portal.azure.com/#blade/Microsoft_Azure_Policy/BlueprintsMenuBlade/GetStarted)<br>\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.1, 4.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityRegulatoryCompliance\r\n| summarize count() by ComplianceStandard\r\n| sort by count_ desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Regulatory Compliance Assessments by Standard Policy Checks",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 1"
                    }
                  ]
                },
                "name": "PV-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-2: Audit and enforce secure configurations](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-2-audit-and-enforce-secure-configurations)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Understand Azure Policy Effects](https://docs.microsoft.com/azure/governance/policy/concepts/effects)<br>\r\nüí° [Create and Manage Policies to Enforce Compliance](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüí° [Get compliance data of Azure resources](https://docs.microsoft.com/azure/governance/policy/how-to/get-compliance-data)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.1, 4.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PV.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"PV.2\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "PV-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-3: Define and establish secure configurations for compute resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-3-define-and-establish-secure-configurations-for-compute-resources)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityBaselines](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securitybaseline) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br>  \r\n\r\n### Implementation\r\nüí° [Apply Azure security baselines to machines](https://docs.microsoft.com/azure/defender-for-cloud/apply-security-baseline)<br>\r\nüí° [Linux OS security configuration baseline](https://docs.microsoft.com/azure/governance/policy/samples/guest-configuration-baseline-linux)<br>\r\nüí° [Windows OS security configuration baseline](https://docs.microsoft.com/azure/governance/policy/samples/guest-configuration-baseline-windows)<br>\r\nüí° [Security configuration recommendation for compute resources](https://docs.microsoft.com/azure/security-center/recommendations-reference)<br>\r\nüí° [Azure Automation State Configuration Overview](https://docs.microsoft.com/azure/automation/automation-dsc-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud: Recommendations](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/5)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "let FailedAssets=SecurityBaseline\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId, Description\r\n| where AnalyzeResult == \"Failed\"\r\n| summarize FailedAssets = makelist(Computer) by Description;\r\nlet PassedAssets=SecurityBaseline\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId, Description\r\n| where AnalyzeResult == \"Passed\"\r\n| summarize PassedAssets = makelist(Computer) by Description;\r\nSecurityBaseline\r\n| summarize arg_max(TimeGenerated, *) by _ResourceId, Description\r\n| summarize\r\n    Failed‚ÄØ=‚ÄØcountif(AnalyzeResult == \"Failed\"),\r\n    Passed‚ÄØ=‚ÄØcountif(AnalyzeResult == \"Passed\"),\r\n    Total‚ÄØ=‚ÄØcountif(AnalyzeResult == \"Failed\" or AnalyzeResult == \"Passed\")\r\n    by Description\r\n| extend PassedControls‚ÄØ= (Passed / todouble(Total)) * 100\r\n| join kind=fullouter(FailedAssets) on Description\r\n| join kind=fullouter(PassedAssets) on Description\r\n| project Description, Total, PassedControls, Passed, Failed, PassedAssets, FailedAssets\r\n| sort by Total, Passed desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Configure Security Baselines",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "ControlNumber",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "AllServices",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "!=",
                                    "thresholdValue": "Healthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "PV-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-4: Audit and enforce secure configurations for compute resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-4-audit-and-enforce-secure-configurations-for-compute-resources)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to Implement Microsoft Defender for Cloud Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [How to Create an Azure Virtual Machine from an ARM Template](https://docs.microsoft.com/azure/virtual-machines/windows/ps-template)<br>\r\nüí° [Azure Automation State Configuration Overview](https://docs.microsoft.com/azure/automation/automation-dsc-overview)<br>\r\nüí° [Create a Windows Virtual Machine in the Azure portal](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal)<br>\r\nüí° [Container Security in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/container-security)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PV.4\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"PV.4\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 2
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "PV-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-5: Perform vulnerability assessments](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-5-perform-vulnerability-assessments)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) üî∑ [SecurityNestedRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) üî∑ [SecurityBaseline](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securitybaseline) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to Implement Microsoft Defender for Cloud Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [Integrated Vulnerability Scanner for Virtual Machines](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [SQL Vulnerability Assessment](https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment)<br>\r\nüí° [Exporting Microsoft Defender for Cloud Vulnerability Scan Results](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[5.5, 7.1, 7.5, 7.6](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[RA-3, RA-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[6.1, 6.2, 6.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PV.5\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityNestedRecommendation\r\n| where RecommendationState == \"Unhealthy\"\r\n| summarize count() by RecommendationName, RecommendationSeverity\r\n| sort by count_ desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " Patches, Updates & Vulnerabilities",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "Link_",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "Count",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            },
                            {
                              "columnMatch": "RecommendationClick",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Click to Recommendation"
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "query - 4"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityBaseline\r\n| where CceId <> \"\"\r\n|project CceId, RuleSeverity, Description, ResourceId\r\n|limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Vulnerability Management",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore This Control Further and Implement Solutions                                                                                                                                               ‚Ä¢    Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Adjust the Time Paramenter for a Larger Data-Set                                                                                                                                                                          ‚Ä¢    Panels Can Display 'No Data' if All Recommendations are Fully Implemented, See Azure Security Center Recommendations                                                                                                                                   ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Pary Tooling Requirements",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "CceId",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Defense Evasion",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RuleSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "4",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Resource",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "PV-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-6: Rapidly and automatically remediate vulnerabilities](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to Configure Update Management for Virtual Machines in Azure](https://docs.microsoft.com/azure/automation/update-management/overview)<br>\r\nüí° [Manage Updates and Patches for Your Azure VMs](https://docs.microsoft.com/azure/automation/update-management/manage-updates-for-vm)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[7.2, 7.3, 7.4, 7.7](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[RA-3, RA-5, SI-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[6.1, 6.2, 6.5, 11.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"PV.6\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"PV.6\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "PV-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [PV-7: Conduct regular red team operations](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management#pv-7-conduct-regular-red-team-operations)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Implementation\r\nüí° [Penetration Testing in Azure](https://docs.microsoft.com/azure/security/fundamentals/pen-testing)<br>\r\nüí° [Penetration Testing Rules of Engagement](https://www.microsoft.com/msrc/pentest-rules-of-engagement?rtc=1)<br>\r\nüí° [Microsoft Cloud Red Teaming](https://download.microsoft.com/download/C/1/9/C1990DBA-502F-4C2A-848D-392B93D9B9C3/Microsoft_Enterprise_Cloud_Red_Teaming.pdf)<br>\r\nüí° [Technical Guide to Information Security Testing and Assessment](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft 365 Compliance Center](https://compliance.microsoft.com/) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[18.1, 18.2, 18.3, 18.4, 18.5](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CA-8, RA-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[6.6, 11.2, 11.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "PV-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [SimuLand for Attack Simulation](https://www.microsoft.com/security/blog/2021/05/20/simuland-understand-adversary-tradecraft-and-improve-detection-strategies/)\r\n![Image¬†Name](https://www.microsoft.com/security/blog/wp-content/uploads/2021/05/Map-of-threat-research.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 3 - Copy"
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Attack Simulator in the Security & Compliance Center](https://docs.microsoft.com/azure/automation/update-management/overview)\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/9bd65af4-1f9d-45c1-8c06-796d7ccfd425.jpg)¬†\r\n\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isPVVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 3"
                    }
                  ]
                },
                "name": "PV-7",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isPVVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Posture & Vulnerability Management"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Endpoint Security (ES)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security) \r\n---\r\nEndpoint Security covers controls in endpoint detection and response, including use of endpoint detection and response (EDR) and anti-malware service for endpoints in Azure environments. "
                },
                "customWidth": "40",
                "name": "ES Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 6"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "ES-1",
                      "linkTarget": "step",
                      "linkLabel": "ES-1: Use Endpoint Detection and Response (EDR)",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "ES-2",
                      "linkTarget": "step",
                      "linkLabel": "ES-2: Use modern anti-malware software",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "ES-3",
                      "linkTarget": "step",
                      "linkLabel": "ES-3: Ensure anti-malware software and signatures are updated",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "ES Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [ES-1: Use Endpoint Detection and Response (EDR)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security#es-1-use-endpoint-detection-and-response-edr)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\n\r\n### Implementation\r\nüí° [Microsoft Defender for Cloud introduction](https://docs.microsoft.com/azure/security-center/defender-for-servers-introduction)<br>\r\nüí° [Microsoft Defender for Endpoint Overview](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/microsoft-defender-advanced-threat-protection)<br>\r\nüí° [Microsoft Defender for Cloud feature coverage for machines](https://docs.microsoft.com/azure/security-center/security-center-services?tabs=features-windows)<br>\r\nüí° [Connector for Defender for servers integration into SIEM](https://docs.microsoft.com/azure/security-center/security-center-wdatp?WT.mc_id=Portal-Microsoft_Azure_Security_CloudNativeCompute&tabs=windows)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v8 IDs\r\n[13.7](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-3, SI-2, SI-3, SI-16](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[11.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isESVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "ES-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where RecommendationName contains \"endpoint protection\" or RecommendationName contains \"defender for server\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where ProductName == \"Microsoft Defender Advanced Threat Protection\"\r\n| project AlertName, AlertType, AlertSeverity, Description, TimeGenerated, AlertLink \r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Microsoft Defender for Endpoint Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "ES-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [ES-2: Use modern anti-malware software](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security#es-2-use-modern-anti-malware-software)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Implementation\r\nüí° [Supported Endpoint Protection Solutions](https://docs.microsoft.com/azure/security-center/security-center-services?tabs=features-windows#supported-endpoint-protection-solutions-)<br>\r\nüí° [How to Configure Microsoft Antimalware for Cloud Services and Virtual Machines](https://docs.microsoft.com/azure/security/fundamentals/antimalware)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v8 IDs\r\n[10.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SC-3, SI-2, SI-3, SI-16](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[5.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isESVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "ES-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"ES.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where AlertName contains \"tool\" or AlertName contains \"mal\" or AlertName contains \"ware\" or AlertName contains \"mining\" or AlertName contains \"anti\" or AlertName contains \"exploit\" or AlertName contains \"inject\" or AlertName contains \"program\" or AlertName contains \"virus\" or AlertName contains \"worm\"\r\n| where AlertName !contains \"URL\"\r\n| where AlertName !contains \"net\"\r\n| where AlertName !contains \"web\"\r\n| project AlertName, ProductName, AlertType, AlertSeverity, TimeGenerated, AlertLink\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Anti-Malware Alerts",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "ES-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [ES-3: Ensure anti-malware software and signatures are updated](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security#es-3-ensure-anti-malware-software-and-signatures-are-updated)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) üî∑ [ProtectionStatus](https://docs.microsoft.com/azure/azure-monitor/reference/tables/protectionstatus) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [How to Deploy Microsoft Antimalware for Azure Cloud Services and Virtual Machines](https://docs.microsoft.com/azure/security/fundamentals/antimalware)<br>\r\nüí° [Endpoint protection assessment and recommendations in Microsoft Defender for Cloud](https://docs.microsoft.com/azure/security-center/security-center-endpoint-protection)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Defender](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v8 IDs\r\n[10.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SI-2, SI-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[5.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isESVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "ES-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"ES.3\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "ProtectionStatus\r\n| project ResourceId, OSName, SignatureVersion, ProtectionStatus, ProtectionStatusDetails, TypeofProtection, ScanDate\r\n| sort by ScanDate desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Protection Status",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ProtectionStatus",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "No real time protection",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Signatures out of date",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Real time protection",
                                    "representation": "green",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unknown",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Threat Detected",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Not Reporting",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "2",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertSeverity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "AlertLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url"
                              }
                            },
                            {
                              "columnMatch": "CompromisedEntity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Account",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to AAD Profile >>"
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Fired",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 8,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        },
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "name": "query - 7 - Copy"
                    }
                  ]
                },
                "name": "ES-3",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isESVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Endpoint Security Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Backup and Recovery (BR)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery) \r\n---\r\nBackup and Recovery covers controls to ensure that data and configuration backups at the different service tiers are performed, validated, and protected."
                },
                "customWidth": "40",
                "name": "BR Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 7"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "BR-1",
                      "linkTarget": "step",
                      "linkLabel": "BR-1: Ensure regular automated backups",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "BR-2",
                      "linkTarget": "step",
                      "linkLabel": "BR-2: Protect backup and recovery data",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "BR-3",
                      "linkTarget": "step",
                      "linkLabel": "BR-3: Monitor backups",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "BR-4",
                      "linkTarget": "step",
                      "linkLabel": "BR-4: Regularly test backups",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "BR Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [BR-1: Ensure regular automated backups](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-1-ensure-regular-automated-backups)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)<br>\r\n\r\n### Implementation\r\nüí° [How to Enable Azure Backup](https://docs.microsoft.com/azure/backup/index.yml)<br>\r\nüí° [Auto-Enable Backup on VM Creation using Azure Policy](https://docs.microsoft.com/azure/backup/backup-azure-auto-enable-backup)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) \r\n\r\n### CIS Controls v8 IDs\r\n[11.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CP-2, CP-4, CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isBRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "BR-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "resources\r\n| where type contains \"recovery\"\r\n| project id,type,location,resourceGroup\r\n| order by location asc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recovery Services Vaults",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "warning",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "Url",
                                "linkLabel": "Go to Recommendation >"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"BR.1\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "BR-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [BR-2: Protect backup and recovery data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-2-protect-backup-and-recovery-data)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Overview of Security Features in Azure Backup](https://docs.microsoft.com/azure/backup/security-overview)<br>\r\nüí° [Encryption of Backup Data Using Customer-Managed Keys](https://docs.microsoft.com/azure/backup/encryption-at-rest-with-cmk)<br>\r\nüí° [Security features to help protect hybrid backups from attacks](https://docs.microsoft.com/azure/backup/backup-azure-security-feature#prevent-attacks)<br>\r\nüí° [Azure Backup - set cross region restore](https://docs.microsoft.com/azure/backup/backup-create-rs-vault#set-cross-region-restore)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) \r\n\r\n### CIS Controls v8 IDs\r\n[11.3](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CP-6, CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isBRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "BR-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"BR.2\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"BR.2\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "BR-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [BR-3: Monitor backups](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-3-monitor-backups)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)<br>\r\n\r\n### Implementation\r\nüí° [Govern your backup estate using Backup Center](https://docs.microsoft.com/azure/backup/backup-center-govern-environment)<br>\r\nüí° [Monitor and operate backups using Backup center](https://docs.microsoft.com/azure/backup/backup-center-monitor-operate)<br>\r\nüí° [Monitoring and reporting solutions for Azure Backup](https://docs.microsoft.com/azure/backup/monitoring-and-alerts-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Center](https://portal.azure.com/#blade/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/overview)\r\n\r\n### CIS Controls v8 IDs\r\n[11.3](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "name": "BR-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity\r\n| where OperationNameValue contains \"recovery\" and ActivityStatus == \"Succeeded\"\r\n| summarize count() by Caller\r\n| render piechart",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Users Interacting with Backups",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "OperationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Caller",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 1 - Copy"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureActivity\r\n| where OperationNameValue contains \"recovery\" and ActivityStatus == \"Succeeded\"\r\n| project OperationName, Caller, OperationNameValue, ResourceId, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Backup Activity",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "OperationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Caller",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "name": "query - 1"
                    }
                  ]
                },
                "name": "BR-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [BR-4: Regularly test backups](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery?WT.mc_id=Portal-fx#br-4-regularly-test-backup)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Implementation\r\nüí° [How to recover files from Azure Virtual Machine backup](https://docs.microsoft.com/azure/backup/backup-azure-restore-files-from-vm)<br>\r\nüí° [How to restore Key Vault keys in Azure](https://docs.microsoft.com/powershell/module/azurerm.keyvault/restore-azurekeyvaultkey)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>\r\nüîÄ [Key Vaults](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br>\r\n\r\n### CIS Controls v8 IDs\r\n[11.5](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CP-4, CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[N/A](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isBRVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "BR-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Regularly test backups](https://docs.microsoft.com/azure/backup/backup-overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/backup/media/backup-overview/azure-backup-overview.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "name": "text - 2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "BR-4",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isBRVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Backup & Recovery Group"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [DevOps Security (DS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security) \r\n---\r\nDevOps Security covers the controls related to the security engineering and operations in the DevOps processes, including deployment of critical security checks (such as static application security testing, vulnerability management) prior to the deployment phase to ensure the security throughout the DevOps process; it also includes common topics such as threat modeling and software supply security. "
                },
                "customWidth": "40",
                "name": "BR Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 7"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "DS-1",
                      "linkTarget": "step",
                      "linkLabel": "DS-1: Conduct Threat Modeling",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "6341e0f7-7e0f-4554-a7cc-c1548db7a290",
                      "cellValue": "DS-2",
                      "linkTarget": "step",
                      "linkLabel": "DS-2: Ensure Software Supply Chain Security",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "223fd6b0-b4b9-4c74-b748-e958ddfcd185",
                      "cellValue": "DS-3",
                      "linkTarget": "step",
                      "linkLabel": "DS-3: Secure DevOps Infrastructure",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "1aa60bda-a285-41a5-9602-1b0d80d6739e",
                      "cellValue": "DS-4",
                      "linkTarget": "step",
                      "linkLabel": "DS-4: Integrate Static Application Security Testing into DevOps Pipeline",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "081f6052-686e-4e06-a0c3-78b90ffbe405",
                      "cellValue": "DS-5",
                      "linkTarget": "step",
                      "linkLabel": "DS-5: Integrate Dynamic Application Security Testing into DevOps Pipeline",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "4ebdf42e-25d8-4778-a7b9-f7c78979d68f",
                      "cellValue": "DS-6",
                      "linkTarget": "step",
                      "linkLabel": "DS-6: Enforce Security of Workload throughout DevOps Lifecycle",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f3134348-bc5d-42c5-9955-82d788d48e0a",
                      "cellValue": "DS-7",
                      "linkTarget": "step",
                      "linkLabel": "DS-7: Enable Logging and Monitoring in DevOps",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "BR Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-1: Conduct Threat Modeling](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-1-conduct-threat-modeling)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22) \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Implementation\r\nüí° [Threat Modeling Overview](https://www.microsoft.com/securityengineering/sdl/threatmodeling)<br>\r\nüí° [Application threat analysis (including STRIDE + questionnaire based method)](https://docs.microsoft.com/azure/architecture/framework/security/design-threat-model)<br>\r\nüí° [Azure Template - Microsoft Security Threat Model Stencil](https://github.com/AzureArchitecture/threat-model-templates)<br>\r\nüí° [Hunt for threats with Microsoft Sentinel](https://docs.microsoft.com/azure/sentinel/hunting)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[16.10, 16.14](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SA-15](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[6.5, 12.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## üí°[Getting started with the Threat Modeling Tool](https://docs.microsoft.com/azure/security/develop/threat-modeling-tool-getting-started)\r\n![Image Name](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE2K1Za?ver=0327&q=90&m=8&h=450&w=800&b=%23FFFFFFFF&l=f&x=0&y=79&s=1709&d=961&aim=true)<br>\r\n"
                      },
                      "customWidth": "50",
                      "name": "text - 2"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityAlert\r\n| where Tactics <> \"Unknown\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Tactics\r\n| render timechart \r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "MITRE ATT&CK Tactics Observed (Microsoft Sentinel)",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "ControlNumber",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "AllServices",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "!=",
                                    "thresholdValue": "Healthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "name": "query - 1"
                    }
                  ]
                },
                "name": "DS-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-2: Ensure Software Supply Chain Security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-2-ensure-software-supply-chain-security)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendations](https://docs.microsoft.com/azure/defender-for-cloud/continuous-export?tabs=azure-portal#what-data-types-can-be-exported) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [GitHub Dependency Graph](https://docs.github.com/code-security/supply-chain-security/understanding-your-software-supply-chain/about-the-dependency-graph)<br>\r\nüí° [GitHub Dependabot](https://docs.github.com/code-security/supply-chain-security/keeping-your-dependencies-updated-automatically/about-dependabot-version-updates)<br>\r\nüí° [Identify vulnerable container images in your CI/CD workflows](https://docs.microsoft.com/azure/security-center/defender-for-container-registries-cicd)<br>\r\nüí° [Azure DevOps Marketplace ‚Äì supply chain security](https://marketplace.visualstudio.com/search?term=tag%3ASupply%20Chain%20Security&target=VSTS)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[16.4, 16.6, 16.11](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SA-12, SA-15](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[6.3, 6.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": " securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\") by tostring(RecommendationName), ControlID = controlId, recommendationName\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink) on RecommendationName  \r\n    | distinct ControlID, RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, recommendationName\r\n   | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink\r\n| where RecommendationName contains \"contain\" or RecommendationName contains \"aks\" or RecommendationName contains \"kube\"\r\n    | sort by Total desc",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations",
                        "noDataMessage": "Confirm Microsoft Defender for Cloud: Regulatory Compliance Initatives are enabled. ",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "recommendationName1"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "recommendationName1",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "DS-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-3: Secure DevOps Infrastructure](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-3-secure-devops-infrastructure)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [GitHubAuditLogPolling_CL](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github) üî∑ [AzureDevOpsAuditing](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/)<br> \r\n\r\n### Implementation\r\nüí° [DevSecOps controls overview ‚Äì secure pipelines](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/devsecops-controls)<br>\r\nüí° [Secure your GitHub organization](https://docs.github.com/code-security/getting-started/securing-your-organization)<br>\r\nüí° [Azure DevOps pipeline ‚Äì Microsoft hosted agent security considerations](https://docs.microsoft.com/azure/devops/pipelines/agents/hosted?view=azure-devops&preserve-view=true&tabs=yaml#security)<br>\r\nüí° [Protecting your GitHub assets with Microsoft Sentinel](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721)<br>\r\nüí° [Deploy Microsoft Sentinel: Continuous Threat Monitoring for GitHub Solution](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github)<br>\r\nüí° [Azure DevOps - audit streaming](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming?view=azure-devops&preserve-view=true)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[16.7](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6, AC-2, AC-3, AC-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[2.2, 6.3, 7.1](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "GitHubAuditLogPolling_CL \r\n| project actor_s, org_s, repo_s, action_s, name_s, _document_id_s, visibility_s, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "GitHub Audit Logs",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "actor_s",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "action_s",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "ControlNumber",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "AllServices",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "!=",
                                    "thresholdValue": "Healthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 1"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDevOpsAuditing\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Azure DevOps Audit Logs",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "ControlNumber",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "AllServices",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "!=",
                                    "thresholdValue": "Healthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "DS-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-4: Integrate Static Application Security Testing into DevOps Pipeline](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-4-integrate-static-application-security-testing-into-devops-pipeline)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Implementation\r\nüí° [GitHub CodeQL](https://codeql.github.com/docs/)<br>\r\nüí° [BinSkim Binary Analyzer](https://github.com/microsoft/binskim)<br>\r\nüí° [Azure DevOps Credential Scan](https://secdevtools.azurewebsites.net/helpcredscan.html)<br>\r\nüí° [GitHub secret scanning](https://docs.github.com/code-security/secret-security/about-secret-scanning)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[16.12](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SA-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[6.3, 6.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## üí°[Getting started with Credential Scanner](https://secdevtools.azurewebsites.net/helpcredscan.html)\r\n![ImageName](https://secdevtools.azurewebsites.net/img/1_AddBuildTask.png)"
                      },
                      "customWidth": "50",
                      "name": "text - 2"
                    }
                  ]
                },
                "name": "DS-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-5: Integrate Dynamic Application Security Testing into DevOps Pipeline](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-5-integrate-dynamic-application-security-testing-into-devops-pipeline)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Implementation\r\nüí° [DAST tools in Azure DevOps marketplace](https://marketplace.visualstudio.com/search?term=DAST&target=AzureDevOps&category=All%20categories)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[16.12](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SA-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[6.3, 6.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "BR-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "SecurityNestedRecommendation\r\n| extend CVE = tostring(parse_json(tostring(AdditionalData.Cve))[0].Title)\r\n| where Description <> \"\"\r\n| summarize count() by Description, CVE\r\n| sort by count_ desc\r\n| project Description, CVE, count_\r\n| limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": " System/Application Vulnerabilities",
                        "noDataMessage": "Confirm ASC SecurityNestedRecommendation logging is enabled and/or extend time thresholds for a larger data-set.  ",
                        "timeContext": {
                          "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ComplianceDomain",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "yellowOrangeRed"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 6"
                    }
                  ]
                },
                "name": "DS-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-6: Enforce Security of Workload throughout DevOps Lifecycle](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-6-enforce-security-of-workload-throughout-devops-lifecycle)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Microsoft Defender for Cloud](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Implementation\r\nüí° [Shared Image Gallery overview](https://docs.microsoft.com/azure/virtual-machines/windows/shared-image-galleries)<br>\r\nüí° [How to implement Azure Defender for Cloud vulnerability assessment recommendations](https://docs.microsoft.com/azure/security-center/security-center-vulnerability-assessment-recommendations)<br>\r\nüí° [Security considerations for Azure Container](https://docs.microsoft.com/azure/container-instances/container-instances-image-security)<br>\r\nüí° [Azure Defender for container registries](https://docs.microsoft.com/azure/security-center/defender-for-container-registries-introduction)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Defender for Cloud](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[7.5, 7.6, 7.7, 16.1, 16.7](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6, AC-2, AC-3, AC-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[6.1, 6.2, 6.3](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "text - 3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend RecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | summarize‚ÄØFailed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\"),‚ÄØPassed‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\"),‚ÄØTotal‚ÄØ=‚ÄØcountif(state‚ÄØ==‚ÄØ\"Unhealthy\" or state == \"Healthy\" or complianceState‚ÄØ==‚ÄØ\"Passed\") by RecommendationName, ControlID = controlId\r\n    |‚ÄØextend‚ÄØPassedControls‚ÄØ= (Passed/todouble(Total))*100\r\n| join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend RecommendationName = tostring(properties.description)\r\n    | extend RecommendationLink = tostring(properties.assessmentDetailsLink)\r\n    | project RecommendationName, RecommendationLink, name) on RecommendationName\r\n    | where ControlID == \"DS.6\"\r\n    | distinct RecommendationName, Total, PassedControls, Passed, Failed, RecommendationLink, name\r\n    | sort by Total, Passed desc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Recommendations ",
                        "noDataMessage": "No Recommendations Observed Within These Thresholds. Confirm the Microsoft Defender for Cloud: Regulatory Compliance Initiative for Azure Security Benchmark is Enabled",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "RecommendationLink",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "initiativeId",
                                      "source": "static",
                                      "value": "NIST-SP-800-53-R4"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            }
                          ],
                          "filter": true
                        },
                        "sortBy": [],
                        "chartSettings": {
                          "seriesLabelSettings": [
                            {
                              "seriesName": "Failed",
                              "color": "redBright"
                            },
                            {
                              "seriesName": "Passed",
                              "color": "green"
                            }
                          ]
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n| extend ComplianceDomain=iff(ControlID contains \"AM.\", \"Asset Management\", iff(ControlID contains \"BR.\", \"Backup & Recovery\", iff(ControlID contains \"DP.\", \"Data Protection\", iff(ControlID contains \"DS.\", \"DevOps Security\", iff(ControlID contains \"ES.\", \"Endpoint Security\", iff(ControlID contains \"GS.\", \"Governance & Strategy\", iff(ControlID contains \"IM.\", \"Identity Management\", iff(ControlID contains \"IR.\", \"Incident Response\", iff(ControlID contains \"LT.\", \"Logging & Threat Detection\", iff(ControlID contains \"NS.\", \"Network Security\", iff(ControlID contains \"PA.\", \"Privileged Access\", iff(ControlID contains \"PV.\", \"Posture & Vulnerability Management\",\"Other\"))))))))))))\r\n| where ControlID == \"DS.6\"\r\n    | extend FirstObserved = properties1.status.statusChangeDate\r\n    | project ResourceID, RecommendationName=RecommendationDisplayName, ControlFamily=ComplianceDomain, ControlID, Severity=tostring(Severity), CurrentState=State, RecommendationLink=Recommendation, name, FirstObserved\r\n    | sort by Severity asc\r\n    | limit 250",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Current Recommendation Details",
                        "noDataMessage": "No failed controls observed within these thresholds. Confirm Microsoft Defender for Cloud SecurityRecommendation logging is enabled and onboarded to Microsoft Sentinel Workspace.",
                        "showExportToExcel": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "ResourceID",
                              "formatter": 13,
                              "formatOptions": {
                                "linkTarget": "Resource",
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "RecommendationName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlFamily",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Persistence",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "ControlID",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Severity",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "High",
                                    "representation": "redBright",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Medium",
                                    "representation": "orange",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Low",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "blue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "State",
                              "formatter": 1
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 7,
                              "formatOptions": {
                                "linkTarget": "OpenBlade",
                                "linkLabel": "Remediate >>",
                                "linkIsContextBlade": false,
                                "bladeOpenContext": {
                                  "bladeName": "RecommendationsBlade",
                                  "extensionName": "Microsoft_Azure_Security",
                                  "bladeParameters": [
                                    {
                                      "name": "assessmentKey",
                                      "source": "column",
                                      "value": "name"
                                    },
                                    {
                                      "name": "resourceId",
                                      "source": "column",
                                      "value": "ResourceID"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "name",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "FirstObserved",
                              "formatter": 6
                            }
                          ],
                          "filter": true,
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Severity_4",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "sortBy": [
                          {
                            "itemKey": "$gen_thresholds_Severity_4",
                            "sortOrder": 1
                          }
                        ]
                      },
                      "name": "query - 8"
                    }
                  ]
                },
                "name": "DS-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [DS-7: Enable Logging and Monitoring in DevOps](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security#ds-7-enable-logging-and-monitoring-in-devops)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [GitHubAuditLogPolling_CL](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github) üî∑ [AzureDevOpsAuditing](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming) ‚ú≥Ô∏è [Microsoft Sentinel](https://azure.microsoft.com/services/azure-sentinel/)<br> \r\n\r\n### Implementation\r\nüí° [Azure DevOps - audit streaming](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming?view=azure-devops&preserve-view=true)<br>\r\nüí° [GitHub logging](https://docs.github.com/organizations/keeping-your-organization-secure/reviewing-the-audit-log-for-your-organization)<br>\r\nüí° [Protecting your GitHub assets with Microsoft Sentinel](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721)<br>\r\nüí° [Deploy Microsoft Sentinel: Continuous Threat Monitoring for GitHub Solution](https://portal.azure.com/#create/microsoftcorporation1622712991604.sentinel4githubsentinel4github)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [GitHub](https://github.com/)<br>\r\nüîÄ [Azure DevOps](https://azure.microsoft.com/services/devops/)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.2, 8.5, 8.9, 8.11](https://www.cisecurity.org/controls/v8/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n### PCI-DSS v3.2.1 IDs\r\n[10.1, 10.2, 10.3, 10.6](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isDSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "BR-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "## üí°[Enable Azure DevOps Audit streaming](https://docs.microsoft.com/azure/devops/organizations/audit/auditing-streaming?view=azure-devops)\r\n![Image](https://docs.microsoft.com/azure/devops/organizations/audit/media/auditing-streaming/create-new-auditing-stream.png?view=azure-devops)"
                      },
                      "customWidth": "50",
                      "name": "text - 3"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "GitHubAuditLogPolling_CL \r\n| project actor_s, org_s, repo_s, action_s, name_s, _document_id_s, visibility_s, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "GitHub Audit Logs",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "actor_s",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Person",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "action_s",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "ControlNumber",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "AllServices",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "!=",
                                    "thresholdValue": "Healthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 1"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AzureDevOpsAuditing\r\n| limit 250\r\n",
                        "size": 0,
                        "showAnalytics": true,
                        "title": "Azure DevOps Audit Logs",
                        "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                        "timeContext": {
                          "durationMs": 7776000000
                        },
                        "timeContextFromParameter": "TimeRange",
                        "showExportToExcel": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "RecommendationDisplayName",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Gear",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "Total",
                              "formatter": 22,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": [
                                    {
                                      "columnName": "Passed",
                                      "color": "green"
                                    },
                                    {
                                      "columnName": "Failed",
                                      "color": "redBright"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "columnMatch": "PassedControls",
                              "formatter": 0,
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            {
                              "columnMatch": "ControlNumber",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "AllServices",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "RecommendationState",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "!=",
                                    "thresholdValue": "Healthy",
                                    "representation": "3",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            {
                              "columnMatch": "count_",
                              "formatter": 4,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            }
                          ],
                          "filter": true
                        }
                      },
                      "customWidth": "50",
                      "name": "query - 3"
                    }
                  ]
                },
                "name": "DS-7",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isDSVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "DevOps Security"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# [Governance and Strategy (GS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy) \r\n---\r\nGovernance and Strategy provides guidance for ensuring a coherent security strategy and documented governance approach to guide and sustain security assurance, including establishing roles and responsibilities for the different cloud security functions, unified technical strategy, and supporting policies and standards. "
                },
                "customWidth": "40",
                "name": "GS Guide"
              },
              {
                "type": 1,
                "content": {
                  "json": ""
                },
                "customWidth": "10",
                "name": "text - 11"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "list",
                  "links": [
                    {
                      "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                      "cellValue": "GS-1",
                      "linkTarget": "step",
                      "linkLabel": "GS-1: Align organization roles, responsibilities and accountabilities",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                      "cellValue": "GS-2",
                      "linkTarget": "step",
                      "linkLabel": "GS-2: Define Enterprise Segmentation Strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                      "cellValue": "GS-3",
                      "linkTarget": "step",
                      "linkLabel": "GS-3: Define and implement data protection strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                      "cellValue": "GS-4",
                      "linkTarget": "step",
                      "linkLabel": "GS-4: Define and implement network security strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "20f0be95-4d1b-4c87-96e2-b322d79d25e4",
                      "cellValue": "GS-5",
                      "linkTarget": "step",
                      "linkLabel": "GS-5: Define and implement security posture management strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "93175973-ed48-4186-9c74-2af94419569b",
                      "cellValue": "GS-6",
                      "linkTarget": "step",
                      "linkLabel": "GS-6: Define and implement identity and privileged access strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "0de2579f-f8f6-4aef-b6bf-dcdc4b5405f0",
                      "cellValue": "GS-7",
                      "linkTarget": "step",
                      "linkLabel": "GS-7: Define and implement logging, threat detection and incident response strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "4c4c61d6-7276-4a73-bae4-8c46d3a71d2d",
                      "cellValue": "GS-8",
                      "linkTarget": "step",
                      "linkLabel": "GS-8: Define and implement backup and recovery strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "60dd4b17-42fb-44ec-a08d-f8b0bb58c85b",
                      "cellValue": "GS-9",
                      "linkTarget": "step",
                      "linkLabel": "GS-9: Define and implement endpoint security strategy",
                      "preText": "Go to >",
                      "style": "link"
                    },
                    {
                      "id": "cef4a25f-4e47-46dd-8814-a72fc6759bbe",
                      "cellValue": "GS-10",
                      "linkTarget": "step",
                      "linkLabel": "GS-10: Define and implement DevOps security strategy",
                      "preText": "Go to >",
                      "style": "link"
                    }
                  ]
                },
                "customWidth": "40",
                "name": "GS Steps"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-1: Align organization roles, responsibilities and accountabilities](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-1-align-organization-roles-responsibilities-and-accountabilities)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Best Practice 1 ‚Äì People: Educate Teams on Cloud Security Journey](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#1-people-educate-teams-about-the-cloud-security-journey)<br>\r\nüí° [Azure Security Best Practice 2 - People: Educate Teams on Cloud Security Technology](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#2-people-educate-teams-on-cloud-security-technology)<br>\r\nüí° [Azure Security Best Practice 3 - Process: Assign Accountability for Cloud Security Decisions](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#4-process-update-incident-response-ir-processes-for-cloud)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[14.9](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[PL-9, PM-10, PM-13, AT-1, AT-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS-1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Align Organization Roles, Responsibilities, and Accountabilities](https://docs.microsoft.com/security/zero-trust/identity)\r\n![Image Name](https://docs.microsoft.com/azure/role-based-access-control/media/rbac-and-directory-admin-roles/rbac-admin-roles.png)"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-1",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-2: Define and implement enterprise segmentation/separation of duties strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Security in the Microsoft Cloud Adoption Framework for Azure - Segmentation: Separate to protect](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/access-control#segmentation-separate-to-protect)<br>\r\nüí° [Security in the Microsoft Cloud Adoption Framework for Azure - Architecture: establish a single unified security strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.12](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SC-7, SC-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.2, 6.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS-2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Segment and Enforce the External Boundaries](https://docs.microsoft.com/security/zero-trust/networks#segment-and-enforce-the-external-boundaries)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-servers-devices-boundaries-azure-vpn.png)¬†\r\n\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS2",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-2",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-3: Define and implement data protection strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-3-define-and-implement-data-protection-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - Data Protection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-data-protection)<br>\r\nüí° [Cloud Adoption Framework - Azure data security and encryption best practices](https://docs.microsoft.com/azure/security/fundamentals/data-encryption-best-practices)<br>\r\nüí° [Azure Security Fundamentals - Azure Data security, encryption, and storage](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[3.1, 3.7, 3.12](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SI-4, SC-8, SC-12, SC-17, SC-28, RA-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 4.1, A3.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Asset Management and Data Protection Strategy](https://docs.microsoft.com/security/zero-trust/data)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-monitor-remediate-data.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS1",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-3",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-4: Define and implement network security strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-4-define-and-implement-network-security-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Best Practice 11 - Architecture. Single Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\nüí° [Azure Security Benchmark - Network Security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-network-security)<br>\r\nüí° [Azure Network Security Overview](https://docs.microsoft.com/azure/security/fundamentals/network-overview)<br>\r\nüí° [Enterprise Network Architecture Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/architecture)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[12.2, 12.4](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, AC-17, CA-3, CM-1, CM-2, CM-6, CM-7, SC-1, SC-2, SC-5, SC-7, SC-20, SC-21, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 1.3, 1.5, 4.1, 6.6, 11.4, A2.1, A2.2, A2.3, A3.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-4",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Network Security Strategy](https://docs.microsoft.com/security/zero-trust/networks)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-azure-region-virtual-network-servers.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS5",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-4",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-5: Define and implement security posture management strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-5-define-and-implement-security-posture-management-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - Posture and Vulnerability Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-posture-vulnerability-management)<br>\r\nüí° [Azure Security Best Practice 9 - Establish security posture management](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/security-top-10#5-process-establish-security-posture-management)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.1, 4.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CA-1, CA-8, CM-1, CM-2, CM-6, RA-1, RA-3, RA-5, SI-1, SI-2, SI-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[1.1, 1.2, 2.2, 6.1, 6.2, 6.5, 6.6, 11.2, 11.3, 11.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS-3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Security Posture Management Strategy](https://docs.microsoft.com/security/zero-trust/visibility-automation-orchestration)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-provide-integrated-capabilities-manage-threats.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS3",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-5",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-6: Define and implement identity and privileged access strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - Identity Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-identity-management)<br>\r\nüí° [Azure Security Benchmark - Privileged Access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-privileged-access)<br>\r\nüí° [Azure Security Best Practice 11 - Architecture. Single Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\nüí° [Azure Identity Management Security Overview](https://docs.microsoft.com/azure/security/fundamentals/identity-management-overview)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[5.6, 6.5, 6.7](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-1, AC-2, AC-3, AC-4, AC-5, AC-6, IA-1, IA-2, IA-4, IA-5, IA-8, IA-9, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[7.1, 7.2, 7.3, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Identity and Privileged Access Strategy](https://docs.microsoft.com/security/zero-trust/identity)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-conditional-access-policies.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS6",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-6",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-7: Define and implement logging, threat detection and incident response strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-7-define-and-implement-logging-threat-detection-and-incident-response-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - Logging and Threat Detection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-logging-threat-detection)<br>\r\nüí° [Azure Security Benchmark - Incident Response](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-incident-response)<br>\r\nüí° [Azure Security Best Practice 4 - Process. Update Incident Response Processes for Cloud](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#3-process-assign-accountability-for-cloud-security-decisions)<br>\r\nüí° [Azure Adoption Framework, Logging, and Reporting Decision Guide](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/logging-and-reporting/)<br>\r\nüí° [Azure Enterprise Scale, Management, and Monitoring](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[8.1, 13.1, 17.2, 17.4,17.7](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[AU-1, IR-1, IR-2, IR-10, SI-1, SI-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7, 10.8, 10.9, 12.10](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-7",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Logging and Threat Response Strategy](https://docs.microsoft.com/azure/sentinel/overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/sentinel/media/overview/core-capabilities.png)¬†\r\n"
                      },
                      "customWidth": "35",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS7",
                      "styleSettings": {
                        "maxWidth": "35"
                      }
                    }
                  ]
                },
                "name": "GS-7",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-8: Define and implement backup and recovery strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-8-define-and-implement-backup-and-recovery-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - Backup and Recovery](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-backup-recovery)<br>\r\nüí° [Azure Well-Architecture Framework - Backup and Disaster Recover for Azure Applications](https://docs.microsoft.com/azure/architecture/framework/resiliency/backup-and-recovery)<br>\r\nüí° [Azure Adoption Framework - Business Continuity and Disaster Recovery](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/business-continuity-and-disaster-recovery)<br>\r\nüí° [Backup and restore plan to protect against ransomware](https://docs.microsoft.com/azure/security/fundamentals/backup-plan-to-protect-against-ransomware)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[11.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[CP-1, CP-9, CP-10](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[3.4](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-8",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Backup and Recovery Strategy](https://docs.microsoft.com/azure/backup/backup-overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/backup/media/backup-overview/azure-backup-overview.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS8",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-8",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-9: Define and implement endpoint security strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-9-define-and-implement-endpoint-security-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - Endpoint security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security)<br>\r\nüí° [Best practices for endpoint security on Azure](https://docs.microsoft.com/azure/architecture/framework/security/design-network-endpoints)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.4, 10.1](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SI-2, SI-3, SC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[5.1, 5.2, 5.3, 5.4, 11.5](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-9",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define Endpoint Security Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-endpoint-security)\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/mde-p1/mde-p1-overview-diagram.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS8",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-9",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "editable",
                  "items": [
                    {
                      "type": 1,
                      "content": {
                        "json": "# [GS-10: Define and implement DevOps security strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-governance-strategy#gs-10-define-and-implement-devops-security-strategy)\r\n\r\n## [Microsoft Defender for Cloud - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüí° [Azure Security Benchmark - DevOps security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security)<br>\r\nüí° [Secure DevOps](https://www.microsoft.com/securityengineering/devsecops)<br>\r\nüí° [Cloud Adoption Framework - DevSecOps controls](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/devsecops-controls)<br>\r\n\r\n### CIS Controls v8 IDs\r\n[4.1, 4.2, 16.1, 16.2](https://www.cisecurity.org/controls/v8/)\r\n### NIST SP 800-53 r4 IDs\r\n[SA-12, SA-15, CM-1, CM-2, CM-6, AC-2, AC-3, AC-6, SA-11, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)\r\n### PCI-DSS v3.2.1 IDs\r\n[2.2, 6.1, 6.2, 6.3, 6.5, 7.1, 10.1, 10.2, 10.3, 10.6, 12.2](https://www.pcisecuritystandards.org/document_library?category=pcidss&document=pci_dss)<br>\r\n\r\n"
                      },
                      "customWidth": "50",
                      "name": "GS-10",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "### üí° [Define and implement DevOps security strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v3-devops-security?WT.mc_id=Portal-fx)\r\n![Image¬†Name](https://docs.microsoft.com/azure/cloud-adoption-framework/secure/media/devsecops-controls.png)¬†\r\n"
                      },
                      "customWidth": "50",
                      "conditionalVisibility": {
                        "parameterName": "isGSVisible",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "GS8",
                      "styleSettings": {
                        "maxWidth": "50"
                      }
                    }
                  ]
                },
                "name": "GS-10",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "isGSVisible",
            "comparison": "isEqualTo",
            "value": "true"
          },
          "name": "Governance & Strategy Group"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "/subscriptions/d1d8779d-38d7-4f06-91db-9cbc8de0176f/resourcegroups/soc/providers/microsoft.operationalinsights/workspaces/cybersecuritysoc"
      ],
      "fromTemplateId": "sentinel-UserWorkbook"
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}