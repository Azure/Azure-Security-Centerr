{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "3218e2b0-1bcc-46d4-affa-d298e0cf90f6",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "üîé Guide",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true},\r\n    {\"value\": \"No\", \"label\": \"No\"}\r\n]",
            "value": "No"
          },
          {
            "id": "e6ded9a1-a83c-4762-938d-5bf8ff3d3d38",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            }
          },
          {
            "id": "e3225ed0-6210-40a1-b2d0-66e42ffa71d6",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| order by name asc\r\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\r\n| mvexpand All limit 100\r\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "15b2c181-7397-43c1-900a-28e175ae8a6f",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "‚è±Ô∏è Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "Parameter Selectors"
    },
    {
      "type": 1,
      "content": {
        "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take time to answer a quick survey,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://forms.office.com/r/sxvBsuTcmM)"
      },
      "name": "Survey"
    },
    {
      "type": 1,
      "content": {
        "json": "## Getting Started\r\nThis workbook leverages Azure Policy, Azure Resource Graph, and Azure Log Analytics to align directly with the Azure Security Benchmark. A filter set in guide, subscription, workspace, time, and ASB control are available for customized reporting and review. The documentation below provides getting started recommendations for centralizing log analytics data and enabling Azure Security Center Continuous Export. This offering There is telemetry from 25+ Microsoft Security products included in this offering. Common use cases include conducting ASB assessments which custom reporting, time filtering, subscription filtering, workspace filtering, and guides. The report is exportable for print or PDF with the Print Workbook feature. The workbook is organized by ASB control areas, each area has multiple control cards. Control cards include ASB logging over time, current ASB assessment recommendations, ASB status, documentation guides, recommendations, and links to product pages, documentation, and portals for all referenced products.<br>\r\n\r\n1Ô∏è‚É£  [Add the Azure Security Benchmark Assessment to Your Dashboard](https://docs.microsoft.com/azure/security-center/update-regulatory-compliance-packages#add-a-regulatory-standard-to-your-dashboard)<br>\r\n2Ô∏è‚É£  [Continuously Export Security Center Data: SecurityRegulatoryCompliance & SecurityRecommendation Data Tables](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n3Ô∏è‚É£ [Onboard Azure Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\r\n4Ô∏è‚É£ [Extend Azure Sentinel Across Workspaces and Tenants](https://docs.microsoft.com/azure/sentinel/extend-sentinel-across-workspaces-tenants)<br>",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "Help"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n\\t{ \\\"Section\\\": \\\"Assessment\\\", \\\"tab\\\": \\\"AT\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Network Security (NS)\\\", \\\"tab\\\": \\\"NS\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Identity Management (IM)\\\", \\\"tab\\\": \\\"IM\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Privileged Access (PA)\\\", \\\"tab\\\": \\\"PA\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Data Protection (DP)\\\", \\\"tab\\\": \\\"DP\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Asset Management (AM)\\\", \\\"tab\\\": \\\"AM\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Logging and Threat Detection (LT)\\\", \\\"tab\\\": \\\"LT\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Incident Response (IR)\\\", \\\"tab\\\": \\\"IR\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Posture and Vulnerability Management (PV)\\\", \\\"tab\\\": \\\"PV\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Endpoint Security (ES)\\\", \\\"tab\\\": \\\"ES\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Backup and Recovery (BR)\\\", \\\"tab\\\": \\\"BR\\\" },\\r\\n\\t{ \\\"Section\\\": \\\"Governance and Strategy (GS)\\\", \\\"tab\\\": \\\"GS\\\" }\\r\\n]\",\"transformers\":null}",
        "size": 3,
        "title": "Control Areas",
        "exportMultipleValues": true,
        "exportedParameters": [
          {
            "fieldName": "tab",
            "parameterName": "Tab",
            "parameterType": 1
          }
        ],
        "queryType": 8,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Section",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "tab",
              "formatter": 5
            }
          ],
          "filter": true
        }
      },
      "customWidth": "49",
      "name": "Control Areas"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "a30d01d0-38f1-4a91-9cf6-cdb181d676b5",
            "version": "KqlParameterItem/1.0",
            "name": "isATVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "AT",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isNSVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "NS",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "d41cb044-86ef-4603-ae24-c61e864c067d"
          },
          {
            "id": "7b682fc9-cb6b-4475-a24c-41dcb43d0cef",
            "version": "KqlParameterItem/1.0",
            "name": "isIMVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "IM",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isPAVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "PA",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "15158143-a4f8-417b-90b0-123dd13f1ff5"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isDPVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "DP",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "0077d493-a27d-49d7-b49d-5888805d501e"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isAMVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "AM",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "33690532-5a73-4ac3-8fbd-6fc449a6d166"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isLTVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "LT",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "c01e9b8b-b285-4aae-8510-68741e0315c3"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isIRVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "IR",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "24ff10e9-f337-4257-b24a-0d4dcd680fb8"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isPVVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "PV",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "19bba8a0-e8d4-4e81-8346-6136c7efcdc6"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isESVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "ES",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "91e156a6-97d3-4823-91e9-997ea2bb12c5"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isBRVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "BR",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "09745955-54fe-4c9a-a65a-b0ea65d60297"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "isGSVisible",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "Tab",
                  "operator": "contains",
                  "rightValType": "static",
                  "rightVal": "GS",
                  "resultValType": "static",
                  "resultVal": "true"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "static",
                  "resultVal": "false"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "0a4c1f1c-cda6-47c4-a1df-7c968fa9003f"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "1",
      "name": "Hidden Parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "# Azure Security Benchmark\n---\n\nWelcome to the Azure Security Benchmark workbook. This workbook is designed to enable Cloud Architects, Security Engineers, and Governance Risk Compliance Professionals to gain situational awareness for cloud security posture and hardening. Benchmark recommendations provide a starting point for selecting specific security configuration settings and facilitate risk reduction. The Azure Security Benchmark includes a collection of high-impact security recommendations for improving posture. For more information, see the üí°[Azure Security Benchmark](https://docs.microsoft.com/security/benchmark/azure/).\n\n![Image Name](https://azure.microsoft.com/svghandler/security-center?width=300&height=157) \n"
      },
      "customWidth": "40",
      "name": "Workbook Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Assessment\r\n---\r\n\r\nThe Assessment section provides a mechanism to find, fix, and resolve ASB recommendations. A selector provides capability to filter by all, specific, or groups of ASB control ids. Upon selection, subordinate panels will summarize ASB recommendations by control family, status over time, recommendations, and resources identified. These panels are helpful for identifying the ASB control areas of interest, status over time, and which resources are most impacted by these vulnerabilties. The ASB Recommendation details provides a mechanism to identify specific recommendation details with deep-links to pivot to Azure Security Center: Regulatory Compliance for remediation. "
            },
            "customWidth": "49",
            "name": "NS Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 11"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "99a47f97-1aa4-4840-91ee-119aad6d6217",
                  "version": "KqlParameterItem/1.0",
                  "name": "ControlNumber",
                  "label": "Control ID",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| summarize count() by ComplianceControl\r\n| sort by ComplianceControl asc\r\n| project ComplianceControl\r\n",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "value": [
                    "ES.2"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 2592000000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "40",
            "name": "parameters - 26"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl in ({ControlNumber})\r\n| where State == \"Failed\"\r\n| summarize count() by ComplianceControl\r\n| sort by count_ desc",
              "size": 0,
              "showAnalytics": true,
              "title": "üîÄ ASB Recommendations Count by Control ID",
              "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "query - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl in ({ControlNumber})\r\n| where State == \"Failed\"\r\n| summarize count() by RecommendationName\r\n| sort by count_ desc",
              "size": 0,
              "showAnalytics": true,
              "title": "üîÄ ASB Recommendations by Count",
              "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "query - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId in ({ControlNumber})\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | summarize count() by ResourceID\r\n    | sort by count_ desc",
              "size": 0,
              "showAnalytics": true,
              "title": " üîÄ Assets with ASB Recommendations",
              "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    }
                  },
                  {
                    "columnMatch": "RecommendationDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ControlID",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Go to Recommendation >"
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "isATVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "query - 8"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId in ({ControlNumber})\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | summarize count() by ResourceType\r\n    | sort by count_ desc",
              "size": 0,
              "showAnalytics": true,
              "title": " üîÄ Assets with ASB Recommendations",
              "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellowOrangeRed"
                    }
                  },
                  {
                    "columnMatch": "RecommendationDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ControlID",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Go to Recommendation >"
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "isATVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "query - 8 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl in ({ControlNumber})\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by ComplianceControl\r\n| render timechart ",
              "size": 0,
              "showAnalytics": true,
              "title": "üîÄ ASB Recommendations over Time",
              "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "RecommendationDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ControlID",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Go to Recommendation >"
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "isATVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "query - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId in ({ControlNumber})\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ControlID, Recommendation, ResourceType, ResourceGroup, Severity, State \r\n    | limit 250",
              "size": 0,
              "showAnalytics": true,
              "title": " üîÄ Current Azure Security Benchmark Recommendation Details",
              "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "RecommendationDisplayName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ControlID",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Recommendation",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Go to Recommendation >"
                    }
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "isATVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "üü¶ Current Azure Security Benchmark Recommendations (NS-1) "
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isATVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Assessment"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Network Security (NS)\r\n---\r\n\r\nNetwork Security covers controls to secure and protect Azure networks, including securing virtual networks, establishing private connections, preventing and mitigating external attacks, and securing DNS. For more information, see üí°[Network Security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security) "
            },
            "customWidth": "49",
            "name": "NS Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 11"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "NS-1",
                  "linkTarget": "step",
                  "linkLabel": "NS-1: Implement Security for Internal Traffic",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "NS-2",
                  "linkTarget": "step",
                  "linkLabel": "NS-2: Connect Private Networks Together",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "NS-3",
                  "linkTarget": "step",
                  "linkLabel": "NS-3: Establish Private Network Access to Azure Services",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "NS-4",
                  "linkTarget": "step",
                  "linkLabel": "NS-4: Protect Applications and Services from External Network Attacks",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "NS-5",
                  "linkTarget": "step",
                  "linkLabel": "NS-5: Deploy Intrusion Detection/Intrusion Prevention Systems (IDS/IPS)",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                },
                {
                  "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                  "cellValue": "NS-6",
                  "linkTarget": "step",
                  "linkLabel": "NS-6: Simplify Network Security Rules",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                },
                {
                  "id": "b212a060-9b1c-46e1-a411-e01924d0e4ee",
                  "cellValue": "NS-7",
                  "linkTarget": "step",
                  "linkLabel": "NS-7: Secure Domain Name Service (DNS)",
                  "preText": "Go to >",
                  "postText": "",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "conditionalVisibility": {
              "parameterName": "isNSVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "NS Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|NS-1: Implement Security for Internal Traffic|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) ‚ú≥Ô∏è [Azure Firewall](https://azure.microsoft.com/services/azure-firewall/) |\r\n|NS-2: Connect Private Networks Together|‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/)‚ú≥Ô∏è [VPN Gateway](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) ‚ú≥Ô∏è [Private Link](https://azure.microsoft.com/services/private-link/)|\r\n|NS-3: Establish Private Network Access to Azure Services| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)  ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Private Link](https://azure.microsoft.com/services/private-link/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/)|\r\n|NS-4: Protect Applications and Services from External Network Attacks|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Azure DDoS Protection](https://azure.microsoft.com/services/ddos-protection/) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/) |\r\n|NS-5: Deploy Intrusion Detection/Intrusion Prevention Systems (IDS/IPS)|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) |\r\n|NS-6: Simplify Network Security Rules| ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) ‚ú≥Ô∏è [Azure DDoS Protection](https://azure.microsoft.com/services/ddos-protection/) ‚ú≥Ô∏è [Application Gateway](https://azure.microsoft.com/services/application-gateway/)|\r\n|NS-7: Secure Domain Name Service (DNS)| ‚ú≥Ô∏è [Azure DNS](https://azure.microsoft.com/services/dns/)|"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "NS Guide "
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-1: Implement Security For Internal Traffic](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-1-implement-security-for-internal-traffic)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br>\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) ‚ú≥Ô∏è [Azure Firewall](https://azure.microsoft.com/services/azure-firewall/)<br>\r\n\r\n\r\n### Hardening\r\nüü¶ [How to Create a Network Security Group with Security Rules](https://docs.microsoft.com/azure/virtual-network/tutorial-filter-network-traffic)<br>\r\nüü¶ [How to Deploy and Configure Azure Firewall](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal)<br>\r\nüü¶ [Adaptive Network Hardening in Azure Security Center](https://docs.microsoft.com/azure/security-center/security-center-adaptive-network-hardening)<br>\r\nüü¶ [Azure Sentinel Insecure Protocols Workbook](https://docs.microsoft.com/azure/sentinel/quickstart-get-visibility#use-built-in-workbooks)<br>\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[9.2, 9.4, 14.1, 14.2, 14.3](https://www.cisecurity.org/controls/v7/)\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, CA-3, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"NS.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (NS-1) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"NS.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " üîÄ Current Azure Security Benchmark Recommendations (NS-1) ",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Current Azure Security Benchmark Recommendations (NS-1) "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft.network/networksecuritygroups\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": " üîÄ Network Security Groups",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"firewall\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Firewalls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRecommendation\r\n| where RecommendationName contains \"Adaptive network\"\r\n| where RecommendationState == \"Unhealthy\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Adaptive Network Hardening Recommendations over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center: Adaptive Network Hardening Recommendations over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\r\nlet legacyAuth = SigninLogs\r\n| where ResultType == 0\r\n| where ClientAppUsed !contains \"Browser\" and ClientAppUsed !contains \"Mobile Apps and Desktop clients\"\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\"AAD Legacy Auth\";\r\nSecurityEvent\r\n| parse EventData with * '\"TicketEncryptionType\">' TicketEncryptionType '<' *\r\n| union Event\r\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \"0x12\" and TicketEncryptionType != \"0x11\") or ((EventLog =~ \"System\" and Source =~ \"NETLOGON\") and EventID in (scEvents))\r\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\r\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\r\n| extend Protocol = case(EventID == 4776, \"WDigest\", EventID == 4768 or EventID == 4769, \"Weak Kerberos Cipher\", EventID == 2889, \"Insecure LDAP\", EventID == 4624, \"NTLM v1\", EventID == 3000, \"SMBv1\", EventID in (scEvents), \"Vulnerable Secure Channel\", \"Unknown\")\r\n| project Protocol, Count, TimeGenerated\r\n| union legacyAuth\r\n| sort by Count desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Insecure Protocols",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Insecure Protocols",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "NS-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-2: Connect Private Networks Together](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-2-connect-private-networks-together)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/)‚ú≥Ô∏è [VPN Gateway](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) ‚ú≥Ô∏è [Private Link](https://azure.microsoft.com/services/private-link/)<br>\r\n\r\n### Hardening\r\nüü¶ [What Are ExpressRoute Connectivity Models](https://docs.microsoft.com/azure/expressroute/expressroute-connectivity-models)<br>\r\nüü¶ [Azure VPN overview](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways)<br>\r\nüü¶ [Virtual Network Peering](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview)<br>\r\nüü¶ [Azure Private Link](https://docs.microsoft.com/azure/private-link/private-link-service-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\nüîÄ [Virtual Network Gateways](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FvirtualNetworkGateways)<br>\r\nüîÄ [Azure ExpressRoute](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FexpressRouteCircuits)<br>\r\nüîÄ [Private Link](https://portal.azure.com/#blade/Microsoft_Azure_Network/PrivateLinkCenterBlade/overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\nN/A<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CA-3, AC-17, MA-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "NS-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"NS.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (NS-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (NS-2) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"NS.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (NS-2) ",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Current Azure Security Benchmark Recommendations (NS-2) "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"private\" or type contains \"link\" or type contains \"peer\" or type contains \"express\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ VPN, ExpressRoute, Peering, and Private Links",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ VPN, ExpressRoute, Peering, and Private Links"
                }
              ]
            },
            "name": "NS-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-3: Establish Private Network Access to Azure Services](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-3-establish-private-network-access-to-azure-services)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Private Link](https://azure.microsoft.com/services/private-link/)‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/)<br>\r\n\r\n### Hardening\r\nüü¶ [Understand Azure Private Link](https://docs.microsoft.com/azure/private-link/private-link-overview)<br>\r\nüü¶ [Understand Virtual Network Service Endpoints](https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade)<br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks)<br>\r\nüîÄ [Service Endpoint Policies](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FserviceEndpointPolicies)<br>\r\nüîÄ [Private Link](https://portal.azure.com/#blade/Microsoft_Azure_Network/PrivateLinkCenterBlade/overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[14.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, CA-3, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "NS-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"NS.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (NS-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (NS-3) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"NS.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (NS-3) ",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Current Azure Security Benchmark Recommendations (NS-3) "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"endpoint\" or type contains \"private\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Endpoints and Private Links",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Endpoints and Private Links"
                }
              ]
            },
            "name": "NS-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-4: Protect Applications and Services from External Network Attacks](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-4-protect-applications-and-services-from-external-network-attacks)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Azure DDoS Protection](https://azure.microsoft.com/services/ddos-protection/)<br>\r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/)<br> \r\n\r\n### Hardening\r\nüü¶ [Azure Firewall Documentation](https://docs.microsoft.com/azure/firewall/)<br>\r\nüü¶ [How to deploy Azure WAF](https://docs.microsoft.com/azure/web-application-firewall/overview)<br>\r\nüü¶ [Manage Azure DDoS Protection Standard Using the Azure Portal](https://docs.microsoft.com/azure/ddos-protection/manage-ddos-protection)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\nüîÄ [Web Application Firewall Policies](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies)<br>\r\nüîÄ [Azure DDoS](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FddosProtectionPlans)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[9.5, 12.3, 12.9](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SC-5, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "NS-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"NS.4\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (NS-4) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"NS.4\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (NS-4) ",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": ""
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics \r\n| where ResourceType == \"AZUREFIREWALLS\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by¬†Category\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Firewall Rules Enforced by Category",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let FakeData = (datatable (Message: string, ruleName_s: string, clientIp_s: string, clientIP_s: string, action_s: string, transactionId_s: string, trackingReference_s: string) [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]);\r\nFakeData\r\n| union AzureDiagnostics\r\n| where (ResourceType == \"APPLICATIONGATEWAYS\" or ResourceType == \"FRONTDOORS\" or ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\") and (\"Application Gateway\" == \"All\" or (ResourceType == \"APPLICATIONGATEWAYS\" and \"Application Gateway\" contains \"application gateway\") or (ResourceType == \"FRONTDOORS\" and \"Application Gateway\" contains \"azure front door\") or (ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\" and \"Application Gateway\" contains \"cdn\")) and (\"SOC-NS-AG-WAFV2 - 1129440\" == \"All\" or Resource in ('SOC-NS-AG-WAFV2'))\r\n| where Category == \"FrontdoorWebApplicationFirewallLog\" or OperationName == \"ApplicationGatewayFirewall\" or Category == \"WebApplicationFirewallLogs\"\r\n| extend Action = iif(action_s == \"Blocked\", Action = \"Block\", action_s)\r\n| extend Action = iif(Action == \"Detected\", Action = \"Log\", Action)\r\n| where '*' == Action or '*' == \"*\" \r\n| where '*' == requestUri_s or '*' == \"*\"\r\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\r\n| extend Rule= iif(Rule contains \"Mandatory rule. Cannot be disabled.\", strcat_array(split(Rule, \"Mandatory rule. Cannot be disabled. Inbound \", 1), \"\"), Rule) // Removes initial component for mandatory rule \r\n| extend Rule = iif(Rule contains \"Total Inbound Score\", strcat_array(array_concat(split(Rule, \" - SQLI=\", 0), parse_json('[\") -\"]'), split(Rule, \"):\", 1)), \"\"), Rule) // Removes smaller information if more info is available for anomaly score\r\n| summarize count() by Rule\r\n| top 50 by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure WAF Events",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"dos\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure DDoS Plans",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "NS-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-5: Deploy Intrusion Detection/Intrusion Prevention Systems (IDS/IPS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-5-deploy-intrusion-detectionintrusion-prevention-systems-idsips)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Deploy Azure Firewall](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal)<br>\r\nüü¶ [Azure Marketplace Includes Third-Party IDS Capabilities](https://azuremarketplace.microsoft.com/marketplace?search=IDS)<br>\r\nüü¶ [Microsoft Defender for Endpoint Capability](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/overview-endpoint-detection-response)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls)<br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v7.1 IDs\r\n[12.6, 12.7](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "NS-5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"NS.5\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (NS-5) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"NS.5\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (NS-5) ",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": ""
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where Category == \"AzureFirewallNetworkRule\"\r\n| where OperationName == \"AzureFirewallIDSLog\"\r\n| parse msg_s with * \"TCP request from \" Source \" to \" Destination \". Action: \" ActionTaken \". Rule: \" IDPSSig \". IDS: \" IDSMessage \". Priority: \" Priority \". Classification: \" Classification\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by¬†OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Firewall Premium: IPDS Alerts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "NS-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-6: Simplify Network Security Rules](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-6-simplify-network-security-rules)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) ‚ú≥Ô∏è [Azure DDoS Protection](https://azure.microsoft.com/services/ddos-protection/) ‚ú≥Ô∏è [Application Gateway](https://azure.microsoft.com/services/application-gateway/)<br>\r\n\r\n### Hardening\r\nüü¶ [Understand and Use Service Tags](https://docs.microsoft.com/azure/virtual-network/service-tags-overview)<br>\r\nüü¶ [Understand and Use Application Security Groups](https://docs.microsoft.com/azure/virtual-network/network-security-groups-overview#application-security-groups)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Application Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FapplicationSecurityGroups)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[1.5](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "NS-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"network\"\r\n| project id,tags,resourceGroup\r\n\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Service Tags",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Service Tags",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"network\" and type contains \"app\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Application Security Groups",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Application Security Groups",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "NS-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [NS-7: Secure Domain Name Service (DNS)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security#ns-7-secure-domain-name-service-dns)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure DNS](https://azure.microsoft.com/services/dns/) <br>\r\n\r\n### Hardening\r\nüü¶ [Azure DNS Overview](https://docs.microsoft.com/azure/dns/dns-overview)<br>\r\nüü¶ [Secure Domain Name System (DNS) Deployment Guide](https://csrc.nist.gov/publications/detail/sp/800-81/2/final)<br>\r\nüü¶ [Prevent Dangling DNS Entries and Avoid Subdomain Takeover](https://docs.microsoft.com/azure/security/fundamentals/subdomain-takeover)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [DNS Zones](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FdnsZones)<br>\r\nüîÄ [Private DNS Zones](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FprivateDnsZones)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\nN/A\r\n### NIST SP 800-53 r4 IDs\r\n[SC-20, SC-21](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "NS-7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where AlertName contains \"DNS\"\r\n| summarize count() by AlertName, AlertLink\r\n| extend Count = count_\r\n| project AlertName, Count, AlertLink\r\n| sort by Count desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ DNS Alerts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Link to Alert >"
                          }
                        },
                        {
                          "columnMatch": "DisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"dns\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ DNS",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isNSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "NS-7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isNSVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Network Security (NS)"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Identity Management (IM)\r\n---\r\n\r\nIdentity Management covers controls to establish a secure identity and access controls using Azure Active Directory, including the use of single sign-on, strong authentications, managed identities (and service principles) for applications, conditional access, and account anomalies monitoring. For more information, see üí°[Identity Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management) "
                  },
                  "customWidth": "49",
                  "name": "IM Guide"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "5",
                  "name": "text - 2"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                        "cellValue": "IM-1",
                        "linkTarget": "step",
                        "linkLabel": "IM-1: Standardize AAD as the Central Identity and Authentication System",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                        "cellValue": "IM-2",
                        "linkTarget": "step",
                        "linkLabel": "IM-2: Manage Application Identities Securely and Automatically",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                        "cellValue": "IM-3",
                        "linkTarget": "step",
                        "linkLabel": "IM-3: Use Azure AD Single Sign-On (SSO) for Application Access",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                        "cellValue": "IM-4",
                        "linkTarget": "step",
                        "linkLabel": "IM-4: Use Strong Authentication Controls for all AAD Based Access",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                        "cellValue": "IM-5",
                        "linkTarget": "step",
                        "linkLabel": "IM-5: Monitor and Alert on Account Anomalies",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                        "cellValue": "IM-6",
                        "linkTarget": "step",
                        "linkLabel": "IM-6: Restrict Azure Resource Access Based on Conditions",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "b212a060-9b1c-46e1-a411-e01924d0e4ee",
                        "cellValue": "IM-7",
                        "linkTarget": "step",
                        "linkLabel": "IM-7: Eliminate Unintended Credential Exposure",
                        "preText": "Go to >",
                        "style": "link"
                      },
                      {
                        "id": "3954d6c6-b445-4ea7-9953-446c1bab3e08",
                        "cellValue": "IM-8",
                        "linkTarget": "step",
                        "linkLabel": "IM-8: Secure User Access to Legacy Applications",
                        "preText": "Go to >",
                        "style": "link"
                      }
                    ]
                  },
                  "customWidth": "40",
                  "name": "IM Steps"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Control Mappings\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|IM-1: Standardize Azure Active Directory as the Central Identity and Authentication System| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|IM-2: Manage Application Identities Securely and Automatically| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|IM-3: Use Azure AD Single Sign-On (SSO) For Application Access| ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|IM-4: Use Strong Authentication Controls For All Azure Active Directory Based Access| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|IM-5: Monitor and Alert On Account Anomalies|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)|\r\n|IM-6: Restrict Azure Resource Access Based on Conditions| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|IM-7: Eliminate Unintended Credential Exposure|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)|\r\n|IM-8: Secure User Access to Legacy Applications|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security)|"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "IM Guide "
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-1: Standardize Azure Active Directory as the Central Identity and Authentication System](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-1-standardize-azure-active-directory-as-the-central-identity-and-authentication-system)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Active Directory]( https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Hardening\r\nüü¶ [Tenancy in Azure AD](https://docs.microsoft.com/azure/active-directory/develop/single-and-multi-tenant-apps)<br>\r\nüü¶ [How to Create and Configure an Azure AD Instance](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-access-create-new-tenant)<br>\r\nüü¶ [Define Azure AD Tenants](https://azure.microsoft.com/resources/securing-azure-environments-with-azure-active-directory/)<br>\r\nüü¶ [Use External Identity Providers for An Application](https://docs.microsoft.com/azure/active-directory/external-identities/identity-providers)<br>\r\nüü¶ [What is the Identity Secure Score in Azure AD](https://docs.microsoft.com/azure/active-directory/fundamentals/identity-secure-score)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[16.1, 16.2, 16.4, 16.5](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-2, IA-8, AC-2, AC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-1",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IM.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Azure Security Center Recommendations (IM-1) over TIme",
                          "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 4",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IM.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Current Azure Security Benchmark Recommendations (IM-1) ",
                          "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationDisplayName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "yellow",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ControlID",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureActivity\r\n| where Caller <> \"\"\r\n| extend UserPrincipalName = Caller\r\n| join (SigninLogs) on UserPrincipalName\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\",UserId)\r\n| summarize count() by UserPrincipalName, UserProfile\r\n| sort by count_ desc\r\n| take 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ User Action Count",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserProfile",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go To AAD UserProfile >>"
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "name": "IM-1",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-2: Manage Application Identities Securely and Automatically](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-2-manage-application-identities-securely-and-automatically)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AADManagedIdentitySignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadmanagedidentitysigninlogs) üî∑ [AADServicePrincipalSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadserviceprincipalsigninlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Hardening\r\nüü¶ [Azure Managed Identities](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)<br>\r\nüü¶ [Services that Support Managed Identities for Azure Resources](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities)<br>\r\nüü¶ [Azure Service Principal](https://docs.microsoft.com/powershell/azure/create-azure-service-principal-azureps)<br>\r\nüü¶ [Create a Service Principal with Certificates](https://docs.microsoft.com/azure/active-directory/develop/howto-authenticate-service-principal-powershell)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)<br>\r\nüîÄ [Managed Identities](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities)<br>\r\nüîÄ [App Registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\nN/A\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, IA-2, IA-4, IA-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-2",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IM.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Azure Security Center Recommendations (IM-2) over Time",
                          "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 5",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IM.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Current Azure Security Benchmark Recommendations (IM-2) ",
                          "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationDisplayName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "yellow",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ControlID",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": ""
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AADManagedIdentitySignInLogs\r\n| summarize count() by ServicePrincipalName\r\n| sort by count_ desc",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Managed Identity Actions",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ServicePrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "uninitialized",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 5",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AADServicePrincipalSignInLogs \r\n| summarize count() by ServicePrincipalName\r\n| sort by count_ desc",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Service Principal Actions",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set. ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ServicePrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "uninitialized",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      }
                    ]
                  },
                  "name": "IM-2",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-3: Use Azure AD Single Sign-On (SSO) for Application Access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-3-use-azure-ad-single-sign-on-sso-for-application-access)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AADNonInteractiveUserSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadnoninteractiveusersigninlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Hardening\r\nüü¶ [Understand Application SSO with Azure AD](https://docs.microsoft.com/azure/active-directory/manage-apps/what-is-single-sign-on)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4.4](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-2, IA-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-4",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AADNonInteractiveUserSignInLogs\r\n| extend UserProfile = strcat(\"https://portal.azure.com/#blade/Microsoft_AAD_IAM/UserDetailsMenuBlade/Profile/userId/\",UserId)\r\n| summarize count() by UserPrincipalName, UserProfile\r\n| sort by count_ desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ SSO Activity by Non-Interactive Sign-ins",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UserProfile",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go To AAD User Profile >>"
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "ServicePrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "uninitialized",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 2",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      }
                    ]
                  },
                  "name": "IM-3",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-4: Use Strong Authentication Controls For All Azure Active Directory Based Access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-4-use-strong-authentication-controls-for-all-azure-active-directory-based-access)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Hardening\r\nüü¶ [How to Enable MFA in Azure](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-getstarted)<br>\r\nüü¶ [Introduction to Passwordless Authentication Options for Azure Active Directory](https://docs.microsoft.com/azure/active-directory/authentication/concept-authentication-passwordless)<br>\r\nüü¶ [Azure AD Default Password Policy](https://docs.microsoft.com/azure/active-directory/authentication/concept-sspr-policy#password-policies-that-only-apply-to-cloud-user-accounts)<br>\r\nüü¶ [Eliminate Bad Passwords Using Azure AD Password Protection](https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4.2, 4.4 4.5, 11.5, 12.11, 16.3](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, IA-2, IA-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-4",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IM.4\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Azure Security Center Recommendations (IM-4) over Time",
                          "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 4",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IM.4\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Current Azure Security Benchmark Recommendations (IM-4) ",
                          "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationDisplayName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "yellow",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ControlID",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SigninLogs\r\n| summarize count() by UserPrincipalName, AuthenticationRequirement, AppDisplayName\r\n| sort by count_ desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Single vs Multi-Factor Authentication by Account",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AuthenticationRequirement",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "representation": null,
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "multiFactorAuthentication",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "singleFactorAuthentication",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "üü¶ Single vs Multi-Factor Authentication by Account"
                      }
                    ]
                  },
                  "name": "IM-4",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-5: Monitor and Alert on Account Anomalies](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-5-monitor-and-alert-on-account-anomalies)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) üî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Hardening\r\nüü¶ [Audit Activity Reports in Azure AD](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs)<br>\r\nüü¶ [How to View Azure AD risky Sign-Ins](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)<br>\r\nüü¶ [How to Identify Azure AD Users Flagged for Risky Activity](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)<br>\r\nüü¶ [How to Monitor Users' Identity and Access Activity in Azure Security Center](https://docs.microsoft.com/azure/security-center/security-center-identity-access)<br>\r\nüü¶ [Alerts in Azure Security Center's Threat Intelligence Protection Module](https://docs.microsoft.com/azure/security-center/alerts-reference)<br>\r\nüü¶ [How to Integrate Azure activity Logs into Azure Monitor](https://docs.microsoft.com/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics)<br>\r\nüü¶ [Connect Data from Azure AD Identity Protection](https://docs.microsoft.com/azure/sentinel/connect-azure-ad-identity-protection)<br>\r\nüü¶ [Microsoft Defender for Identity](https://docs.microsoft.com/azure-advanced-threat-protection/what-is-atp)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\nüîÄ [Microsoft Cloud App Security Portal](https://portal.cloudappsecurity.com/)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4.8, 4.9, 16.12, 16.13](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, AC-7, AU-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-5",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let UncommonActionVolume = BehaviorAnalytics\r\n| extend UncommonActionVolume = tostring(ActivityInsights.UncommonHighVolumeOfActions)\r\n| where UncommonActionVolume == \"True\"\r\n| summarize count() by UserPrincipalName\r\n| project-rename UncommonActionVolume = count_;\r\nlet UncommonAction = BehaviorAnalytics\r\n| extend UncommonAction = tostring(ActivityInsights.ActionUncommonlyPerformedByUser)\r\n| where UncommonAction == \"True\"\r\n| summarize count() by UserPrincipalName\r\n| project-rename UncommonAction = count_;\r\nlet Uncommon = UncommonActionVolume | join(UncommonAction) on UserPrincipalName;\r\nlet FirstTimeDeviceLogon = BehaviorAnalytics\r\n| extend FirstTimeDeviceLogon = tostring(ActivityInsights.FirstTimeUserLoggedOnToDevice)\r\n| where FirstTimeDeviceLogon == \"True\"\r\n| summarize count() by UserPrincipalName\r\n| project-rename FirstTimeDeviceLogon = count_;\r\nlet FirstTimeUserAction = BehaviorAnalytics\r\n| extend FirstTimeUserAction = tostring(ActivityInsights.FirstTimeUserPerformedAction)\r\n| where FirstTimeUserAction == \"True\"\r\n| summarize count() by UserPrincipalName\r\n| project-rename FirstTimeUserAction = count_;\r\nlet FirstTime = FirstTimeUserAction | join(FirstTimeDeviceLogon) on UserPrincipalName;\r\nUncommon | join kind=fullouter(FirstTime) on UserPrincipalName\r\n| where UserPrincipalName <> \"\"\r\n| project UserPrincipalName, UncommonActionVolume, UncommonAction, FirstTimeUserAction, FirstTimeDeviceLogon\r\n| sort by UncommonActionVolume desc \r\n| limit 250\r\n\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ User Anomalies",
                          "noDataMessage": "There are no results within the selected thresholds (time, workspace, subscription). See Enable User and Entity Behavior Analytics (UEBA) in Azure Sentinel for respective UEBA configurations (https://docs.microsoft.com/azure/sentinel/enable-entity-behavior-analytics)",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "UncommonActionVolume",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "redBright"
                                }
                              },
                              {
                                "columnMatch": "UncommonAction",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "green"
                                }
                              },
                              {
                                "columnMatch": "FirstTimeUserAction",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "blue"
                                }
                              },
                              {
                                "columnMatch": "FirstTimeDeviceLogon",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "yellow"
                                }
                              },
                              {
                                "columnMatch": "IncidentCount",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "redBright"
                                }
                              },
                              {
                                "columnMatch": "AlertCount",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "orange"
                                }
                              },
                              {
                                "columnMatch": "AnomalyCount",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "yellow"
                                }
                              }
                            ],
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_bar_FirstTimeDeviceLogon_4",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_bar_FirstTimeDeviceLogon_4",
                              "sortOrder": 2
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "SigninStatus",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "blue"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "Trend",
                              "formatter": 9,
                              "formatOptions": {
                                "palette": "green"
                              }
                            },
                            "showBorder": false
                          },
                          "mapSettings": {
                            "locInfo": "CountryRegion",
                            "locInfoColumn": "Location",
                            "latitude": "SourceIPLocation",
                            "longitude": "SourceIPLocation",
                            "sizeSettings": "Location",
                            "sizeAggregation": "Count",
                            "legendMetric": "Location",
                            "legendAggregation": "Count",
                            "itemColorSettings": {
                              "nodeColorField": "Location",
                              "colorAggregation": "Count",
                              "type": "thresholds",
                              "thresholdsGrid": [
                                {
                                  "operator": "Default",
                                  "thresholdValue": null,
                                  "representation": "blueDark"
                                }
                              ]
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityAlert\r\n| where AlertName contains \"account\" or AlertName contains \"identity\" or AlertName contains \"user\" or AlertName contains \"AAD\" or AlertName contains \"directory\" or AlertName contains \"sign\" or AlertName contains \"travel\" or AlertName contains \"logon\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Security Alerts for Accounts over Time",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "name": "IM-5",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-6: Restrict Azure Resource Access Based on Conditions](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-6-restrict-azure-resource-access-based-on-conditions)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Hardening\r\nüü¶ [Azure Conditional Access Overview](https://docs.microsoft.com/azure/active-directory/conditional-access/overview)<br>\r\nüü¶ [Common Conditional Access Policies](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-policy-common)<br>\r\nüü¶ [Configure Authentication Session Management with Conditional Access](https://docs.microsoft.com/azure/active-directory/conditional-access/howto-conditional-access-session-lifetime)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\nN/A\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-6",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status)\r\n| extend ConditionalAccessPolicies = parse_json(ConditionalAccessPolicies);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|extend CAStatus = case(ConditionalAccessStatus ==\"success\",\"Successful\",\r\n                    ConditionalAccessStatus == \"failure\", \"Failed\",                                     \r\n                    ConditionalAccessStatus == \"notApplied\", \"Not applied\",                                     \r\n                    isempty(ConditionalAccessStatus), \"Not applied\", \r\n                    \"Disabled\")\r\n|mvexpand ConditionalAccessPolicies\r\n|extend CAGrantControlName = tostring(ConditionalAccessPolicies.enforcedGrantControls[0])\r\n|extend CAGrantControl = case(CAGrantControlName contains \"MFA\", \"Require MFA\", \r\n                            CAGrantControlName contains \"Terms of Use\", \"Require Terms of Use\", \r\n                            CAGrantControlName contains \"Privacy\", \"Require Privacy Statement\", \r\n                            CAGrantControlName contains \"Device\", \"Require Device Compliant\", \r\n                            CAGrantControlName contains \"Azure AD Joined\", \"Require Hybird Azure AD Joined Device\", \r\n                            CAGrantControlName contains \"Apps\", \"Require Approved Apps\",\r\n                            \"Other\");\r\ndata\r\n| summarize Count = dcount(Id) by CAStatus\r\n| join kind = inner (data\r\n                    | make-series Trend = dcount(Id) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CAStatus\r\n                    ) on CAStatus\r\n| project-away CAStatus1, TimeGenerated\r\n| order by Count desc",
                          "size": 4,
                          "showAnalytics": true,
                          "title": "üîÄ Conditional Access Status ",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "CAStatus",
                              "formatter": 1
                            },
                            "subtitleContent": {
                              "columnMatch": "Category"
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SigninLogs\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by ConditionalAccessStatus\r\n| render areachart",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Conditional Access Status over Time",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "notApplied",
                                "color": "red"
                              },
                              {
                                "seriesName": "success",
                                "color": "greenDark"
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "name": "IM-6",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-7: Eliminate Unintended Credential Exposure](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-7-eliminate-unintended-credential-exposure)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) \r\n <br>\r\n\r\n### Hardening\r\nüü¶ [How to Setup Credential Scanner](https://secdevtools.azurewebsites.net/helpcredscan.html)<br>\r\nüü¶ [GitHub Secret Scanning](https://docs.github.com/github/administering-a-repository/about-secret-scanning)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v7.1 IDs\r\n[18.1, 18.7](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IA-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-7",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IM.7\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Azure Security Center Recommendations (IM-7) over Time",
                          "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 4",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IM.7\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Current Azure Security Benchmark Recommendations (IM-7) ",
                          "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationDisplayName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "yellow",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "ControlID",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityAlert\r\n| where AlertName contains \"secret\" or AlertName contains \"cred\" or AlertName contains \"password\" or AlertName contains \"auth\" or AlertName contains \"cert\"\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n| extend Href_ = tostring(parse_json(ExtendedLinks)[0].Href)\r\n| extend UserPrincipalName = UPN\r\n| where UserPrincipalName !contains \"[\"\r\n| where UserPrincipalName <> \"\"\r\n| summarize count() by UserPrincipalName, AlertName, ProductName\r\n| sort by count_ desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Security Alerts for Credentials",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AlertName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Fired",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              },
                              {
                                "columnMatch": "Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              },
                              {
                                "columnMatch": "AlertLink",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Alert >"
                                }
                              },
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              },
                              {
                                "columnMatch": "RecommendationClick",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Click to Recommendation"
                                }
                              },
                              {
                                "columnMatch": "RecommendationLink",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Go to Recommendation >"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "üü¶ Security Alerts for Credentials"
                      }
                    ]
                  },
                  "name": "IM-7",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "# [IM-8: Secure User Access to Legacy Applications](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management#im-8-secure-user-access-to-legacy-applications)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/security/business/cloud-app-security) <br> \r\n\r\n### Hardening\r\nüü¶ [Azure AD Application Proxy](https://docs.microsoft.com/azure/active-directory/manage-apps/application-proxy#what-is-application-proxy)<br>\r\nüü¶ [Microsoft Cloud App Security Best Practices](https://docs.microsoft.com/cloud-app-security/best-practices)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Microsoft Cloud App Security](https://portal.cloudappsecurity.com/)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[14.6](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, SC-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "IM-8",
                        "styleSettings": {
                          "maxWidth": "50"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityAlert\r\n| where ProviderName == \"MCAS\" or ProviderName == \"IPC\"\r\n| where AlertName contains \"app\" or AlertName contains \"access\" or AlertName contains \"user\" or AlertName contains \"unfamiliar\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Microsoft Cloud App Security: App Access Alerts over Time",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "DisplayName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              }
                            ]
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "üîÄ Microsoft Cloud App Security: App Access Alerts over Time"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "SecurityAlert\r\n| where ProviderName == \"MCAS\"\r\n| where AlertName contains \"app\" or AlertName contains \"access\" or AlertName contains \"user\" or AlertName contains \"unfamiliar\"\r\n| extend AlertLink = tostring(parse_json(ExtendedLinks)[1].Href)\r\n| extend CloudApplication = tostring(parse_json(ExtendedProperties).[\"Cloud Applications\"])\r\n| extend UserId = tostring(parse_json(Entities)[0].AadUserId)\r\n| join (SigninLogs) on UserId\r\n| summarize count() by UserPrincipalName, CloudApplication, AlertName\r\n| sort by count_ desc\r\n| limit 250",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "üîÄ Microsoft Cloud App Security: User Application Access Alerts",
                          "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                          "timeContext": {
                            "durationMs": 0
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "UserPrincipalName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Person",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "AlertName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Fired",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              },
                              {
                                "columnMatch": "Count",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "yellowOrangeRed"
                                }
                              },
                              {
                                "columnMatch": "AlertLink",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url",
                                  "linkLabel": "Link to Alert >"
                                }
                              },
                              {
                                "columnMatch": "DisplayName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "warning",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "isIMVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "üîÄ Microsoft Cloud App Security: User Application Access Alerts"
                      }
                    ]
                  },
                  "name": "IM-8",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "isIMVisible",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "Identity Management (IM)"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isIMVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Identity Management (IM)"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Privileged Access (PA)\r\n---\r\nPrivileged Access covers controls to protect privileged access to your Azure tenant and resources, including a range of controls to protect your administrative model, administrative accounts, and privileged access workstations against deliberate and inadvertent risk. For more information, see üí°[Privileged Access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access) "
            },
            "customWidth": "49",
            "name": "PA Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 11"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "PA-1",
                  "linkTarget": "step",
                  "linkLabel": "PA-1: Protect and Limit Highly Privileged Users",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "PA-2",
                  "linkTarget": "step",
                  "linkLabel": "PA-2: Restrict Administrative Access to Business-Critical Systems",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "PA-3",
                  "linkTarget": "step",
                  "linkLabel": "PA-3: Review and Reconcile User Access Regularly",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "PA-4",
                  "linkTarget": "step",
                  "linkLabel": "PA-4: Setup Emergency Access in Azure AD",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "PA-5",
                  "linkTarget": "step",
                  "linkLabel": "PA-5: Automate Entitlement Management",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                  "cellValue": "PA-6",
                  "linkTarget": "step",
                  "linkLabel": "PA-6: Use Privileged Access Workstations",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "b212a060-9b1c-46e1-a411-e01924d0e4ee",
                  "cellValue": "PA-7",
                  "linkTarget": "step",
                  "linkLabel": "PA-7: Follow Just Enough Administration (Least Privilege Principle)",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "9b080d55-ae11-4e9b-85bc-ae891dffc873",
                  "cellValue": "PA-8",
                  "linkTarget": "step",
                  "linkLabel": "PA-8: Choose Approval Process for Microsoft Support",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "PA Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|PA-1: Protect and Limit Highly Privileged Users|‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|PA-2: Restrict Administrative Access to Business-Critical Systems| ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) |\r\n|PA-3: Review and Reconcile User Access Regularly| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|PA-4: Setup Emergency Access in Azure AD| ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|PA-5: Automate Entitlement Management| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|PA-6: Use Privileged Access Workstations| ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|PA-7: Follow Just Enough Administration (Least Privilege Principle)| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|PA-8: Choose Approval Process for Microsoft Support|‚ú≥Ô∏è [Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview)|"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "PA Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-1: Protect and Limit Highly Privileged Users](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-1-protect-and-limit-highly-privileged-users)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Hardening\r\nüü¶ [Administrator Role Permissions in Azure AD](https://docs.microsoft.com/azure/active-directory/roles/permissions-reference)<br>\r\nüü¶ [Use Azure Privileged Identity Management Security Alerts](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-how-to-configure-security-alerts)<br>\r\nüü¶ [Securing Privileged Access for Hybrid and Cloud Deployments in Azure AD](https://docs.microsoft.com/azure/active-directory/roles/security-planning)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4.3, 4.8](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PA.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PA-1) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PA.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PA-1) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| extend UserPrincipalName = tostring(TargetResources[0].userPrincipalName)\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by UserPrincipalName\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ User Elevated Rights in Privileged Identity Management (PIM)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "PA-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-2: Restrict Administrative Access to Business-Critical Systems](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-2-restrict-administrative-access-to-business-critical-systems)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\nüî∑ [Heartbeat](https://docs.microsoft.com/azure/azure-monitor/reference/tables/heartbeat) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Hardening\r\nüü¶ [Azure Components and Reference Model](https://docs.microsoft.com/security/compass/microsoft-security-compass-introduction#azure-components-and-reference-model-2151)<br>\r\nüü¶ [Management Group Access](https://docs.microsoft.com/azure/governance/management-groups/overview#management-group-access)<br>\r\nüü¶ [Azure Subscription Administrators](https://docs.microsoft.com/azure/cost-management-billing/manage/add-change-subscription-administrator)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Resource Graph Queries](https://docs.microsoft.com/azure/governance/resource-graph/overview)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[13.2, 2.10](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, SC-3, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft\"\r\n| project id,type,resourceGroup\r\n| order by type asc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Identify & Protect Business-Critical Systems",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ManagementGroupName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Identify & Protect Business-Critical Systems",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat \r\n| summarize count() by ManagementGroupName\r\n| where ManagementGroupName <> \"\"\r\n| sort by count_ desc\r\n| project ManagementGroupName, count_",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Management Groups",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ManagementGroupName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "BehaviorAnalytics\r\n| extend BlastRadius_ = tostring(UsersInsights.BlastRadius)\r\n| summarize count() by UserPrincipalName, BlastRadius_\r\n| where BlastRadius_ <> \"Low\" and BlastRadius_ <> \"\" \r\n| project UserPrincipalName, BlastRadius_\r\n| sort by BlastRadius_ asc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Privileged Users by Blast Radius",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "BlastRadius_",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ManagementGroupName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "PA-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-3: Review and Reconcile User Access Regularly](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-3-review-and-reconcile-user-access-regularly)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Hardening\r\nüü¶ [Create an Access Review of Azure Resource Roles in Privileged Identity Management(PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-resource-roles-start-access-review)<br>\r\nüü¶ [How to Use Azure AD Identity and Access Reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4.1, 16.9, 16.10](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PA.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PA-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PA.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PA-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": ""
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| extend UserPrincipalName = tostring(TargetResources[0].userPrincipalName)\r\n| where Identity == \"MS-PIM\"\r\n| where UserPrincipalName <> \"\"\r\n| summarize count() by UserPrincipalName\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ User Elevated Rights in Privileged Identity Management (PIM)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "PA-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-4: Set Up Emergency Access in Azure AD](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-4-set-up-emergency-access-in-azure-ad)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Hardening\r\nüü¶ [Manage Emergency Access Accounts in Azure AD](https://docs.microsoft.com/azure/active-directory/roles/security-emergency-access)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[16](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, CP-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SigninLogs\r\n| extend MailAddress = UserPrincipalName\r\n| join (IdentityInfo) on MailAddress\r\n| where GroupMembership contains \"security\" or GroupMembership contains \"admin\" or AssignedRoles contains \"security\" or AssignedRoles contains \"admin\" \r\n| extend Roles = strcat(AssignedRoles)\r\n| summarize count() by UserPrincipalName, Roles\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Designate Emergency Accounts & Monitor Usage",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Monitor Emergency Accounts",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "PA-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-5: Automate Entitlement Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-5-automate-entitlement-management)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [What are Azure AD Access Reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\nüü¶ [What is Azure AD Entitlement Management](https://docs.microsoft.com/azure/active-directory/governance/entitlement-management-overview)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[16](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-5, PM-10](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PA.5\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PA-5) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PA.5\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PA-5) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "PA-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-6: Use Privileged Access Workstations](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-6-use-privileged-access-workstations)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Hardening\r\nüü¶ [Understand Privileged Access Workstations](https://docs.microsoft.com/security/compass/privileged-access-deployment)<br>\r\n\r\n### Microsoft Portal\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4.6, 11.6, 12.12](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, SC-3, SC-7](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Privileged Access Deployment](https://docs.microsoft.com/security/compass/privileged-access-deployment)\r\n![Image¬†Name](https://docs.microsoft.com/security/compass/media/privileged-access-deployment/privileged-access-deployment-profile-summary.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-4 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "PA-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-7: Follow Just Enough Administration (Least Privilege Principle)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-7-follow-just-enough-administration-least-privilege-principle)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Activity]( https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Hardening\r\nüü¶ [What is Azure Role-Based Access Control (Azure RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview)<br>\r\nüü¶ [How to Configure Azure RBAC](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal)<br>\r\nüü¶ [How to Use Azure AD Identity and Access Reviews](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[14.6](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, SC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PA.7\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PA-7) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PA.7\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PA-7) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| extend UserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\r\n| summarize Runs = count(), Success = countif(Result == 'success'), Fails = countif(Result != 'success') by OperationName // Summarize the total, successful and failed operations by name\r\n| extend SuccessRate = (Success * 100 / Runs) // Calculate the percentage of succesful operations against the total\r\n| project OperationName, Runs, SuccessRate, Fails\r\n| sort by Fails desc\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Monitor Privileged User Operations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Runs",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "SuccessRate",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        },
                        {
                          "columnMatch": "Fails",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "red"
                          }
                        },
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OfficeWorkload",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_SuccessRate_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_SuccessRate_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let data = AuditLogs\r\n| extend UserPrincipalName = tostring(InitiatedBy.user.userPrincipalName)\r\n    | where \"All\" == \"All\" or Result in ('All')\r\n    | extend initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\")\r\n    | where \"All\" == \"All\" or initiator in ('All')\r\n    | where \"All\" == \"All\" or Category in ('All')\r\n    | where Category == 'All' or 'All' == \"All\";\r\nlet appData = data\r\n    | summarize TotalCount = count() by OperationName, Category\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated in range(ago(7d), now(), 3h) by OperationName\r\n        | project-away TimeGenerated)\r\n        on OperationName\r\n    | order by TotalCount desc, OperationName asc\r\n    | project OperationName, TotalCount, Trend, Category\r\n    | serialize Id = row_number();\r\ndata\r\n| summarize TotalCount = count() by initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\"), Category, OperationName\r\n| join kind=inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated in range(ago(7d), now(), 3h) by OperationName, initiator = iif (tostring(InitiatedBy.user.userPrincipalName) != \"\", tostring(InitiatedBy.user.userPrincipalName), \"unknown\")\r\n    | project-away TimeGenerated)\r\n    on OperationName, initiator\r\n| order by TotalCount desc, OperationName asc\r\n| project OperationName, initiator, TotalCount, Category, Trend\r\n| serialize Id = row_number(1000000)\r\n| join kind=inner (appData) on OperationName\r\n| project Id, Name = initiator, Type = 'initiator', ['Operations Count'] = TotalCount, Trend, ParentId = Id1\r\n| union (appData \r\n    | project Id, Name = OperationName, Type = 'Operation', ['Operations Count'] = TotalCount, Trend)\r\n| order by ['Operations Count'] desc, Name asc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Monitor Privileged User Activities",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "exportParameterName": "UserInfo",
                    "exportDefaultValue": "{ \"Name\":\"\", \"Type\":\"*\"}",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Id",
                          "formatter": 5,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Type",
                          "formatter": 5,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Operations Count",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 9,
                          "formatOptions": {
                            "min": 0,
                            "palette": "turquoise",
                            "showIcon": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "ParentId",
                          "formatter": 5,
                          "formatOptions": {
                            "showIcon": true
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "hierarchySettings": {
                        "idColumn": "Id",
                        "parentColumn": "ParentId",
                        "treeType": 0,
                        "expanderColumn": "Name"
                      }
                    },
                    "sortBy": [],
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blueDark"
                          }
                        ]
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                }
              ]
            },
            "name": "PA-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PA-8: Choose Approval Process for Microsoft Support](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access?WT.mc_id=Portal-fx#pa-8-choose-approval-process-for-microsoft-support)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview) <br>\r\n\r\n### Hardening\r\nüü¶ [Understand Customer Lockbox](https://docs.microsoft.com/azure/security/fundamentals/customer-lockbox-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Customer Lockbox](https://portal.azure.com/#blade/Microsoft_Azure_Lockbox/LockboxMenu/Overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[16](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-2, AC-3, AC-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PA-8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"lock\"\r\n| summarize count() by Caller, OperationName\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Customer Lockbox Activity",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPAVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "PA-8",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isPAVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Privileged Access Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Data Protection (DP)\r\n---\r\nData Protection covers control of data protection at rest, in transit, and via authorized access mechanisms, including discover, classify, protect, and monitor sensitive data assets using access control, encryption, and logging in Azure. For more information, see üí°[Data Protection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection) "
            },
            "customWidth": "49",
            "name": "DP Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 8"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "DP-1",
                  "linkTarget": "step",
                  "linkLabel": "DP-1: Discovery, Classify and Label Sensitive Data",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "DP-2",
                  "linkTarget": "step",
                  "linkLabel": "DP-2: Protect Sensitive Data",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "DP-3",
                  "linkTarget": "step",
                  "linkLabel": "DP-3: Monitor for Unauthorized Transfer of Sensitive Data",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "DP-4",
                  "linkTarget": "step",
                  "linkLabel": "DP-4: Encrypt Sensitive Information in Transit",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "DP-5",
                  "linkTarget": "step",
                  "linkLabel": "DP-5: Encrypt Sensitive Data at Rest",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "DP Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|DP-1: Discovery, Classify and Label Sensitive Data| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center) ‚ú≥Ô∏è [Azure Information Protection](https://azure.microsoft.com/services/information-protection/)|\r\n|DP-2: Protect Sensitive Data| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center)|\r\n|DP-3: Monitor for Unauthorized Transfer of Sensitive Data|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center)|\r\n|DP-4: Encrypt Sensitive Information in Transit| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center)|\r\n|DP-5: Encrypt Sensitive Data at Rest| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center)|\r\n"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "DP Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [DP-1: Discovery, Classify and Label Sensitive Data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection#dp-1-discovery-classify-and-label-sensitive-data)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [InformationProtectionLogs_CL](https://docs.microsoft.com/azure/information-protection/audit-logs) ‚ú≥Ô∏è [Azure Information Protection](https://azure.microsoft.com/services/information-protection/)<br>\r\n\r\n### Hardening\r\nüü¶ [Tag Sensitive Information Using Azure Information Protection](https://docs.microsoft.com/azure/information-protection/what-is-information-protection)<br>\r\nüü¶ [How to implement Azure SQL Data Discovery](https://docs.microsoft.com/azure/azure-sql/database/data-discovery-and-classification-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Information Protection](https://portal.azure.com/#blade/Microsoft_Azure_InformationProtection/DataClassGroupEditBlade/quickstartBlade) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[13.1, 14.5, 14.7](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SC-28](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "DP-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"DP.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (DP-1) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"DP.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (DP-1) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "InformationProtectionLogs_CL\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by¬†Activity_s, Operation_s, LabelName_s, ApplicationName_s\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Information Protection Activity over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                }
              ]
            },
            "name": "DP-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [DP-2: Protect Sensitive Data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection#dp-2-protect-sensitive-data)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Azure Role-Based Access Control (Azure RBAC)](https://docs.microsoft.com/azure/role-based-access-control/overview)<br>\r\nüü¶ [Understand Customer Data Protection in Azure](https://docs.microsoft.com/azure/security/fundamentals/protection-customer-data)<br>\r\n\r\n### Microsoft Logs\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[13.2, 2.10](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SC-7, AC-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "DP-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"DP.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (DP-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (DP-2) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"DP.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (DP-2) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "DP-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [DP-3: Monitor for Unauthorized Transfer of Sensitive Data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection#dp-3-monitor-for-unauthorized-transfer-of-sensitive-data)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) üî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Azure Defender for SQL](https://docs.microsoft.com/azure/azure-sql/database/azure-defender-for-sql)<br>\r\nüü¶ [Azure Defender for Storage](https://docs.microsoft.com/azure/storage/common/azure-defender-storage-configure?tabs=azure-security-center)<br>\r\n\r\n### Microsoft Portals \r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[13.3](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-4, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "DP-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"DP.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (DP-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"DP.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (DP-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where ProviderName == \"Azure Security Center\"\r\n| summarize count() by AlertName\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Defender Alerts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Link to Alert >"
                          }
                        },
                        {
                          "columnMatch": "DisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Defender Alerts",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "DP-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [DP-4: Encrypt Sensitive Information in Transit](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection#dp-4-encrypt-sensitive-information-in-transit)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Understand Encryption in Transit with Azure](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview#encryption-of-data-in-transit)<br>\r\nüü¶ [Information on TLS Security](https://docs.microsoft.com/security/engineering/solving-tls1-problem)<br>\r\nüü¶ [Double Encryption for Azure Data in Transit](https://docs.microsoft.com/azure/security/fundamentals/double-encryption#data-in-transit)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[\t14.4](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SC-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "DP-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"DP.4\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (DP-4) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"DP.4\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (DP-4) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "DP-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [DP-5: Encrypt Sensitive Data at Rest](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection#dp-5-encrypt-sensitive-data-at-rest)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Understand Encryption at Rest in Azure](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest#encryption-at-rest-in-microsoft-cloud-services)<br>\r\nüü¶ [How to Configure Customer Managed Encryption Keys](https://docs.microsoft.com/azure/storage/common/customer-managed-keys-configure-key-vault)<br>\r\nüü¶ [Encryption Model and Key Management Table](https://docs.microsoft.com/azure/security/fundamentals/encryption-models)<br>\r\nüü¶ [Data at Rest Double Encryption in Azure](https://docs.microsoft.com/azure/security/fundamentals/double-encryption#data-at-rest)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[14.8](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SC-28, SC-12](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "DP-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"DP.5\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (DP-5) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"DP.5\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (DP-5) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isDPVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "DP-5",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isDPVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Data Protection Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Asset Management (AM)\r\n---\r\nAsset Management covers controls to ensure security visibility and governance over Azure resources, including recommendations on permissions for security personnel, security access to asset inventory, and managing approvals for services and resources (inventory, track, and correct). For more information, see üí°[Asset Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management) "
            },
            "customWidth": "49",
            "name": "AM Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "A"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "AM-1",
                  "linkTarget": "step",
                  "linkLabel": "AM-1: Ensure Security Team has Visibility into Risks for Assets",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "AM-2",
                  "linkTarget": "step",
                  "linkLabel": "AM-2: Ensure Security Team has Access to Asset Inventory and Metadata",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "AM-3",
                  "linkTarget": "step",
                  "linkLabel": "AM-3: Use Only Approved Azure Services",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "AM-4",
                  "linkTarget": "step",
                  "linkLabel": "AM-4: Ensure Security of Asset Lifecycle Management",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "AM-5",
                  "linkTarget": "step",
                  "linkLabel": "AM-5: Limit Users' Ability to Interact with Azure Resource Manager",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                  "cellValue": "AM-6",
                  "linkTarget": "step",
                  "linkLabel": "AM-6: Use Only Approved Applications in Compute Resources",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "AM Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|AM-1: Ensure Security Team has Visibility into Risks for Assets| ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> |\r\n|AM-2: Ensure Security Team has Access to Asset Inventory and Metadata| ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)|\r\n|AM-3: Use Only Approved Azure Services| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)|\r\n|AM-4: Ensure Security of Asset Lifecycle Management|‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/)|\r\n|AM-5: Limit Users' Ability to Interact with Azure Resource Manager|‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|AM-6: Use Only Approved Applications in Compute Resources|‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center) ‚ú≥Ô∏è [Azure Automation]( https://azure.microsoft.com/services/automation/)|"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "AM Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [AM-1: Ensure Security Team Has Visibility Into Risks For Assets](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management#am-1-ensure-security-team-has-visibility-into-risks-for-assets)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Heartbeat](https://docs.microsoft.com/azure/azure-monitor/reference/tables/heartbeat) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Hardening\r\nüü¶ [Overview of Security Reader Role](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#security-reader)<br>\r\nüü¶ [Overview of Azure Management Groups](https://docs.microsoft.com/azure/governance/management-groups/overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[1.1, 1.2](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-8, PM-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SigninLogs\r\n| extend MailAddress = UserPrincipalName\r\n| join (IdentityInfo) on MailAddress\r\n| where GroupMembership contains \"security\" or GroupMembership contains \"admin\" or AssignedRoles contains \"security\" or AssignedRoles contains \"admin\" \r\n| extend Roles = strcat(AssignedRoles)\r\n| summarize count() by UserPrincipalName, Roles\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Security/Admin Roles",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üîÄ Security/Admin Roles",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "AM-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [AM-2: Ensure Security Team has Access to Asset Inventory and Metadata](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management#am-2-ensure-security-team-has-access-to-asset-inventory-and-metadata)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Create Queries with Azure Resource Graph Explorer](https://docs.microsoft.com/azure/governance/resource-graph/first-query-portal)<br>\r\nüü¶ [Azure Security Center Asset Inventory Management](https://docs.microsoft.com/azure/security-center/asset-inventory)<br>\r\nüü¶ [For More Information About Tagging Assets, See the Resource Naming and Tagging Decision Guide](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/resource-tagging/?toc=%2fazure%2fazure-resource-manager%2fmanagement%2ftoc.json)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[1.1, 1.2, 1.4, 1.5, 9.1, 12.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-8, PM-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft\"\r\n| project id,type,location,resourceGroup\r\n| order by location asc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Asset Inventory",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "properties_storageProfile_osDisk_osType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Windows",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Linux",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "green",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDarkDark"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üîÄ Asset Inventory",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft\"\r\n| project id,type,resourceGroup, tags\r\n| extend tag = strcat(tags)\r\n| summarize count() by tag\r\n| where tag <> \"\" \r\n| where tag <> \"{}\" \r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Tags Currently In Use",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "properties_storageProfile_osDisk_osType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Windows",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Linux",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "green",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Tags Currently In Use",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "AM-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [AM-3: Use Only Approved Azure Services](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management#am-3-use-only-approved-azure-services)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n### Hardening\r\nüü¶ [Configure and Manage Azure Policy](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüü¶ [How to Deny a Specific Resource Type with Azure Policy](https://docs.microsoft.com/azure/governance/policy/samples/index)<br>\r\nüü¶ [How to Create Queries with Azure Resource Graph Explorer](https://docs.microsoft.com/azure/governance/resource-graph/first-query-portal)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[2.3, 2.4](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-7, CM-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRecommendation\r\n| where RecommendationName == \"Storage accounts should be migrated to new Azure Resource Manager resources\"\r\n    or RecommendationName == \"Virtual machines should be migrated to new Azure Resource Manager resources\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by RecommendationName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Azure Security Center Recommendations (AM-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 7776000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (AM-3) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"AM.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Current Azure Security Benchmark Recommendations (AM-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Current Azure Security Benchmark Recommendations (AM-3) "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "securityresources\r\n| where type =~ \"microsoft.security/assessments\"\r\n| extend assessmentStatusCode = tostring(properties.status.code)\r\n| extend firstEvaluationDate = todatetime(properties.status.firstEvaluationDate)\r\n| extend statusChangeDate = todatetime(properties.status.statusChangeDate)\r\n| where statusChangeDate > firstEvaluationDate\r\n| sort by statusChangeDate desc\r\n| project id, type, resourceGroup, assessmentStatusCode\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Security Assessment by Policy",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Security Assessment by Policy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| where type contains 'Microsoft'\r\n| project id,type,resourceGroup\r\n| summarize count() by type\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Asset Count by Type",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üîÄ Asset Count by Type",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "AM-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [AM-4: Ensure Security of Asset Lifecycle Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management#am-4-ensure-security-of-asset-lifecycle-management)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Hardening\r\nüü¶ [Delete Azure Resource Group and Resource](https://docs.microsoft.com/azure/azure-resource-manager/management/delete-resource-group)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[2.3, 2.4, 2.5](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-7, CM-8, CM-10, CM-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"delete\" or OperationName contains \"remove\"\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Delete/Remove Assets by User",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 7776000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Delete/Remove Assets by User",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "AM-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [AM-5: Limit Users' Ability to Interact with Azure Resource Manager](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management#am-5-limit-users-ability-to-interact-with-azure-resource-manager)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Hardening\r\nüü¶ [How to Configure Conditional Access to Block Access to Azure Resources Manager](https://docs.microsoft.com/azure/role-based-access-control/conditional-access-azure-management)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[2.9](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM-5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SigninLogs\r\n| where ResourceDisplayName contains \"Manage\" or ResourceDisplayName contains \"graph\"\r\n| summarize count() by UserPrincipalName, ResourceDisplayName, ConditionalAccessStatus\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Azure Resource Manager/ Graph Access",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 7776000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ConditionalAccessStatus",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "success",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "redBright",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Resource Manager/ Graph Access",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "AM-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [AM-6: Use Only Approved Applications in Compute Resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management#am-6-use-only-approved-applications-in-compute-resources)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Use Azure Security Center Adaptive Application Controls](https://docs.microsoft.com/azure/security-center/security-center-adaptive-application)<br>\r\nüü¶ [Understand Azure Automation Change Tracking and Inventory](https://docs.microsoft.com/azure/automation/change-tracking/overview)<br>\r\nüü¶ [How to Control PowerShell Script Execution in Windows Environments](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/set-executionpolicy)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[2.6, 2.7](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC-3, CM-7, CM-8, CM-10, CM-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRecommendation\r\n| where RecommendationName == \"Adaptive application controls for defining safe applications should be enabled on your machines\"\r\n    or RecommendationName == \"Allowlist rules in your adaptive application control policy should be updated\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by RecommendationName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Azure Security Center Recommendations (AM-6) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 7776000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (AM-6) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"AM.6\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Current Azure Security Benchmark Recommendations (AM-6) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Current Azure Security Benchmark Recommendations (AM-6) "
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ Azure Automation Change Tracking and Inventory\r\n![Image¬†Name](https://docs.microsoft.com/azure/automation/change-tracking/media/overview/windowservices.png)¬†\r\n\r\nüí° [Change Tracking and Inventory Overview](https://docs.microsoft.com/azure/automation/change-tracking/overview)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isAMVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "AM",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "AM-6",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isAMVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Asset Management Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Logging and Threat Detection (LT)\r\n---\r\nLogging and Threat Detection covers controls for detecting threats on Azure and enabling, collecting, and storing audit logs for Azure services, including enabling detection, investigation, and remediation processes with controls to generate high-quality alerts with native threat detection in Azure services; it also includes collecting logs with Azure Monitor, centralizing security analysis with Azure Sentinel, time synchronization, and log retention. For more information, see üí°[Logging and Threat Detection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection) "
            },
            "customWidth": "49",
            "name": "LT Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 10"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "LT-1",
                  "linkTarget": "step",
                  "linkLabel": "LT-1: Enable Threat Detection for Azure Resources",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "LT-2",
                  "linkTarget": "step",
                  "linkLabel": "LT-2: Enable Threat Detection for Azure Identity and Access Management",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "LT-3",
                  "linkTarget": "step",
                  "linkLabel": "LT-3: Enable Logging for Azure Network Activities",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "LT-4",
                  "linkTarget": "step",
                  "linkLabel": "LT-4: Enable Logging for Azure Resources",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "LT-5",
                  "linkTarget": "step",
                  "linkLabel": "LT-5: Centralize Security Log Management and Analysis",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                  "cellValue": "LT-6",
                  "linkTarget": "step",
                  "linkLabel": "LT-6: Configure Log Storage Retention",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "0f9bbc79-0bbf-49f2-a226-af454214a675",
                  "cellValue": "LT-7",
                  "linkTarget": "step",
                  "linkLabel": "LT-7: Use Approved Time Synchronization Sources",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "LT Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|LT-1: Enable Threat Detection for Azure Resources|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> ‚ú≥Ô∏è [Microsoft Defender for Identity]( https://www.microsoft.com/microsoft-365/security/identity-defender) ‚ú≥Ô∏è [Azure Defender for IoT](https://azure.microsoft.com/services/azure-defender-for-iot/)|\r\n|LT-2: Enable Threat Detection for Azure Identity and Access Management| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) |\r\n|LT-3: Enable Logging for Azure Network Activities| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/)‚ú≥Ô∏è [Application Gateway]( https://azure.microsoft.com/services/application-gateway/) ‚ú≥Ô∏è [Virtual Network]( https://azure.microsoft.com/services/virtual-network/)  ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)|\r\n|LT-4: Enable Logging for Azure Resources|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) |\r\n|LT-5: Centralize Security Log Management and Analysis|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) |\r\n|LT-6: Configure Log Storage Retention| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) |\r\n|LT-7: Use Approved Time Synchronization Sources| ‚ú≥Ô∏è [Azure Active Directory Domain Services](https://azure.microsoft.com/services/active-directory-ds/) ‚ú≥Ô∏è [Azure Policy](https://azure.microsoft.com/services/azure-policy/) ‚ú≥Ô∏è [Virtual Machines]( https://azure.microsoft.com/services/virtual-machines/) |"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "LT Guide"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-1: Enable Threat Detection for Azure Resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-1-enable-threat-detection-for-azure-resources)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert)‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender) ‚ú≥Ô∏è [Microsoft Defender for Identity]( https://www.microsoft.com/microsoft-365/security/identity-defender) ‚ú≥Ô∏è [Azure Defender for IoT](https://azure.microsoft.com/services/azure-defender-for-iot/)  <br>\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Threat Protection in Azure Security Center](https://docs.microsoft.com/azure/security-center/azure-defender)<br>\r\nüü¶ [Azure Security Center Security Alerts Reference Guide](https://docs.microsoft.com/azure/security-center/alerts-reference)<br>\r\nüü¶ [Create Custom Analytics Rules to Detect Threats](https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom)<br>\r\nüü¶ [Cyber Threat Intelligence with Azure Sentinel](https://docs.microsoft.com/azure/architecture/example-scenario/data/sentinel-threat-intelligence)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\nüîÄ [Microsoft Cloud App Security Portal](https://portal.cloudappsecurity.com/)<br>\r\nüîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> \r\nüîÄ [Azure Defender for IoT](https://portal.azure.com/#blade/Microsoft_Azure_IoT_Defender/IoTDefenderDashboard/Getting_Started)  <br>\r\nüîÄ [Microsoft Defender for Identity](https://portal.atp.azure.com/)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[6.7](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"LT.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (LT-1) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"LT.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (LT-1) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Current Azure Security Benchmark Recommendations (LT-1) "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where AlertLink <> \"\"\r\n| summarize count() by AlertName, AlertLink, ProductName\r\n| extend Count = count_\r\n| project AlertName, ProductName, Count, AlertLink\r\n| sort by Count desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Security Alerts ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Security Alerts ",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ThreatIntelligenceIndicator\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by SourceSystem\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Ingested Threat Intelligence by Source over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Ingested Threat Intelligence by Source over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "LT-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-2: Enable Threat Detection for Azure Identity and Access Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-2-enable-threat-detection-for-azure-identity-and-access-management)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Hardening\r\nüü¶ [Audit activity reports in Azure AD](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-audit-logs)<br>\r\nüü¶ [Enable Azure Identity Protection](https://docs.microsoft.com/azure/active-directory/identity-protection/overview-identity-protection)<br>\r\nüü¶ [Threat Protection in Azure Security Center](https://docs.microsoft.com/azure/security-center/azure-defender)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) \r\n\r\n### CIS Controls v7.1 IDs\r\n[6.8](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"LT.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (LT-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"LT.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (LT-2) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let AnomalousSigninActivity = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where (UsersInsights.NewAccount == True or UsersInsights.DormantAccount == True) and (\r\n        ActivityInsights.FirstTimeUserAccessedResource == True and ActivityInsights.ResourceUncommonlyAccessedAmongPeers == True\r\n        or ActivityInsights.FirstTimeUserUsedApp == True and ActivityInsights.AppUncommonlyUsedAmongPeers == False)\r\n    | join (\r\n        SigninLogs | where Status.errorCode == 0 or Status.errorCode == 0 and RiskDetail != \"none\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Successful Sign-in with one or more of the following indications: sign by new or recently dormant accounts and sign in with resource for the first time (while none of their peers did) or to an app for the first time (while none of their peers did) or performed by a user with Risk indicaiton from AAD\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet critical = dynamic(['9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3', 'c4e39bd9-1100-46d3-8c65-fb160da0071f', '158c047a-c907-4556-b7ef-446551a6b5f7', '62e90394-69f5-4237-9190-012177145e10', 'd29b2b05-8046-44ba-8758-1e26182fcf32', '729827e3-9c14-49f7-bb1b-9608f156bbb8', '966707d0-3269-4727-9be2-8c3a10f19b9d', '194ae4cb-b126-40b2-bd5b-6091b380977d', 'fe930be7-5e62-47db-91af-98c3a49a38b1']);\r\nlet high = dynamic(['cf1c38e5-3621-4004-a7cb-879624dced7c', '7495fdc4-34c4-4d15-a289-98788ce399fd', 'aaf43236-0c0d-4d5f-883a-6955382ac081', '3edaf663-341e-4475-9f94-5c398ef6c070', '7698a772-787b-4ac8-901f-60d6b08affd2', 'b1be1c3e-b65d-4f19-8427-f6fa0d97feb9', '9f06204d-73c1-4d4c-880a-6edb90606fd8', '29232cdf-9323-42fd-ade2-1d097af3e4de', 'be2f45a1-457d-42af-a067-6ec1fa63bc45', '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', 'e8611ab8-c189-46e8-94e1-60213ab1f814']);//witdstomstl\r\nlet AnomalousRoleAssignment = AuditLogs\r\n    | where TimeGenerated > ago(28d)\r\n    | where OperationName == \"Add member to role\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target = tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner (\r\n        BehaviorAnalytics\r\n        | where ActionType == \"Add member to role\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend AnomalyName = \"Anomalous Role Assignemt\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access.  The query below generates an output of all high Blast Radius users performing Add member to priveleged role, or ones that add users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let LogOns=materialize(\r\n    BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\");\r\nlet AnomalousResourceAccess = LogOns\r\n    | where ActionType == \"ResourceAccess\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous Resource Access\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversary may be trying to move through the environment. APT29 and APT32, for example, has used PtH & PtT techniques to lateral move around the network. The query below generates an output of all users performing an resource access (4624:3) to devices for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousRDPActivity = LogOns\r\n    | where ActionType == \"RemoteInteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous RDP Activity\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. FIN10, for example, has used RDP to move laterally to systems in the victim environment. The query below generates an output of all users performing a remote interactive logon (4624:10) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousLogintoDevices = LogOns\r\n    | where ActionType == \"InteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | where UsersInsights.DormantAccount == true or DevicesInsights.LocalAdmin == true\r\n    | extend AnomalyName = \"Anomalous Login To Devices\",\r\n        Tactic = \"Privilege Escalation\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access and privilege escalation. The query below generates an output of all administator users performing an interactive logon (4624:2) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousPasswordReset = BehaviorAnalytics\r\n    | where ActionType == \"Reset user password\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == \"True\"\r\n    | join (\r\n        AuditLogs\r\n        | where OperationName == \"Reset user password\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Password Reset\",\r\n        Tactic = \"Impact\",\r\n        Technique = \"Account Access Removal\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts. LockerGoga, for example, has been observed changing account passwords and logging off current users. The query below generates an output of all users performing Reset user password for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalousGeoLocationLogon = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where ActivityInsights.FirstTimeUserConnectedFromCountry == True and (ActivityInsights.FirstTimeConnectionFromCountryObservedInTenant == True or ActivityInsights.CountryUncommonlyConnectedFromAmongPeers == True)\r\n    | join (\r\n        SigninLogs\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Initial Access\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access. The query below generates an output of successful Sign-in performed by a user from a new geo location he has never connected from before, and none of his peers as well.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousFailedLogon = BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\"\r\n    | where UsersInsights.BlastRadius == \"High\"\r\n    | join (\r\n        SigninLogs  \r\n        | where Status.errorCode == 50126\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Failed Logon\",\r\n        Tactic = \"Credential Access\",\r\n        Technique = \"Brute Force\",\r\n        SubTechnique = \"Password Guessing\",\r\n        Description = \"Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Emotet, for example, has been observed using a hard coded list of passwords to brute force user accounts. The query below generates an output of all users with 'High' BlastRadius that perform failed Sign-in:Invalid username or password.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousAADAccountManipulation = AuditLogs\r\n    | where OperationName == \"Update user\"\r\n    | mv-expand AdditionalDetails\r\n    | where AdditionalDetails.key == \"UserPrincipalName\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner ( \r\n        BehaviorAnalytics\r\n        | where ActionType == \"Update user\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName) \r\n    | extend AnomalyName = \"Anomalous Account Manipulation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access. The query below generates an output of all high Blast Radius users performing 'Update user' (name change) to priveleged role, or ones that changed users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let AnomalousAADAccountCreation = BehaviorAnalytics\r\n    | where ActionType == \"Add user\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == True or ActivityInsights.FirstTimeActionPerformedInTenant == True or ActivityInsights.ActionUncommonlyPerformedAmongPeers == true\r\n    | join(\r\n        AuditLogs\r\n        | where OperationName == \"Add user\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend DisplayName = tostring(UsersInsights.AccountDisplayName),\r\n        UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Account Creation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Create Account\",\r\n        SubTechnique = \"Cloud Account\",\r\n        Description = \"Adversaries may create a cloud account to maintain access to victim systems. With a sufficient level of access, such accounts may be used to establish secondary credentialed access that does not require persistent remote access tools to be deployed on the system. The query below generates an output of all the users performing user creation for the first time and the target users that were created.\"\t\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalyTable = union kind=outer AnomalousSigninActivity, AnomalousRoleAssignment, AnomalousResourceAccess, AnomalousRDPActivity, AnomalousPasswordReset, AnomalousLogintoDevices, AnomalousGeoLocationLogon, AnomalousAADAccountManipulation, AnomalousAADAccountCreation, AnomalousFailedLogon;\r\nlet TopUsersByAnomalies = AnomalyTable\r\n    | summarize hint.strategy = shuffle AnomalyCount=count() by UserName, UserPrincipalName, tostring(UsersInsights.OnPremSid), tostring(UsersInsights.AccountObjectId)\r\n    | project Name=tolower(UserName), UPN=tolower(UserPrincipalName), AadUserId=UsersInsights_AccountObjectId, Sid=UsersInsights_OnPremSid, AnomalyCount\r\n    | sort by AnomalyCount desc;\r\nlet TopUsersByIncidents = SecurityIncident\r\n    | summarize hint.strategy = shuffle arg_max(LastModifiedTime, *) by IncidentNumber\r\n    | where Status == \"New\" or Status == \"Active\"\r\n    | mv-expand AlertIds\r\n    | extend AlertId = tostring(AlertIds)\r\n    | join kind= innerunique ( \r\n        SecurityAlert \r\n        )\r\n        on $left.AlertId == $right.SystemAlertId\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n    | union TopUsersByAnomalies\r\n    | extend \r\n        AadPivot = iff(isempty(AadUserId), iff(isempty(Sid), Name, Sid), AadUserId),\r\n        SidPivot = iff(isempty(Sid), iff(isempty(AadUserId), Name, AadUserId), Sid),\r\n        UPNExists = iff(isempty(UPN), false, true),\r\n        NameExists = iff(isempty(Name), false, true),\r\n        SidExists = iff(isempty(Sid), false, true),\r\n        AADExists = iff(isempty(AadUserId), false, true)\r\n    | summarize hint.strategy = shuffle IncidentCount=dcount(IncidentNumber, 4), AlertCount=dcountif(AlertId, isnotempty(AlertId), 4), AnomalyCount=sum(AnomalyCount), any(Title, Severity, Status, StartTime, IncidentNumber, IncidentUrl, Owner), UPNAnchor=anyif(UPN, UPNExists == true), NameAnchor=anyif(Name, NameExists == true), AadAnchor=anyif(AadUserId, AADExists == true), SidAnchor=anyif(Sid, SidExists == true), any(SidPivot) by AadPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), NameAnchor=anyif(NameAnchor, isempty(NameAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_Title, any_Severity, any_StartTime, any_IncidentNumber, any_IncidentUrl) by any_SidPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_any_Title, any_any_Severity, any_any_StartTime, any_any_IncidentNumber, any_any_IncidentUrl) by NameAnchor\r\n    | project [\"UserName\"]=NameAnchor, IncidentCount, AlertCount, AnomalyCount, [\"AadUserId\"]=AadAnchor, [\"OnPremSid\"]=SidAnchor, [\"UserPrincipalName\"]=UPNAnchor;\r\nTopUsersByIncidents\r\n| where UserPrincipalName <> \"\"\r\n| where UserPrincipalName !contains \"[\"\r\n| project UserPrincipalName, IncidentCount, AlertCount, AnomalyCount\r\n| sort by AlertCount desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ User Entity Behavior Analytics Alerts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "AlertCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        },
                        {
                          "columnMatch": "AnomalyCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellow"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_AlertCount_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_AlertCount_2",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SigninStatus",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    },
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blueDark"
                          }
                        ]
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where ProviderName == \"IPC\"\r\n| extend UserAccount = tostring(parse_json(ExtendedProperties).[\"User Account\"])\r\n| summarize count() by AlertName, AlertLink, ProductName, UserAccount\r\n| extend Count = count_\r\n| project AlertName, Count\r\n| sort by Count desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ AAD Identity Protection: Security Alerts ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let AnomalySignIns = BehaviorAnalytics\r\n| extend FirstTimeDeviceLogon = tostring(ActivityInsights.FirstTimeUserLoggedOnToDevice)\r\n| extend FirstTimeUserAction = tostring(ActivityInsights.FirstTimeUserPerformedAction)\r\n| extend UncommonAction = tostring(ActivityInsights.ActionUncommonlyPerformedByUser)\r\n| extend UncommonVolumeOfActions = tostring(ActivityInsights.UncommonHighVolumeOfActions)\r\n| where FirstTimeDeviceLogon == \"True\" or FirstTimeUserAction == \"True\" or UncommonAction == \"True\" or UncommonVolumeOfActions == \"True\";\r\nAnomalySignIns | join (SigninLogs) on UserPrincipalName",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "üîÄ Anomalous Activity by Geolocation",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "map",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "UncommonActionVolume",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "UncommonAction",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "green"
                          }
                        },
                        {
                          "columnMatch": "FirstTimeUserAction",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "FirstTimeDeviceLogon",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellow"
                          }
                        },
                        {
                          "columnMatch": "IncidentCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "AlertCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        },
                        {
                          "columnMatch": "AnomalyCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellow"
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SigninStatus",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    },
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "latitude_",
                      "longitude": "longitude_",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "labelSettings": "city_",
                      "legendMetric": "Location",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "Location",
                        "colorAggregation": "Count",
                        "type": "thresholds",
                        "thresholdsGrid": [
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "redBright"
                          }
                        ]
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "Results46"
                }
              ]
            },
            "name": "LT-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-3: Enable Logging for Azure Network Activities](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-3-enable-logging-for-azure-network-activities)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/) ‚ú≥Ô∏è [Application Gateway]( https://azure.microsoft.com/services/application-gateway/)<br>\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n### Hardening\r\nüü¶ [How to Enable Network Security Group Flow Logs](https://docs.microsoft.com/azure/network-watcher/network-watcher-nsg-flow-logging-portal)<br>\r\nüü¶ [Azure Firewall Logs and Metrics](https://docs.microsoft.com/azure/firewall/logs-and-metrics)<br>\r\nüü¶ [How to Enable and Use Traffic Analytics](https://docs.microsoft.com/azure/network-watcher/traffic-analytics)<br>\r\nüü¶ [Monitoring with Network Watcher](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview)<br>\r\nüü¶ [Azure Networking Monitoring Solutions in Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/azure-networking-analytics)<br>\r\nüü¶ [Gather Insights About Your DNS Infrastructure With the DNS Analytics Solution](https://docs.microsoft.com/azure/azure-monitor/insights/dns-analytics)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FazureFirewalls) <br>\r\nüîÄ [Azure Web Application Firewall](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies) <br>\r\nüîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br>\r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br>\r\nüîÄ [Azure Resource Graph Explorer](https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[9.3, 12.2, 12.5, 12.8](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-6, AU-12, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"LT.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (LT-3)",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"LT.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (LT-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type contains \"microsoft.network\"\r\n| project id,type,resourceGroup\r\n| order by type asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Networking Assets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where OperationName == \"NetworkSecurityGroupEvents\"\r\n| summarize count() by ruleName_s\r\n| sort by count_ desc \r\n| render piechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Network Security Groups: Rules Triggered",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where Category contains \"AzureFirewall\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by¬†OperationName\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Firewall + Azure WAF Actions over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 6"
                }
              ]
            },
            "name": "LT-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-4: Enable Logging for Azure Resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-4-enable-logging-for-azure-resources)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Understand Logging and Different Log Types in Azure](https://docs.microsoft.com/azure/azure-monitor/essentials/platform-logs-overview)<br>\r\nüü¶ [Understand Azure Security Center Data Collection](https://docs.microsoft.com/azure/security-center/security-center-enable-data-collection)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[6.2, 6.3, 8.8](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-12](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"LT.4\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "showQuery": true,
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (LT-4)",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"LT.4\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (LT-4) ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = Table_Name *\r\n| project-rename Log_Tables=Table_Name\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Log_Tables\r\n| render areachart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Logs by Type over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = Table_Name *\r\n| summarize count() by Table_Name\r\n| project-rename Log_Tables=Table_Name, Logs_Count=count_\r\n| sort by Logs_Count desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Logs Count by Data Table",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "LT-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-5: Centralize Security Log Management and Analysis](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-5-centralize-security-log-management-and-analysis)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Hardening\r\nüü¶ [How to Collect Platform Logs and Metrics with Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/essentials/diagnostic-settings)<br>\r\nüü¶ [How to Onboard Azure Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[6.5, 6.6](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, SI-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"LT.5\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (LT-5) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"LT.5\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (LT-5) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": ""
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=_TableName *\r\n| summarize Entries = count(), Size = sum(_BilledSize), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by _TableName, _IsBillable\r\n| project ['Table Name'] = _TableName, ['Table Size'] = Size, ['Table Entries'] = Entries,\r\n          ['Size per Entry'] = 1.0 * Size / Entries, ['IsBillable'] = _IsBillable\r\n| order by ['Table Size']  desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Log Table Management",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "turquoise"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Important",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_IsBillable_4",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_IsBillable_4",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DataType",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=_TableName *\r\n| summarize count() , Size = sum(_BilledSize) by bin(_TimeReceived, 1m), Type, _IsBillable\r\n| extend counttemp =count_ / 60\r\n| summarize \r\n           ['Current EPS Average']=avg(counttemp), ['Minimum EPS']=min(counttemp),\r\n           ['Maximum EPS']=max(counttemp)\r\n  by ['Table Name']=Type\r\n| order  by ['Current EPS Average'] desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Log Table Events Per Second (EPS) Management",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Name",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Current EPS Average",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blueDark"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "Minimum EPS",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "red"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "Maximum EPS",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "turquoise"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Important",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Current EPS Average_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Current EPS Average_1",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DataType",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Workspace Name']=id, ['Resource Group']=resourceGroup, location",
                    "size": 2,
                    "showAnalytics": true,
                    "title": "üîÄ Log Analytics Workspaces",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 16,
                          "formatOptions": {
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_link_Workspace Name_0",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_link_Workspace Name_0",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where ProductName == \"Azure Sentinel\"\r\n| extend UserAccount = tostring(parse_json(ExtendedProperties).[\"User Account\"])\r\n| summarize count() by AlertName, AlertLink, ProductName, UserAccount\r\n| extend Count = count_\r\n| project AlertName, Count\r\n| sort by Count desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Sentinel: Security Alerts Count",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Sentinel: Security Alerts ",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "LT-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-6: Configure Log Storage Retention](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-6-configure-log-storage-retention)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/)<br>\r\n\r\n### Hardening\r\nüü¶ [Change the Data Retention Period in Log Analytics](https://docs.microsoft.com/azure/azure-monitor/logs/manage-cost-storage#change-the-data-retention-period)<br>\r\nüü¶ [How to Configure Retention Policy for Azure Storage Account Logs](https://docs.microsoft.com/azure/storage/common/manage-storage-analytics-logs#configure-logging)<br>\r\nüü¶ [Azure Security Center Alerts and Recommendations Export](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[6.4](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-3, AU-11](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"LT.6\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (LT-6) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"LT.6\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (LT-6) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Workspace Name']=id, ['Data Retention(days)']=retentionDays, ['Daily Data Cap']=dailyquotaGB, ['Resource Group']=resourceGroup, location, ['License']=sku",
                    "size": 2,
                    "showAnalytics": true,
                    "title": "üîÄ Log Retention Configurations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 16,
                          "formatOptions": {
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_link_Workspace Name_0",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_link_Workspace Name_0",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "type",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                }
              ]
            },
            "name": "LT-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [LT-7: Use Approved Time Synchronization Sources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection#lt-7-use-approved-time-synchronization-sources)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [VMConnection](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmconnection) ‚ú≥Ô∏è [Service Map](https://docs.microsoft.com/azure/azure-monitor/vm/service-map) <br> \r\n\r\n### Hardening\r\nüü¶ [How to Configure Time Synchronization for Azure Windows Compute Resources](https://docs.microsoft.com/azure/virtual-machines/windows/time-sync)<br>\r\nüü¶ [How to Configure Time Synchronization for Azure Linux Compute Resources](https://docs.microsoft.com/azure/virtual-machines/linux/time-sync)<br>\r\nüü¶ [How to Disable Inbound UDP for Azure Services](https://support.microsoft.com/help/4558520/how-to-disable-inbound-udp-for-azure-services)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure AD Domain Services](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.AAD%2FdomainServices) <br>\r\nüîÄ [Virtual Machines](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FVirtualMachines) <br>\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[6.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AU-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "LT-7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMConnection\r\n| where Direction == \"outbound\"\r\n| where Protocol == \"udp\"\r\n| where DestinationPort == \"123\"\r\n| extend NTPDestination = tostring(parse_json(RemoteDnsQuestions)[0])\r\n| where NTPDestination <> \"\"\r\n| summarize count() by NTPDestination\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Network Time Protocol Calls (LT-7) ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMConnection\r\n| where Direction == \"outbound\"\r\n| where Protocol == \"udp\"\r\n| where DestinationPort == \"123\"\r\n| where RemoteCountry <> \"\"\r\n| extend NTPDestination = tostring(parse_json(RemoteDnsQuestions)[0])\r\n| where NTPDestination <> \"\"\r\n",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "üîÄ Network Time Protocol Calls by Remote Country",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "map",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    },
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "RemoteCountry",
                      "latitude": "RemoteLatitude",
                      "longitude": "RemoteLongitude",
                      "sizeSettings": "DestinationPort",
                      "sizeAggregation": "Sum",
                      "labelSettings": "RemoteCountry",
                      "legendMetric": "DestinationPort",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "DestinationPort",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "blueOrange"
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isLTVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "LT-7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isLTVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Logging & Threat Detection Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Incident Response (IR)\r\n---\r\nIncident Response covers controls in incident response life cycle - preparation, detection and analysis, containment, and post-incident activities, including using Azure services such as Azure Security Center and Sentinel to automate the incident response process. For more information, see üí°[Incident Response](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response)"
            },
            "customWidth": "49",
            "name": "IR Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 9"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "IR-1",
                  "linkTarget": "step",
                  "linkLabel": "IR-1: Preparation ‚Äì Update Incident Response Process for Azure",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "IR-2",
                  "linkTarget": "step",
                  "linkLabel": "IR-2: Preparation ‚Äì Setup Incident Notification",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "IR-3",
                  "linkTarget": "step",
                  "linkLabel": "IR-3: Detection & Analysis ‚Äì Create Incidents Based on High Quality Alerts",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "IR-4",
                  "linkTarget": "step",
                  "linkLabel": "IR-4: Detection & Analysis ‚Äì Investigate Incidents",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "IR-5",
                  "linkTarget": "step",
                  "linkLabel": "IR-5: Detection & Analysis ‚Äì Prioritize Incidents",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                  "cellValue": "IR-6",
                  "linkTarget": "step",
                  "linkLabel": "IR-6: Containment, Eradication & Recovery ‚Äì Automate Incident Handling",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "IR Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|IR-1: Preparation ‚Äì Update Incident Response Process for Azure|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/)|\r\n|IR-2: Preparation ‚Äì Setup Incident Notification|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Logic Apps](https://azure.microsoft.com/services/logic-apps/) |\r\n|IR-3: Detection and Analysis ‚Äì Create Incidents Based on High Quality Alerts|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) |\r\n|IR-4: Detection and Analysis ‚Äì Investigate an Incident|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) |\r\n|IR-5: Detection and Analysis ‚Äì Prioritize Incidents|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)|\r\n|IR-6: Containment, Eradication and Recovery ‚Äì Automate the Incident Handling|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Logic Apps](https://azure.microsoft.com/services/logic-apps/)  |"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "IR Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [IR-1: Preparation ‚Äì Update Incident Response Process for Azure](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response#ir-1-preparation--update-incident-response-process-for-azure)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Hardening\r\nüü¶ [Implement Security Across the Enterprise Environment](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#3-process-assign-accountability-for-cloud-security-decisions)<br>\r\nüü¶ [Incident Response Reference Guide](https://docs.microsoft.com/microsoft-365/downloads/IR-Reference-Guide.pdf)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[19](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IR-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Building Your Own Security Incident Response Process](https://msrc-blog.microsoft.com/2019/07/01/inside-the-msrc-building-your-own-security-incident-response-process/) \r\n![Image Name](https://msrc-blog.microsoft.com/wp-content/uploads/2019/01/sdf.jpg)\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 5"
                }
              ]
            },
            "name": "IR-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [IR-2: Preparation ‚Äì Setup Incident Notification](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response#ir-2-preparation--setup-incident-notification)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Hardening\r\nüü¶ [How to Set the Azure Security Center Security Contact](https://docs.microsoft.com/azure/security-center/security-center-provide-security-contact-details)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Logic%2Fworkflows) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[19.5](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-5, IR-6, IR-8](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IR-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IR.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (IR-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IR.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (IR-2) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Tutorial: Use Playbooks with Automation Rules in Azure Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook) \r\n![Image Name](https://techcommunity.microsoft.com/t5/image/serverpage/image-id/241289i78ECB69136070124/image-size/medium?v=v2&px=400)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n|¬†where¬†type¬†==¬†\"microsoft.logic/workflows\"\r\n|¬†extend¬†Connection¬†=¬†parse_json(properties)[\"parameters\"][\"$connections\"][\"value\"]\r\n|¬†where¬†Connection¬†has¬†\"managedApis/azuresentinel\"\r\n| where id contains \"push\" or id contains \"send\" or id contains \"message\" or id contains \"text\" or id contains \"email\" or id contains \"notif\" or id contains \"team\" or id contains \"post\"\r\n| project id, type, resourceGroup",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Sentinel (SOAR) Notification Playbooks Configured",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "IR-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [IR-3: Detection and Analysis ‚Äì Create Incidents Based on High Quality Alerts](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response#ir-3-detection-and-analysis--create-incidents-based-on-high-quality-alerts)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Hardening\r\nüü¶ [How to Configure Export](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\nüü¶ [How to Stream Alerts Into Azure Sentinel](https://docs.microsoft.com/azure/sentinel/connect-azure-security-center)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[19.6](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IR-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IR.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (IR-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IR.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (IR-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n    | summarize hint.strategy = shuffle arg_max(LastModifiedTime, *) by IncidentNumber\r\n    | mv-expand AlertIds\r\n    | extend AlertId = tostring(AlertIds)\r\n    | join kind= innerunique ( \r\n        SecurityAlert \r\n)\r\n        on $left.AlertId == $right.SystemAlertId\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n| extend Href_ = tostring(parse_json(ExtendedLinks)[0].Href)\r\n| where UPN <> \"\"\r\n| extend Workspace = tostring(parse_json(tostring(parse_json(ExtendedProperties).[\"Data Sources\"]))[0])\r\n| extend IncidentURL = strcat(\"https://portal.azure.com/#asset/Microsoft_Azure_Security_Insights/Incident/subscriptions/\",WorkspaceSubscriptionId,\"/resourceGroups/\",WorkspaceResourceGroup,\"/providers/Microsoft.OperationalInsights/workspaces/\",Workspace,\"/providers/Microsoft.SecurityInsights/Incidents/\",IncidentName)\r\n| where IncidentURL !contains \"//resourceGroups\"\r\n| distinct Title, IncidentNumber, IncidentURL, Severity, Status, ProductName, ModifiedBy, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Security Incidents",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Title",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ProductName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "IncidentURL",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Incident >"
                          }
                        },
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Incident >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                }
              ]
            },
            "name": "IR-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [IR-4: Detection and Analysis ‚Äì Investigate an Incident](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response#ir-4-detection-and-analysis--investigate-an-incident)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Hardening\r\nüü¶ [Snapshot a Windows Machine's Disk](https://docs.microsoft.com/azure/virtual-machines/windows/snapshot-copy-managed-disk)<br>\r\nüü¶ [Snapshot a Linux Machine's Disk](https://docs.microsoft.com/azure/virtual-machines/linux/snapshot-copy-managed-disk)<br>\r\nüü¶ [Microsoft Azure Support Diagnostic Information and Memory Dump Collection](https://azure.microsoft.com/support/legal/support-diagnostic-information-collection/)<br>\r\nüü¶ [Investigate Incidents with Azure Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-investigate-cases)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[19](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IR-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| summarize count() by AlertName, ProductName\r\n| sort by count_ desc\r\n| limit 250\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Detected Attack Techniques",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ProductName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": ""
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where Tactics <> \"Unknown\"\r\n| summarize count() by Tactics\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ MITRE ATT&CK Tactics Observed",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ProductName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Investigate Incidents with Azure Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-investigate-cases) \r\n![Image Name](https://docs.microsoft.com/azure/sentinel/media/tutorial-investigate-cases/investigation-map.png)\r\n\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 5"
                }
              ]
            },
            "name": "IR-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [IR-5: Detection and Analysis ‚Äì Prioritize Incidents](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response#ir-5-detection-and-analysis--prioritize-incidents)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br>\r\nüî∑ [SecurityIncident](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityincident) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Hardening\r\nüü¶ [Security Alerts in Azure Security Center](https://docs.microsoft.com/azure/security-center/security-center-alerts-overview)<br>\r\nüü¶ [Use Tags to Organize Your Azure Resources](https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) \r\n\r\n### CIS Controls v7.1 IDs\r\n[19.8](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CA-2, IR-4](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IR-5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"IR.5\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (IR-5) over Time",
                    "noDataMessage": "Confirm ASC SecurityRecommendation Logging is Enabled and/or Extend Time Thresholds for a Larger Data-Set.",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"IR.5\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (IR-5) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Severity\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Security Incident Priorities over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Low",
                          "color": "yellow"
                        },
                        {
                          "seriesName": "Medium",
                          "color": "orange"
                        },
                        {
                          "seriesName": "High",
                          "color": "red"
                        },
                        {
                          "seriesName": "Informational",
                          "color": "gray"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Security Incident Priorities over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| where Status <> \"Closed\"\r\n| summarize count() by Severity\r\n| render barchart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Open Incidents by Priority",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Low",
                          "color": "yellow"
                        },
                        {
                          "seriesName": "Medium",
                          "color": "orange"
                        },
                        {
                          "seriesName": "High",
                          "color": "red"
                        },
                        {
                          "seriesName": "Informational",
                          "color": "gray"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üîÄ Open Incidents by Priority",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "IR-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [IR-6: Containment, Eradication and Recovery ‚Äì Automate Incident Handling](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response#ir-6-containment-eradication-and-recovery--automate-the-incident-handling)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> üî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Hardening\r\nüü¶ [Configure Workflow Automation in Security Center](https://docs.microsoft.com/azure/security-center/workflow-automation)<br>\r\nüü¶ [Setup Automated Threat Responses in Azure Security Center](https://docs.microsoft.com/azure/security-center/tutorial-security-incident#triage-security-alerts)<br>\r\nüü¶ [Setup Automated Threat Responses in Azure Sentinel](https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Logic Apps](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Logic%2Fworkflows) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[19](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IR-4, IR-5, IR-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "IR-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n|¬†where¬†type¬†==¬†\"microsoft.logic/workflows\"\r\n|¬†extend¬†Connection¬†=¬†parse_json(properties)[\"parameters\"][\"$connections\"][\"value\"]\r\n|¬†where¬†Connection¬†has¬†\"managedApis/azuresentinel\"\r\n| project id, type, resourceGroup",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Sentinel (SOAR) Playbooks Configured",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. ",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where ResourceProvider == \"Microsoft.Logic\"\r\n| summarize count() by Resource\r\n| sort by count_ desc \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Sentinel (SOAR) Playbooks Triggered",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Resource",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isIRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "IR-6",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isIRVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Incident Response Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Posture and Vulnerability Management (PV)\r\n---\r\nPosture and Vulnerability Management focuses on controls for assessing and improving Azure security posture, including vulnerability scanning, penetration testing and remediation, as well as security configuration tracking, reporting, and correction in Azure resources. For more information, see üí°[Posture and Vulnerability Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management) "
            },
            "customWidth": "49",
            "name": "PV Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 11"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "PV-1",
                  "linkTarget": "step",
                  "linkLabel": "PV-1: Establish Secure Configurations for Azure Services",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "PV-2",
                  "linkTarget": "step",
                  "linkLabel": "PV-2: Sustain Secure Configurations for Azure Services",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "PV-3",
                  "linkTarget": "step",
                  "linkLabel": "PV-3: Establish Secure Configurations for Compute Resources",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "PV-4",
                  "linkTarget": "step",
                  "linkLabel": "PV-4: Sustain Secure Configurations for Compute Resources",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "PV-5",
                  "linkTarget": "step",
                  "linkLabel": "PV-5: Securely Store Custom Operating System and Container Images",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "b929cd42-7271-4993-b920-17c8cd03f04a",
                  "cellValue": "PV-6",
                  "linkTarget": "step",
                  "linkLabel": "PV-6: Perform Software Vulnerability Assessments",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "908e66bd-613c-4dbc-ab88-2f9f09403916",
                  "cellValue": "PV-7",
                  "linkTarget": "step",
                  "linkLabel": "PV-7: Rapidly and Automatically Remediate Software Vulnerabilities",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "8014e5ef-73b7-4ce1-8f07-24f847cc07bd",
                  "cellValue": "PV-8",
                  "linkTarget": "step",
                  "linkLabel": "PV-8: Conduct Regular Attack Simulation",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "PV Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|PV-1: Establish Secure Configurations for Azure Services| ‚ú≥Ô∏è [Azure Policy](https://azure.microsoft.com/services/azure-policy/) ‚ú≥Ô∏è [Azure Blueprints]( https://azure.microsoft.com/services/blueprints/)|\r\n|PV-2: Sustain Secure Configurations for Azure Services| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)|\r\n|PV-3: Establish Secure Configurations for Compute Resources|‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Automation]( https://azure.microsoft.com/services/automation/)|\r\n|PV-4: Sustain Secure Configurations for Compute Resources| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)|\r\n|PV-5: Securely Store Custom Operating System and Container Images|‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) ‚ú≥Ô∏è [Azure VM Image Builder](https://azure.microsoft.com/services/image-builder/)|\r\n|PV-6: Perform Software Vulnerability Assessments| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)|\r\n|PV-7: Rapidly and Automatically Remediate Software Vulnerabilities| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Automation](https://azure.microsoft.com/services/automation/)|\r\n|PV-8: Conduct Regular Attack Simulation|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Microsoft 365 Compliance Manager]( https://www.microsoft.com/security/business/compliance/compliance-management)|"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "PV Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-1: Establish Secure Configurations for Azure Services](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-1-establish-secure-configurations-for-azure-services)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Illustration of Guardrails Implementation in Enterprise-Scale Landing Zone](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/architecture#landing-zone-expanded-definition)<br>\r\nüü¶ [Working with Security Policies in Azure Security Center](https://docs.microsoft.com/azure/security-center/tutorial-security-policy)<br>\r\nüü¶ [Create and Manage Policies to Enforce Compliance](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\nüü¶ [Azure Blueprints](https://docs.microsoft.com/azure/governance/blueprints/overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Blueprints](https://portal.azure.com/#blade/Microsoft_Azure_Policy/BlueprintsMenuBlade/GetStarted)<br>\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[5.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| summarize count() by ComplianceStandard\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Regulatory Compliance Assessments by Standard",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 1"
                }
              ]
            },
            "name": "PV-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-2: Sustain Secure Configurations for Azure Services](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-2-sustain-secure-configurations-for-azure-services)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Understand Azure Policy Effects](https://docs.microsoft.com/azure/governance/policy/concepts/effects)<br>\r\nüü¶ [Create and Manage Policies to Enforce Compliance](https://docs.microsoft.com/azure/governance/policy/tutorials/create-and-manage)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[5.2](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PV.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PV-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PV.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PV-2) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": ""
                }
              ]
            },
            "name": "PV-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-3: Establish Secure Configurations For Compute Resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-3-establish-secure-configurations-for-compute-resources)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Monitor Azure Security Center Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br>\r\nüü¶ [Security Recommendations - A Reference Guide](https://docs.microsoft.com/azure/security-center/recommendations-reference)<br>\r\nüü¶ [Azure Automation State Configuration Overview](https://docs.microsoft.com/azure/automation/automation-dsc-overview)<br>\r\nüü¶ [Upload a VHD and Use it to Create New Windows VMs in Azure](https://docs.microsoft.com/azure/virtual-machines/windows/upload-generalized-managed)<br>\r\nüü¶ [Create a Linux VM from a Custom Disk with the Azure CLI](https://docs.microsoft.com/azure/virtual-machines/linux/upload-vhd)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[5.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PV.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PV-3) ",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PV.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PV-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": ""
                }
              ]
            },
            "name": "PV-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-4: Sustain Secure Configurations for Compute Resources](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-4-sustain-secure-configurations-for-compute-resources)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Implement Azure Security Center Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüü¶ [How to Create an Azure Virtual Machine from an ARM Template](https://docs.microsoft.com/azure/virtual-machines/windows/ps-template)<br>\r\nüü¶ [Azure Automation State Configuration Overview](https://docs.microsoft.com/azure/automation/automation-dsc-overview)<br>\r\nüü¶ [Create a Windows Virtual Machine in the Azure portal](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal)<br>\r\nüü¶ [Information on How to Download Template for a VM](https://docs.microsoft.com/previous-versions/azure/virtual-machines/windows/download-template)<br>\r\nüü¶ [Sample Script to Upload a VHD to Azure and Create a New VM](https://docs.microsoft.com/previous-versions/azure/virtual-machines/scripts/virtual-machines-windows-powershell-upload-generalized-script)<br>\r\nüü¶ [Container Security in Azure Security Center](https://docs.microsoft.com/azure/security-center/container-security)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[5.2](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PV.4\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PV-4) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PV.4\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PV-4) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "PV-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-5: Securely Store Custom Operating System and Container Images](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-5-securely-store-custom-operating-system-and-container-images)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Hardening\r\nüü¶ [Understand Azure RBAC]()<br>\r\nüü¶ [Understand Azure RBAC for Container Registry]()<br>\r\nüü¶ [How to Configure Azure RBAC]()<br>\r\nüü¶ [Shared Image Gallery Overview]()<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>\r\nüîÄ [Shared Image Galleries](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2Fgalleries)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[5.3](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CM-2, CM-6](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| extend Caller = tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)\r\n| where Caller <> \"\"\r\n| summarize count() by Caller, OperationName\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Audit User Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.  ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Person",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Audit User Actions",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Shared Image Galleries Overview](https://docs.microsoft.com/azure/virtual-machines/shared-image-galleries#generalized-and-specialized-images)\r\n![Image¬†Name](https://docs.microsoft.com/azure/virtual-machines/media/shared-image-galleries/replication.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "name": "PV-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-6: Perform Software Vulnerability Assessments](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessments)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityNestedRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Implement Azure Security Center Vulnerability Assessment Recommendations](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüü¶ [Integrated Vulnerability Scanner for Virtual Machines](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüü¶ [Exporting Azure Security Center Vulnerability Scan Results](https://docs.microsoft.com/azure/security-center/continuous-export)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[3.1, 3.2, 3.3, 3.6](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CA-2, RA-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PV.6\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PV-6) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (PV-6) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PV.6\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PV-6) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation\r\n| where RecommendationState == \"Unhealthy\"\r\n| summarize count() by RecommendationName, RecommendationSeverity\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Patches, Updates & Vulnerabilities",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Hardening. Controls: Confirm Licensing, Availability, and Health of Respective Offerings. Logging: Confirm Log Source is Onboarded to the Log Analytics Workspace. Time: Adjust the Time Parameter for a Larger Data-Set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Gear",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Link_",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url"
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                }
              ]
            },
            "name": "PV-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-7: Rapidly and Automatically Remediate Software Vulnerabilities]()\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Configure Update Management for Virtual Machines in Azure](https://docs.microsoft.com/azure/automation/update-management/overview)<br>\r\nüü¶ [Manage Updates and Patches for Your Azure VMs](https://docs.microsoft.com/azure/automation/update-management/manage-updates-for-vm)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[3.7](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CA-2, RA-5, SI-2](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"PV.7\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (PV-7) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"PV.7\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (PV-7) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 4"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Azure Update Management Overview](https://docs.microsoft.com/azure/automation/update-management/overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/automation/update-management/media/overview/update-mgmt-updateworkflow.png)¬†\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "name": "PV-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [PV-8: Conduct Regular Attack Simulation](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management#pv-8-conduct-regular-attack-simulation)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Hardening\r\nüü¶ [Penetration Testing in Azure](https://docs.microsoft.com/azure/security/fundamentals/pen-testing)<br>\r\nüü¶ [Penetration Testing Rules of Engagement](https://www.microsoft.com/msrc/pentest-rules-of-engagement?rtc=1)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>\r\nüîÄ [Microsoft 365 Compliance Center](https://compliance.microsoft.com/) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[20](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CA-8, CA-2, RA-5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "PV-8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [SimuLand for Attack Simulation](https://www.microsoft.com/security/blog/2021/05/20/simuland-understand-adversary-tradecraft-and-improve-detection-strategies/)\r\n![Image¬†Name](https://www.microsoft.com/security/blog/wp-content/uploads/2021/05/Map-of-threat-research.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 3 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Attack Simulator in the Security & Compliance Center](https://docs.microsoft.com/azure/automation/update-management/overview)\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/9bd65af4-1f9d-45c1-8c06-796d7ccfd425.jpg?view=o365-worldwide)¬†\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isPVVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "name": "PV-8",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isPVVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Posture & Vulnerability Management"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Endpoint Security (ES)\r\n---\r\nEndpoint Security covers controls in endpoint detection and response, including use of endpoint detection and response (EDR) and anti-malware service for endpoints in Azure environments. For more information, see üí°[Endpoint Security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-endpoint-security) "
            },
            "customWidth": "49",
            "name": "ES Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 6"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "ES-1",
                  "linkTarget": "step",
                  "linkLabel": "ES-1: Use Endpoint Detection and Response (EDR)",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "ES-2",
                  "linkTarget": "step",
                  "linkLabel": "ES-2: Use centrally Managed Modern Anti-Malware Software",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "ES-3",
                  "linkTarget": "step",
                  "linkLabel": "ES-3: Ensure Anti-Malware Software and Signatures are Updated",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "ES Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|ES-1: Use Endpoint Detection and Response (EDR)| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) |\r\n|ES-2: Use Centrally Managed Modern Anti-Malware Software| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)  |\r\n|ES-3: Ensure Anti-Malware Software and Signatures are Updated| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) |"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "ES Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [ES-1: Use Endpoint Detection and Response (EDR)](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-endpoint-security#es-1-use-endpoint-detection-and-response-edr)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Microsoft Defender for Endpoint Overview](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/microsoft-defender-advanced-threat-protection)<br>\r\nüü¶ [Microsoft Defender for Endpoint for Windows Servers](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/configure-server-endpoints)<br>\r\nüü¶ [Microsoft Defender for Endpoint for Non-Windows Servers](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints-non-windows)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v7.1 IDs\r\n[8.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SI-2, SI-3, SC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "ES-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"ES.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (ES-1) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"ES.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (ES-1) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "ES-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [ES-2: Use Centrally Managed Modern Anti-Malware Software](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-endpoint-security#es-2-use-centrally-managed-modern-anti-malware-software)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Configure Microsoft Antimalware for Cloud Services and Virtual Machines](https://docs.microsoft.com/azure/security/fundamentals/antimalware)<br>\r\nüü¶ [Supported Endpoint Protection Solutions](https://docs.microsoft.com/azure/security-center/security-center-services?tabs=features-windows#supported-endpoint-protection-solutions-)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v7.1 IDs\r\n[8.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SI-2, SI-3, SC-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "ES-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"ES.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (ES-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"ES.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (ES-2) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "ES-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [ES-3: Ensure Anti-Malware Software and Signatures are Updated](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-endpoint-security#es-3-ensure-anti-malware-software-and-signatures-are-updated)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Deploy Microsoft Antimalware for Azure Cloud Services and Virtual Machines](https://docs.microsoft.com/azure/security/fundamentals/antimalware)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\n\r\n### CIS Controls v7.1 IDs\r\n[8.2](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SI-2, SI-3](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "ES-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"ES.3\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (ES-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"ES.3\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (ES-3) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "isESVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "ES-3",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isESVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Endpoint Security Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Backup and Recovery (BR)\r\n---\r\nBackup and Recovery covers controls to ensure that data and configuration backups at the different service tiers are performed, validated, and protected. For more information, see üí°[Backup and Recovery](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-backup-recovery) "
            },
            "customWidth": "49",
            "name": "BR Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 7"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "BR-1",
                  "linkTarget": "step",
                  "linkLabel": "BR-1: Ensure Regular Automated Backups",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "BR-2",
                  "linkTarget": "step",
                  "linkLabel": "BR-2: Encrypt Backup Data",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "BR-3",
                  "linkTarget": "step",
                  "linkLabel": "BR-3: Validate All Backups Including Customer-Managed Keys",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "BR-4",
                  "linkTarget": "step",
                  "linkLabel": "BR-4: Mitigate Risk of Lost Keys",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "BR Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Controls </strong> | \r\n|:--|:--|\r\n|BR-1: Ensure Regular Automated Backups| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)|\r\n|BR-2: Encrypt Backup Data|‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)|\r\n|BR-3: Validate All Backups Including Customer-Managed Keys| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/) ‚ú≥Ô∏è [Key Vault](https://azure.microsoft.com/services/key-vault/) |\r\n|BR-4: Mitigate Risk of Lost Keys| ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/) ‚ú≥Ô∏è [Key Vault](https://azure.microsoft.com/services/key-vault/) |"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "BR Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [BR-1: Ensure Regular Automated Backups](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-backup-recovery#br-1-ensure-regular-automated-backups)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Enterprise-Scale Business Continuity and Disaster Recovery](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/business-continuity-and-disaster-recovery)<br>\r\nüü¶ [How to Enable Azure Backup](https://docs.microsoft.com/azure/backup/index.yml)<br>\r\nüü¶ [How to Enable Cross Region Restore](https://docs.microsoft.com/azure/backup/backup-azure-arm-restore-vms#cross-region-restore)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) \r\n\r\n### CIS Controls v7.1 IDs\r\n[10.1](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CP-2, CP4, CP-6, CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "BR-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"BR.1\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (BR-1) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"BR.1\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (BR-1) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "BR-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [BR-2: Encrypt Backup Data](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-backup-recovery#br-2-encrypt-backup-data)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [Overview of Security Features in Azure Backup](https://docs.microsoft.com/azure/backup/security-overview)<br>\r\nüü¶ [Encryption of Backup Data Using Customer-Managed Keys](https://docs.microsoft.com/azure/backup/encryption-at-rest-with-cmk)<br>\r\nüü¶ [How to Backup Key Vault Keys in Azure](https://docs.microsoft.com/powershell/module/azurerm.keyvault/backup-azurekeyvaultkey)<br>\r\nüü¶ [Security Features to Help Protect Hybrid Backups From Attacks](https://docs.microsoft.com/azure/backup/backup-azure-security-feature#prevent-attacks)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) \r\n\r\n### CIS Controls v7.1 IDs\r\n[10.2](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "BR-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"BR.2\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (BR-2) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (BR-2) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"BR.2\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (BR-2) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "BR-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [BR-3: Validate All Backups Including Customer-Managed Keys]()\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Recover Files From Azure Virtual Machine Backup](https://docs.microsoft.com/azure/backup/backup-azure-restore-files-from-vm)<br>\r\nüü¶ [How to Restore Key Vault keys in Azure](https://docs.microsoft.com/powershell/module/azurerm.keyvault/restore-azurekeyvaultkey)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br> üîÄ [Key Vaults](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[10.3](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CP-4, CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "BR-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRecommendation\r\n| where RecommendationName contains \"CMK\" \r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (BR-3) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "üü¶ Azure Security Center Recommendations (BR-3) over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "BR-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [BR-4: Mitigate Risk of Lost Keys](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-backup-recovery#br-4-mitigate-risk-of-lost-keys)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityRegulatoryCompliance](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityregulatorycompliance) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Hardening\r\nüü¶ [How to Enable Soft Delete and Purge Protection in Key Vault](https://docs.microsoft.com/azure/storage/blobs/soft-delete-blob-overview?tabs=azure-portal)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0)<br>\r\nüîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>\r\nüîÄ [Key Vaults](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br>\r\n\r\n\r\n### CIS Controls v7.1 IDs\r\n[10.4](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CP-9](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "BR-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRegulatoryCompliance\r\n| where ComplianceStandard == \"Azure-Security-Benchmark\"\r\n| where ComplianceControl == \"BR.4\"\r\n| where State == \"Failed\"\r\n| make-series count() default=0 on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Azure Security Center Recommendations (BR-4) over Time",
                    "noDataMessage": "Confirm ASC SecurityRegulatoryCompliance logging is enabled and/or extend time thresholds for a larger data-set.   ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        },
                        {
                          "columnMatch": "RecommendationClick",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Click to Recommendation"
                          }
                        },
                        {
                          "columnMatch": "RecommendationLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isBRVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId == \"Azure Security Benchmark\"\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where complianceControlId == \"BR.4\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üîÄ Current Azure Security Benchmark Recommendations (BR-4) ",
                    "noDataMessage": "No Current ASB Recommendations in this Area. Confirm the Azure Security Benchmark Assessment is Enabled in Azure Security Center: Regulatory Compliance Blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "BR-4",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isBRVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Backup & Recovery Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Governance and Strategy (GS)\r\n---\r\nGovernance and Strategy provides guidance for ensuring a coherent security strategy and documented governance approach to guide and sustain security assurance, including establishing roles and responsibilities for the different cloud security functions, unified technical strategy, and supporting policies and standards. For more information, see üí°[Governance and Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy) "
            },
            "customWidth": "49",
            "name": "GS Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 11"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "GS-1",
                  "linkTarget": "step",
                  "linkLabel": "GS-1: Define Asset Management and Data Protection Strategy",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "GS-2",
                  "linkTarget": "step",
                  "linkLabel": "GS-2: Define Enterprise Segmentation Strategy",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "GS-3",
                  "linkTarget": "step",
                  "linkLabel": "GS-3: Define Security Posture Management Strategy",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "GS-4",
                  "linkTarget": "step",
                  "linkLabel": "GS-4: Align Organization Roles, Responsibilities, and Accountabilities",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "20f0be95-4d1b-4c87-96e2-b322d79d25e4",
                  "cellValue": "GS-5",
                  "linkTarget": "step",
                  "linkLabel": "GS-5: Define Network Security Strategy",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "93175973-ed48-4186-9c74-2af94419569b",
                  "cellValue": "GS-6",
                  "linkTarget": "step",
                  "linkLabel": "GS-6: Define Identity and Privileged Access Strategy",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "0de2579f-f8f6-4aef-b6bf-dcdc4b5405f0",
                  "cellValue": "GS-7",
                  "linkTarget": "step",
                  "linkLabel": "GS-7: Define Logging and Threat Response Strategy",
                  "preText": "Go to >",
                  "style": "link"
                },
                {
                  "id": "4c4c61d6-7276-4a73-bae4-8c46d3a71d2d",
                  "cellValue": "GS-8",
                  "linkTarget": "step",
                  "linkLabel": "GS-8: Define Backup and Recovery Strategy",
                  "preText": "Go to >",
                  "style": "link"
                }
              ]
            },
            "customWidth": "40",
            "name": "GS Steps"
          },
          {
            "type": 1,
            "content": {
              "json": "## Controls Mapping\r\n| <strong> Azure Security Benchmark </strong> | <strong> Microsoft Resources </strong> | \r\n|:--|:--|\r\n|GS-1: Define Asset Management and Data Protection Strategy|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Information Protection](https://azure.microsoft.com/services/information-protection/)|\r\n|GS-2: Define Enterprise Segmentation Strategy| ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)‚ú≥Ô∏è [Azure ExpressRoute]( https://azure.microsoft.com/services/expressroute/) ‚ú≥Ô∏è [VPN Gateway]( https://azure.microsoft.com/services/vpn-gateway/)  |\r\n|GS-3: Define Security Posture Management Strategy|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender) ‚ú≥Ô∏è [Microsoft 365 Defender](https://www.microsoft.com/microsoft-365/security/microsoft-365-defender) ‚ú≥Ô∏è [Microsoft Defender for Office 365](https://www.microsoft.com/microsoft-365/security/office-365-defender) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security)|\r\n| GS-4: Align Organization Roles, Responsibilities, and Accountabilities| ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|GS-5: Define Network Security Strategy| ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Virtual Network](https://azure.microsoft.com/services/virtual-network/) ‚ú≥Ô∏è [Azure Firewall](https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall](https://azure.microsoft.com/services/web-application-firewall/) |\r\n|GS-6: Define Identity and Privileged Access Strategy| ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)|\r\n|GS-7: Define Logging and Threat Response Strategy|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/)|\r\n|GS-8: Define Backup and Recovery Strategy|‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) ‚ú≥Ô∏è [Azure Backup](https://azure.microsoft.com/services/backup/)  |"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "GS Guide - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-1: Define Asset Management and Data Protection Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy#gs-1-define-asset-management-and-data-protection-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Architecture Recommendation - Storage, Data, and Encryption](https://docs.microsoft.com/azure/architecture/framework/security/storage-data-encryption?bc=%2fsecurity%2fcompass%2fbreadcrumb%2ftoc.json&toc=%2fsecurity%2fcompass%2ftoc.json)<br>\r\nüü¶ [Azure Security Fundamentals - Azure Data Security, Encryption, and Storage](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview)<br>\r\nüü¶ [Cloud Adoption Framework - Azure Data Security and Encryption Best Practices](https://docs.microsoft.com/azure/security/fundamentals/data-encryption-best-practices?bc=%2fazure%2fcloud-adoption-framework%2f_bread%2ftoc.json&toc=%2fazure%2fcloud-adoption-framework%2ftoc.json)<br>\r\nüü¶ [Azure Security Benchmark - Asset Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-asset-management)<br>\r\nüü¶ [Azure Security Benchmark - Data Protection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-data-protection)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[2, 13](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[SC, AC](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS-1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Asset Management and Data Protection Strategy](https://docs.microsoft.com/security/zero-trust/data)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-monitor-remediate-data.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS1",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-1",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-2: Define Enterprise Segmentation Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Guidance on Segmentation Strategy in Azure (Video)](https://docs.microsoft.com/security/compass/microsoft-security-compass-introduction#azure-components-and-reference-model-2151)<br>\r\nüü¶ [Guidance on Segmentation strategy in Azure (Document)](https://docs.microsoft.com/security/compass/governance#enterprise-segmentation-strategy)<br>\r\nüü¶ [Align Network Segmentation with Enterprise Segmentation Strategy](https://docs.microsoft.com/security/compass/network-security-containment#align-network-segmentation-with-enterprise-segmentation-strategy)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[4, 9, 16](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC, CA, SC](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS-2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Segment and Enforce the External Boundaries](https://docs.microsoft.com/security/zero-trust/networks#segment-and-enforce-the-external-boundaries)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-servers-devices-boundaries-azure-vpn.png)¬†\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS2",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-2",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-3: Define Security Posture Management Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy#gs-3-define-security-posture-management-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Benchmark - Posture and Vulnerability Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-posture-vulnerability-management)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[20, 3, 5](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[RA, CM, SC](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS-3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Security Posture Management Strategy](https://docs.microsoft.com/security/zero-trust/visibility-automation-orchestration)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-provide-integrated-capabilities-manage-threats.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-3",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-4: Align Organization Roles, Responsibilities, and Accountabilities](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy#gs-4-align-organization-roles-responsibilities-and-accountabilities)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Best Practice 1 ‚Äì People: Educate Teams on Cloud Security Journey](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#1-people-educate-teams-about-the-cloud-security-journey)<br>\r\nüü¶ [Azure Security Best Practice 2 - People: Educate Teams on Cloud Security Technology](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#2-people-educate-teams-on-cloud-security-technology)<br>\r\nüü¶ [Azure Security Best Practice 3 - Process: Assign Accountability for Cloud Security Decisions](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#4-process-update-incident-response-ir-processes-for-cloud)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\nN/A <br>\r\n### NIST SP 800-53 r4 IDs\r\n[PL, PM](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "GS-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Align Organization Roles, Responsibilities, and Accountabilities](https://docs.microsoft.com/security/zero-trust/identity)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-steps-box-identity-1.png)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-4",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-5: Define Network Security Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy?WT.mc_id=Portal-fx#gs-5-define-network-security-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Best Practice 11 - Architecture. Single Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\nüü¶ [Azure Security Benchmark - Network Security](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-network-security)<br>\r\nüü¶ [Azure Network Security Overview](https://docs.microsoft.com/azure/security/fundamentals/network-overview)<br>\r\nüü¶ [Enterprise Network Architecture Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/architecture)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[9](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CA, SC](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "GS-4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Network Security Strategy](https://docs.microsoft.com/security/zero-trust/networks)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-azure-region-virtual-network-servers.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-5",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-6: Define Identity and Privileged Access Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy?WT.mc_id=Portal-fx#gs-6-define-identity-and-privileged-access-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Benchmark - Identity Management](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-identity-management)<br>\r\nüü¶ [Azure Security Benchmark - Privileged Access](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-privileged-access)<br>\r\nüü¶ [Azure Security Best Practice 11 - Architecture. Single Unified Security Strategy](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#11-architecture-establish-a-single-unified-security-strategy)<br>\r\nüü¶ [Azure Identity Management Security Overview](https://docs.microsoft.com/azure/security/fundamentals/identity-management-overview)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[16, 4](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[AC, AU, SC](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "GS-6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Identity and Privileged Access Strategy](https://docs.microsoft.com/security/zero-trust/identity)\r\n![Image¬†Name](https://docs.microsoft.com/security/zero-trust/media/diagram-conditional-access-policies.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-6",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-7: Define Logging and Threat Response Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy?WT.mc_id=Portal-fx#gs-7-define-logging-and-threat-response-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Benchmark - Logging and Threat Detection](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-logging-threat-detection)<br>\r\nüü¶ [Azure Security Benchmark - Incident Response](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-incident-response)<br>\r\nüü¶ [Azure Security Best Practice 4 - Process. Update Incident Response Processes for Cloud](https://docs.microsoft.com/azure/cloud-adoption-framework/security/security-top-10#3-process-assign-accountability-for-cloud-security-decisions)<br>\r\nüü¶ [Azure Adoption Framework, Logging, and Reporting Decision Guide](https://docs.microsoft.com/azure/cloud-adoption-framework/decision-guides/logging-and-reporting/)<br>\r\nüü¶ [Azure Enterprise Scale, Management, and Monitoring](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[19](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[IR, AU, RA, SC](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "GS-7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Logging and Threat Response Strategy](https://docs.microsoft.com/azure/sentinel/overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/sentinel/media/overview/core-capabilities.png)¬†\r\n"
                  },
                  "customWidth": "35",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS7",
                  "styleSettings": {
                    "maxWidth": "35"
                  }
                }
              ]
            },
            "name": "GS-7",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [GS-8: Define Backup and Recovery Strategy](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-governance-strategy?WT.mc_id=Portal-fx#gs-8-define-backup-and-recovery-strategy)\r\n\r\n## [Azure Security Center - Regulatory Compliance - Azure Security Benchmark](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/22)\r\n\r\n### Strategy\r\nüü¶ [Azure Security Benchmark - Backup and Recovery](https://docs.microsoft.com/security/benchmark/azure/security-controls-v2-backup-recovery)<br>\r\nüü¶ [Azure Well-Architecture Framework - Backup and Disaster Recover for Azure Applications](https://docs.microsoft.com/azure/architecture/framework/resiliency/backup-and-recovery)<br>\r\nüü¶ [Azure Adoption Framework - Business Continuity and Disaster Recovery](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/business-continuity-and-disaster-recovery)<br>\r\n\r\n### CIS Controls v7.1 IDs\r\n[10](https://www.cisecurity.org/controls/v7/)<br>\r\n### NIST SP 800-53 r4 IDs\r\n[CP](https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final)<br>\r\n"
                  },
                  "customWidth": "50",
                  "name": "GS-8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üí° [Define Backup and Recovery Strategy](https://docs.microsoft.com/azure/backup/backup-overview)\r\n![Image¬†Name](https://docs.microsoft.com/azure/backup/media/backup-overview/azure-backup-overview.png)¬†\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "isGSVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "GS8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "GS-8",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "isGSVisible",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "Governance & Strategy Group"
    }
  ],
  "fromTemplateId": "sentinel-AzureSecurityBenchmark",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}